# AIWendy é¡¹ç›®é‡æ„æ–¹æ¡ˆï¼ˆå½’æ¡£ï¼‰

## æ‰§è¡Œæ‘˜è¦

åŸºäºé¡¹ç›®åˆ†æï¼ŒAIWendy éœ€è¦è¿›è¡Œ**ä¸­ç­‰ç¨‹åº¦çš„é‡æ„**ï¼Œä¸»è¦é›†ä¸­åœ¨ï¼š
1. åˆ é™¤å†—ä½™æ–‡ä»¶ï¼ˆ30+ ä¸ªæ–‡ä»¶ï¼‰
2. æ¸…ç†æœªä½¿ç”¨çš„ä»£ç å¼•ç”¨
3. ç®€åŒ–é…ç½®ç®¡ç†
4. ä¼˜åŒ–ç›®å½•ç»“æ„

**é¢„è®¡å½±å“**ï¼šä½é£é™©ï¼Œä¸»è¦æ˜¯åˆ é™¤å’Œæ¸…ç†å·¥ä½œ
**é¢„è®¡æ—¶é—´**ï¼š2-3 å°æ—¶
**å»ºè®®**ï¼šåˆ†é˜¶æ®µæ‰§è¡Œï¼Œæ¯é˜¶æ®µåæµ‹è¯•

---

## é˜¶æ®µ 1ï¼šç«‹å³æ¸…ç†ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰âš¡

### 1.1 åˆ é™¤å†—ä½™çš„ Docker é…ç½®æ–‡ä»¶

**è¦åˆ é™¤çš„æ–‡ä»¶ï¼š**
```
âŒ C:\github_project\AIWendy\docker-compose.yml (æ ¹ç›®å½•ï¼Œä¿ç•™ aiwendy/ ä¸‹çš„)
âŒ C:\github_project\AIWendy\aiwendy\docker-compose.optimized.yml
âŒ C:\github_project\AIWendy\aiwendy\apps\api\Dockerfile.cn
âŒ C:\github_project\AIWendy\aiwendy\apps\api\Dockerfile.optimized
âŒ C:\github_project\AIWendy\aiwendy\apps\web\Dockerfile.cn
âŒ C:\github_project\AIWendy\aiwendy\Dockerfile.api (é‡å¤)
```

**ä¿ç•™çš„æ–‡ä»¶ï¼š**
```
âœ… C:\github_project\AIWendy\aiwendy\docker-compose.yml (ä¸»é…ç½®)
âœ… C:\github_project\AIWendy\aiwendy\apps\api\Dockerfile
âœ… C:\github_project\AIWendy\aiwendy\apps\web\Dockerfile
```

**åŸå› **ï¼š
- å‡å°‘ç»´æŠ¤è´Ÿæ‹…
- é¿å…é…ç½®ä¸ä¸€è‡´
- ç®€åŒ–éƒ¨ç½²æµç¨‹

---

### 1.2 åˆ é™¤å†—ä½™çš„ç¯å¢ƒé…ç½®æ–‡ä»¶

**è¦åˆ é™¤çš„æ–‡ä»¶ï¼š**
```
âŒ C:\github_project\AIWendy\.env.example (æ ¹ç›®å½•ï¼Œä¿ç•™ aiwendy/ ä¸‹çš„)
```

**ä¿ç•™çš„æ–‡ä»¶ï¼š**
```
âœ… C:\github_project\AIWendy\aiwendy\.env.example
âœ… C:\github_project\AIWendy\.env.cloud.example (äº‘æ¨¡å¼ä¸“ç”¨)
```

---

### 1.3 åˆ é™¤å†—ä½™çš„æ–‡æ¡£æ–‡ä»¶

**è¦åˆ é™¤çš„æ–‡ä»¶ï¼š**
```
âŒ C:\github_project\AIWendy\aiwendy\README.md (å†…å®¹åˆå¹¶åˆ°æ ¹ç›®å½• README)
âŒ PROJECT_STATUS_FINAL.md (å¦‚æœå­˜åœ¨)
âŒ PROJECT_COMPLETION_REPORT.md (å¦‚æœå­˜åœ¨)
âŒ STRIPE_SETUP.md (å·²åˆ é™¤ Stripe åŠŸèƒ½)
```

**ä¿ç•™çš„æ–‡ä»¶ï¼š**
```
âœ… C:\github_project\AIWendy\README.md (ä¸»æ–‡æ¡£)
âœ… C:\github_project\AIWendy\PROJECT_STATUS.md
âœ… C:\github_project\AIWendy\aiwendy\docs\*.md (è¯¦ç»†æ–‡æ¡£)
```

---

### 1.4 æ›´æ–° .gitignore

**æ·»åŠ å†…å®¹ï¼š**
```gitignore
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python

# Environment
.env
.env.local
.env.*.local

# IDE
.vscode/
.idea/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db

# Logs
logs/
*.log

# Docker
docker-compose.override.yml
```

---

## é˜¶æ®µ 2ï¼šæ¸…ç†ä»£ç å¼•ç”¨ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰ğŸ”§

### 2.1 æ¸…ç† User æ¨¡å‹

**æ–‡ä»¶**ï¼š`aiwendy/apps/api/domain/user/models.py`

**è¦åˆ é™¤çš„å­—æ®µï¼š**
```python
# åˆ é™¤ Stripe ç›¸å…³å­—æ®µ
stripe_customer_id = Column(String(255), nullable=True)  # âŒ åˆ é™¤
stripe_subscription_id = Column(String(255), nullable=True)  # âŒ åˆ é™¤

# ä¿ç•™ä½†ç®€åŒ–è®¢é˜…å­—æ®µ
subscription_tier = Column(Enum(SubscriptionTier), ...)  # âœ… ä¿ç•™
subscription_expires_at = Column(DateTime(timezone=True), ...)  # âœ… ä¿ç•™
```

**åŸå› **ï¼š
- Stripe æœåŠ¡å·²åˆ é™¤
- ç®€åŒ–ä¸ºåŸºç¡€è®¢é˜…ç®¡ç†
- äº‘æ¨¡å¼ä½¿ç”¨æ–°çš„ Tenant æ¨¡å‹

---

### 2.2 æ›´æ–° config.py

**æ–‡ä»¶**ï¼š`aiwendy/apps/api/config.py`

**è¦åˆ é™¤çš„é…ç½®ï¼š**
```python
# âŒ åˆ é™¤ Stripe é…ç½®ï¼ˆå·²åˆ é™¤æœåŠ¡ï¼‰
stripe_api_key: Optional[str] = None
stripe_webhook_secret: Optional[str] = None
stripe_price_id_*: Optional[str] = None

# âŒ åˆ é™¤æ—§çš„ SSO é…ç½®ï¼ˆä½¿ç”¨æ–°çš„ services/sso.pyï¼‰
# ä¿ç•™æ–°çš„ enterprise_sso_enabled ç­‰é…ç½®
```

**è¦ç®€åŒ–çš„é…ç½®ï¼š**
```python
# åˆå¹¶é‡å¤çš„ billing é…ç½®
# ç»Ÿä¸€ analytics é…ç½®
# æ¸…ç†æœªä½¿ç”¨çš„ feature flags
```

---

### 2.3 åˆ é™¤æœªä½¿ç”¨çš„ Web é¡µé¢

**è¦åˆ é™¤çš„ç›®å½•/æ–‡ä»¶ï¼š**
```
âŒ aiwendy/apps/web/app/checkout/
âŒ aiwendy/apps/web/app/pricing/
âŒ aiwendy/apps/web/app/subscription/
âŒ aiwendy/apps/web/components/pricing-section.tsx
```

**åŸå› **ï¼š
- è¿™äº›é¡µé¢å¯¹åº”å·²åˆ é™¤çš„ Stripe åŠŸèƒ½
- äº‘æ¨¡å¼ä½¿ç”¨æ–°çš„è®¡è´¹ç³»ç»Ÿ

---

### 2.4 æ¸…ç†ç©ºç›®å½•

**è¦åˆ é™¤çš„ç›®å½•ï¼š**
```
âŒ aiwendy/apps/api/domain/organization/ (ç©ºç›®å½•)
âŒ aiwendy/apps/api/domain/subscription/ (åªæœ‰ __pycache__)
```

---

## é˜¶æ®µ 3ï¼šä¼˜åŒ–ç›®å½•ç»“æ„ï¼ˆä½ä¼˜å…ˆçº§ï¼‰ğŸ“

### 3.1 å½“å‰ç»“æ„é—®é¢˜

```
aiwendy/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ routers/  (19 ä¸ªæ–‡ä»¶ï¼Œè¿‡äºåˆ†æ•£)
â”‚   â”‚   â”œâ”€â”€ domain/   (9 ä¸ªå­ç›®å½•ï¼ŒåµŒå¥—æ·±)
â”‚   â”‚   â””â”€â”€ services/ (æœåŠ¡åˆ†æ•£)
```

### 3.2 å»ºè®®çš„æ–°ç»“æ„

**é€‰é¡¹ Aï¼šä¿æŒå½“å‰ç»“æ„ï¼Œä»…åˆå¹¶è·¯ç”±**
```
aiwendy/apps/api/
â”œâ”€â”€ routers/
â”‚   â”œâ”€â”€ auth.py          # è®¤è¯ç›¸å…³
â”‚   â”œâ”€â”€ coaches.py       # åˆå¹¶ coaches + custom_coaches
â”‚   â”œâ”€â”€ chat.py          # å¯¹è¯
â”‚   â”œâ”€â”€ knowledge.py     # çŸ¥è¯†åº“
â”‚   â”œâ”€â”€ journal.py       # äº¤æ˜“æ—¥å¿—
â”‚   â”œâ”€â”€ reports.py       # æŠ¥å‘Š
â”‚   â”œâ”€â”€ analytics.py     # åˆå¹¶åˆ†æç›¸å…³
â”‚   â”œâ”€â”€ projects.py      # é¡¹ç›®ç®¡ç†
â”‚   â”œâ”€â”€ roundtable.py    # åœ†æ¡Œè®¨è®º
â”‚   â””â”€â”€ admin.py         # ç®¡ç†åŠŸèƒ½
```

**é€‰é¡¹ Bï¼šæ‰å¹³åŒ–ç»“æ„ï¼ˆæ›´æ¿€è¿›ï¼‰**
```
aiwendy/api/
â”œâ”€â”€ models/              # ç»Ÿä¸€æ‰€æœ‰æ¨¡å‹
â”‚   â”œâ”€â”€ user.py
â”‚   â”œâ”€â”€ coach.py
â”‚   â”œâ”€â”€ chat.py
â”‚   â””â”€â”€ ...
â”œâ”€â”€ routers/             # ç®€åŒ–è·¯ç”±
â”œâ”€â”€ services/            # ä¸šåŠ¡é€»è¾‘
â””â”€â”€ core/                # æ ¸å¿ƒåŠŸèƒ½
```

**å»ºè®®**ï¼šå…ˆæ‰§è¡Œé€‰é¡¹ Aï¼ˆé£é™©ä½ï¼‰ï¼Œæœªæ¥è€ƒè™‘é€‰é¡¹ B

---

## é˜¶æ®µ 4ï¼šé…ç½®ç®¡ç†ä¼˜åŒ–ï¼ˆä½ä¼˜å…ˆçº§ï¼‰âš™ï¸

### 4.1 ç»Ÿä¸€ç¯å¢ƒå˜é‡

**åˆ›å»ºé…ç½®å±‚çº§ï¼š**
```
.env.example           # åŸºç¡€é…ç½®æ¨¡æ¿
.env.self-hosted       # è‡ªæ‰˜ç®¡ä¸“ç”¨
.env.cloud             # äº‘æ¨¡å¼ä¸“ç”¨
```

### 4.2 é…ç½®éªŒè¯

æ·»åŠ é…ç½®éªŒè¯é€»è¾‘ï¼š
```python
def validate_config(settings: Settings):
    """éªŒè¯é…ç½®çš„ä¸€è‡´æ€§"""
    if settings.is_cloud_mode():
        assert settings.multi_tenancy_enabled, "Cloud mode requires multi-tenancy"
        assert settings.analytics_provider, "Cloud mode requires analytics"
```

---

## æ‰§è¡Œè®¡åˆ’

### ç¬¬ 1 å¤©ï¼šæ¸…ç†æ–‡ä»¶ï¼ˆ2 å°æ—¶ï¼‰
1. âœ… åˆ é™¤å†—ä½™ Docker æ–‡ä»¶
2. âœ… åˆ é™¤å†—ä½™é…ç½®æ–‡ä»¶
3. âœ… åˆ é™¤å†—ä½™æ–‡æ¡£
4. âœ… æ›´æ–° .gitignore
5. âœ… æµ‹è¯• Docker æ„å»º

### ç¬¬ 2 å¤©ï¼šæ¸…ç†ä»£ç ï¼ˆ2 å°æ—¶ï¼‰
1. âœ… æ¸…ç† User æ¨¡å‹
2. âœ… æ›´æ–° config.py
3. âœ… åˆ é™¤æœªä½¿ç”¨çš„ Web é¡µé¢
4. âœ… æ¸…ç†ç©ºç›®å½•
5. âœ… è¿è¡Œæµ‹è¯•

### ç¬¬ 3 å¤©ï¼šä¼˜åŒ–ç»“æ„ï¼ˆå¯é€‰ï¼Œ3 å°æ—¶ï¼‰
1. âœ… åˆå¹¶ç›¸å…³è·¯ç”±
2. âœ… é‡æ„é…ç½®ç®¡ç†
3. âœ… æ›´æ–°æ–‡æ¡£
4. âœ… å…¨é¢æµ‹è¯•

---

## é£é™©è¯„ä¼°

| é˜¶æ®µ | é£é™©ç­‰çº§ | å½±å“èŒƒå›´ | å›æ»šéš¾åº¦ |
|------|---------|---------|---------|
| é˜¶æ®µ 1 | ğŸŸ¢ ä½ | é…ç½®æ–‡ä»¶ | å®¹æ˜“ |
| é˜¶æ®µ 2 | ğŸŸ¡ ä¸­ | æ•°æ®æ¨¡å‹ | ä¸­ç­‰ |
| é˜¶æ®µ 3 | ğŸŸ  ä¸­é«˜ | ä»£ç ç»“æ„ | å›°éš¾ |
| é˜¶æ®µ 4 | ğŸŸ¡ ä¸­ | é…ç½®ç³»ç»Ÿ | ä¸­ç­‰ |

---

## é¢„æœŸæ”¶ç›Š

### ç«‹å³æ”¶ç›Š
- âœ… å‡å°‘ 30+ ä¸ªå†—ä½™æ–‡ä»¶
- âœ… é™ä½ 40% çš„é…ç½®å¤æ‚åº¦
- âœ… æé«˜éƒ¨ç½²å¯é æ€§

### é•¿æœŸæ”¶ç›Š
- âœ… æ›´å®¹æ˜“ç»´æŠ¤
- âœ… æ›´å¿«çš„å¼€å‘é€Ÿåº¦
- âœ… æ›´å°‘çš„ bug
- âœ… æ›´å¥½çš„ä»£ç è´¨é‡

---

## å»ºè®®æ‰§è¡Œé¡ºåº

### ç«‹å³æ‰§è¡Œï¼ˆä»Šå¤©ï¼‰
1. **é˜¶æ®µ 1**ï¼šåˆ é™¤å†—ä½™æ–‡ä»¶
   - é£é™©ä½ï¼Œæ”¶ç›Šé«˜
   - ä¸å½±å“åŠŸèƒ½
   - 30 åˆ†é’Ÿå®Œæˆ

### æœ¬å‘¨æ‰§è¡Œ
2. **é˜¶æ®µ 2**ï¼šæ¸…ç†ä»£ç å¼•ç”¨
   - éœ€è¦æµ‹è¯•
   - å½±å“æ•°æ®æ¨¡å‹
   - 2 å°æ—¶å®Œæˆ

### ä¸‹å‘¨æ‰§è¡Œï¼ˆå¯é€‰ï¼‰
3. **é˜¶æ®µ 3**ï¼šä¼˜åŒ–ç›®å½•ç»“æ„
   - éœ€è¦å……åˆ†æµ‹è¯•
   - å½±å“è¾ƒå¤§
   - 3 å°æ—¶å®Œæˆ

4. **é˜¶æ®µ 4**ï¼šé…ç½®ç®¡ç†ä¼˜åŒ–
   - æ”¹è¿›ç”¨æˆ·ä½“éªŒ
   - 1 å°æ—¶å®Œæˆ

---

## ä¸å»ºè®®é‡æ„çš„éƒ¨åˆ†

### âœ… ä¿æŒä¸å˜
1. **æ ¸å¿ƒä¸šåŠ¡é€»è¾‘**
   - Chatã€Knowledgeã€Journal ç­‰åŠŸèƒ½è¿è¡Œè‰¯å¥½
   - ä¸è¦ä¸ºäº†é‡æ„è€Œé‡æ„

2. **æ•°æ®åº“æ¶æ„**
   - å½“å‰è®¾è®¡åˆç†
   - è¿ç§»æˆæœ¬é«˜

3. **å‰ç«¯ç»„ä»¶**
   - Next.js ç»“æ„æ¸…æ™°
   - ç»„ä»¶å¤ç”¨è‰¯å¥½

---

## æ€»ç»“

### æ˜¯å¦éœ€è¦é‡æ„ï¼Ÿ
**ç­”æ¡ˆï¼šéœ€è¦é€‚åº¦é‡æ„ï¼Œä½†ä¸æ˜¯å¤§è§„æ¨¡é‡å†™**

### é‡æ„é‡ç‚¹
1. âœ… **åˆ é™¤å†—ä½™**ï¼ˆå¿…é¡»ï¼‰
2. âœ… **æ¸…ç†å¼•ç”¨**ï¼ˆå¿…é¡»ï¼‰
3. âš ï¸ **ä¼˜åŒ–ç»“æ„**ï¼ˆå¯é€‰ï¼‰
4. âš ï¸ **æ”¹è¿›é…ç½®**ï¼ˆå¯é€‰ï¼‰

### æ ¸å¿ƒåŸåˆ™
- **æ¸è¿›å¼é‡æ„**ï¼šåˆ†é˜¶æ®µæ‰§è¡Œï¼Œæ¯æ­¥æµ‹è¯•
- **ä¿æŒåŠŸèƒ½**ï¼šä¸ç ´åç°æœ‰åŠŸèƒ½
- **é™ä½é£é™©**ï¼šå…ˆæ˜“åéš¾ï¼Œå¯å›æ»š
- **æé«˜è´¨é‡**ï¼šä»£ç æ›´æ¸…æ™°ï¼Œæ›´æ˜“ç»´æŠ¤

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

è¯·ç¡®è®¤æ˜¯å¦æ‰§è¡Œï¼š

1. **ç«‹å³æ‰§è¡Œé˜¶æ®µ 1**ï¼ˆåˆ é™¤å†—ä½™æ–‡ä»¶ï¼‰ï¼Ÿ
   - é£é™©ï¼šä½
   - æ—¶é—´ï¼š30 åˆ†é’Ÿ
   - æ”¶ç›Šï¼šç«‹å³è§æ•ˆ

2. **æœ¬å‘¨æ‰§è¡Œé˜¶æ®µ 2**ï¼ˆæ¸…ç†ä»£ç ï¼‰ï¼Ÿ
   - é£é™©ï¼šä¸­
   - æ—¶é—´ï¼š2 å°æ—¶
   - æ”¶ç›Šï¼šä»£ç è´¨é‡æå‡

3. **å¯é€‰æ‰§è¡Œé˜¶æ®µ 3-4**ï¼ˆç»“æ„ä¼˜åŒ–ï¼‰ï¼Ÿ
   - é£é™©ï¼šä¸­é«˜
   - æ—¶é—´ï¼š4 å°æ—¶
   - æ”¶ç›Šï¼šé•¿æœŸç»´æŠ¤æ€§

---

**å»ºè®®**ï¼šå…ˆæ‰§è¡Œé˜¶æ®µ 1ï¼Œè§‚å¯Ÿæ•ˆæœåå†å†³å®šæ˜¯å¦ç»§ç»­ã€‚
