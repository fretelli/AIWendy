# AIWendy å®Œæ•´æŠ€æœ¯é€‰å‹ä¸äº§å“è®¾è®¡æ–¹æ¡ˆ

> AI äº¤æ˜“å¿ƒç†ç»©æ•ˆæ•™ç»ƒ â€”â€” ç±»ä¼¼ç¾å‰§ã€ŠBillionsã€‹ä¸­ Wendy Rhodes çš„èƒ½åŠ›
>
> ç‰ˆæœ¬ï¼šv1.9 | æ›´æ–°æ—¥æœŸï¼š2026å¹´01æœˆ02æ—¥
>
> **æ›´æ–°æ—¥å¿—**
> - v1.9 (2026-01-02): æ–°å¢ Project åˆ†ç»„ã€çŸ¥è¯†åº“ï¼ˆpgvector è¯­ä¹‰æ£€ç´¢ï¼‰ã€æœåŠ¡ç«¯ä¼šè¯å†å²ã€Celery/Redisï¼ˆå¼‚æ­¥é˜Ÿåˆ— + ç¼“å­˜ï¼‰ï¼›ä¿®å¤ webâ†’api network errorï¼›ä¿®å¤ Next.js viewport é…ç½®è­¦å‘Š
> - v1.8 (2024-12-29): å®Œæˆ Ollama æœ¬åœ°æ¨¡å‹é›†æˆï¼Œæ·»åŠ å®ç°çŠ¶æ€ç« èŠ‚ï¼ˆ22ç« ï¼‰
> - v1.7 (2024-12-29): å®Œæˆæ•°æ®å¯è§†åŒ–å›¾è¡¨ï¼ˆæ”¶ç›Šæ›²çº¿ã€P&Låˆ†å¸ƒã€äº¤æ˜“æ—¥å†ã€å¿ƒç†æŒ‡æ ‡ï¼‰
> - v1.6 (2024-12-29): ä¼˜åŒ–èŠå¤©ç•Œé¢ UIï¼ˆClaude.ai é£æ ¼ã€ä»£ç é«˜äº®ã€èŠå¤©å†å²ï¼‰
> - v1.5 (2024-12-29): å®Œæˆ AI æ—¥è®°åˆ†æåŠŸèƒ½ï¼ˆæ¨¡å¼è¯†åˆ«ã€æ”¹è¿›å»ºè®®ã€ä¸ªæ€§åŒ–è¾…å¯¼ï¼‰
> - v1.4 (2024-12-29): å®Œæˆäº¤æ˜“æ—¥è®°å‰ç«¯å…¨éƒ¨é¡µé¢ï¼ˆåˆ—è¡¨ã€è¯¦æƒ…ã€ç¼–è¾‘ã€ç»Ÿè®¡ä»ªè¡¨æ¿ï¼‰
> - v1.3 (2024-12-28): æ›´æ–°å®ç°çŠ¶æ€ï¼Œå®Œæˆäº¤æ˜“æ—¥è®°åç«¯å®ç°
> - v1.2 (2024-12-28): æ–°å¢æœ¬åœ°éƒ¨ç½²æŒ‡å—ï¼ˆ19ç« ï¼‰ã€å®Œå–„ç”¨æˆ·åŠŸèƒ½è®¾è®¡ï¼ˆ9.9ç« ï¼‰ã€UI æ¨¡ä»¿ç­–ç•¥ï¼ˆ9.8ç« ï¼‰ã€è‡ªå®šä¹‰å¤§æ¨¡å‹è®¾ç½®ï¼ˆ9.9.8ç« ï¼‰
> - v1.1 (2024-12-28): æ–°å¢ç”¨æˆ·çº§ API å¯†é’¥é…ç½®ã€ä¸­å›½åœ°åŒºéƒ¨ç½²ä¼˜åŒ–ã€æ ‡è®°å·²å®ç°åŠŸèƒ½
> - v1.0 (2024-12): åˆå§‹ç‰ˆæœ¬

> **é‡è¦è¯´æ˜**ï¼šæœ¬æ–‡æ¡£åŒ…å«â€œè§„åˆ’/è®¾è®¡â€å’Œâ€œå®ç°çŠ¶æ€â€ä¸¤éƒ¨åˆ†ï¼›å¦‚ä¸ä»£ç å†²çªï¼Œè¯·ä»¥ `PROJECT_STATUS.md` ä¸å®é™…ä»£ç ä¸ºå‡†ã€‚

## é˜…è¯»å»ºè®®ï¼ˆå…ˆçœ‹è¿™äº›ï¼‰

- å¿«é€Ÿä¸Šæ‰‹ä¸æ–‡æ¡£ç´¢å¼•ï¼š`../README.md`
- è‡ªæ‰˜ç®¡ï¼ˆDocker Composeï¼‰ï¼š`../aiwendy/docs/SELF_HOSTING.md`
- é¡¹ç›®çŠ¶æ€ï¼ˆä»¥ä»£ç ä¸ºå‡†ï¼‰ï¼š`PROJECT_STATUS.md`
- æ¶æ„æ¦‚è§ˆï¼š`../aiwendy/docs/ARCHITECTURE.md`
- æ–‡ä¸­è‹¥å‡ºç° `docker-compose` å‘½ä»¤ï¼Œå¯ç­‰ä»·æ›¿æ¢ä¸º `docker compose`ï¼ˆCompose v2ï¼‰

---

## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ ˆç‰ˆæœ¬æ¸…å•](#2-æŠ€æœ¯æ ˆç‰ˆæœ¬æ¸…å•)
3. [æŠ€æœ¯æ ˆè°ƒç ”å¯¹æ¯”](#3-æŠ€æœ¯æ ˆè°ƒç ”å¯¹æ¯”)
4. [æ ¸å¿ƒæŠ€æœ¯é€‰å‹](#4-æ ¸å¿ƒæŠ€æœ¯é€‰å‹)
5. [ç³»ç»Ÿæ¶æ„è®¾è®¡](#5-ç³»ç»Ÿæ¶æ„è®¾è®¡)
6. [å¤šæ•™ç»ƒæ¶æ„](#6-å¤šæ•™ç»ƒæ¶æ„)
7. [ç”¨æˆ·æ—…ç¨‹è®¾è®¡](#7-ç”¨æˆ·æ—…ç¨‹è®¾è®¡)
8. [æ˜“ç”¨æ€§è®¾è®¡](#8-æ˜“ç”¨æ€§è®¾è®¡)
9. [è§†è§‰è®¾è®¡æ–¹æ¡ˆ](#9-è§†è§‰è®¾è®¡æ–¹æ¡ˆ)
10. [ç”Ÿäº§çº§åˆ«æ¶æ„](#10-ç”Ÿäº§çº§åˆ«æ¶æ„)
11. [å®‰å…¨è®¾è®¡](#11-å®‰å…¨è®¾è®¡)
12. [æ•°æ®åº“è®¾è®¡](#12-æ•°æ®åº“è®¾è®¡)
13. [API è§„èŒƒ](#13-api-è§„èŒƒ)
14. [DevOps ä¸ CI/CD](#14-devops-ä¸-cicd)
15. [ç›‘æ§å‘Šè­¦](#15-ç›‘æ§å‘Šè­¦)
16. [ç¾å¤‡ä¸æ¢å¤](#16-ç¾å¤‡ä¸æ¢å¤)
17. [æ€§èƒ½è®¾è®¡](#17-æ€§èƒ½è®¾è®¡)
18. [è¿ç»´æ‰‹å†Œ](#18-è¿ç»´æ‰‹å†Œ)
19. [æœ¬åœ°éƒ¨ç½²æŒ‡å—](#19-æœ¬åœ°éƒ¨ç½²æŒ‡å—)
20. [å®æ–½è·¯çº¿å›¾](#20-å®æ–½è·¯çº¿å›¾)
21. [æˆæœ¬ä¼°ç®—](#21-æˆæœ¬ä¼°ç®—)
22. [å®ç°çŠ¶æ€](#22-å®ç°çŠ¶æ€)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 äº§å“å®šä½

AIWendy æ˜¯ä¸€æ¬¾é¢å‘äº¤æ˜“è€…çš„ AI å¿ƒç†ç»©æ•ˆæ•™ç»ƒäº§å“ï¼Œæä¾›ï¼š

| æ ¸å¿ƒåŠŸèƒ½ | è¯´æ˜ |
|----------|------|
| **å®æ—¶æƒ…ç»ªå¹²é¢„** | ç›˜ä¸­ç´§æ€¥å¿ƒç†æ”¯æŒï¼Œä½å»¶è¿Ÿå“åº” |
| **äº¤æ˜“åè¡Œä¸ºåˆ†æ** | å¤ç›˜äº¤æ˜“å†³ç­–ï¼Œè¯†åˆ«å¿ƒç†æ¨¡å¼ |
| **å‘¨æœŸæ€§æŠ¥å‘Š** | å‘¨/æœˆç»´åº¦çš„è¡Œä¸ºæ¨¡å¼è¶‹åŠ¿åˆ†æ |
| **å¤šæ•™ç»ƒç³»ç»Ÿ** | ä¸åŒé£æ ¼çš„ AI æ•™ç»ƒå¯ä¾›é€‰æ‹© |

### 1.2 ç›®æ ‡ç”¨æˆ·

- ä¸»åŠ¨äº¤æ˜“è€…ï¼ˆè‚¡ç¥¨ã€æœŸè´§ã€åŠ å¯†è´§å¸ã€å¤–æ±‡ï¼‰
- æœ‰ä¸€å®šäº¤æ˜“ç»éªŒä½†å—æƒ…ç»ªå›°æ‰°
- æ„¿æ„ä¸ºå¿ƒç†ç»©æ•ˆæå‡ä»˜è´¹

### 1.3 å•†ä¸šæ¨¡å¼

| å±‚çº§ | æœˆè´¹ | åŠŸèƒ½ |
|------|------|------|
| Free | $0 | 3 æ¬¡/å¤©æ—¥è®°ï¼ŒåŸºç¡€ AI æ´å¯Ÿï¼Œ3 ä¸ªåŸºç¡€æ•™ç»ƒ |
| Pro | $79 | æ— é™æ—¥è®°ï¼Œæ— é™ AI æ•™ç»ƒï¼Œå…¨éƒ¨æ•™ç»ƒï¼Œå‘¨æŠ¥ |
| Elite | $149 | ä¼˜å…ˆå“åº”ï¼ŒæœˆæŠ¥ï¼Œ1 æ¬¡/æœˆäººå·¥æ•™ç»ƒ |
| Enterprise | å®šåˆ¶ | ç™½æ ‡ï¼Œè‡ªå®šä¹‰æ•™ç»ƒï¼Œç‹¬ç«‹éƒ¨ç½²ï¼ŒSSO |

---

## 2. æŠ€æœ¯æ ˆç‰ˆæœ¬æ¸…å•

### 2.1 å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| Node.js | **20.x LTS** | è¿è¡Œç¯å¢ƒï¼Œé•¿æœŸæ”¯æŒç‰ˆ |
| Next.js | **14.2.x** | React å…¨æ ˆæ¡†æ¶ï¼ŒApp Router |
| React | **18.3.x** | UI åº“ï¼ŒNext.js 14 å†…ç½® |
| TypeScript | **5.4.x** | ç±»å‹å®‰å…¨ |
| Tailwind CSS | **3.4.x** | åŸå­åŒ– CSS æ¡†æ¶ |
| shadcn/ui | **æœ€æ–°** | UI ç»„ä»¶åº“ï¼ˆæŒ‰éœ€å¤åˆ¶ï¼Œæ— ç‰ˆæœ¬å·ï¼‰ |
| Radix UI | **1.x** | shadcn åº•å±‚åŸè¯­ç»„ä»¶ |
| Zustand | **4.5.x** | è½»é‡çŠ¶æ€ç®¡ç† |
| next-auth | **5.0.x-beta** | è®¤è¯æ¡†æ¶ï¼ˆæˆ– 4.24.x ç¨³å®šç‰ˆï¼‰ |
| Vercel AI SDK | **3.1.x** | LLM æµå¼æ¸²æŸ“ |
| Lucide React | **0.378.x** | å›¾æ ‡åº“ |
| class-variance-authority | **0.7.x** | ç»„ä»¶å˜ä½“ç®¡ç† |
| clsx | **2.1.x** | ç±»ååˆå¹¶ |
| tailwind-merge | **2.3.x** | Tailwind ç±»ååˆå¹¶ |
| zod | **3.23.x** | è¡¨å•æ ¡éªŒ |
| react-hook-form | **7.51.x** | è¡¨å•ç®¡ç† |
| date-fns | **3.6.x** | æ—¥æœŸå¤„ç† |
| recharts | **2.12.x** | å›¾è¡¨åº“ |

### 2.2 åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| Python | **3.11.x** | è¿è¡Œç¯å¢ƒï¼ˆæˆ– 3.12.xï¼‰ |
| FastAPI | **0.111.x** | å¼‚æ­¥ Web æ¡†æ¶ |
| Uvicorn | **0.29.x** | ASGI æœåŠ¡å™¨ |
| Pydantic | **2.7.x** | æ•°æ®æ ¡éªŒå’Œåºåˆ—åŒ– |
| Pydantic-settings | **2.3.x** | é…ç½®ç®¡ç† |
| SQLAlchemy | **2.0.x** | ORM |
| Alembic | **1.13.x** | æ•°æ®åº“è¿ç§» |
| asyncpg | **0.29.x** | PostgreSQL å¼‚æ­¥é©±åŠ¨ |
| Celery | **5.4.x** | åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ— |
| Redis-py | **5.0.x** | Redis å®¢æˆ·ç«¯ |
| httpx | **0.27.x** | å¼‚æ­¥ HTTP å®¢æˆ·ç«¯ |
| python-jose | **3.3.x** | JWT å¤„ç† |
| passlib | **1.7.x** | å¯†ç å“ˆå¸Œ |
| python-multipart | **0.0.9** | æ–‡ä»¶ä¸Šä¼  |
| python-dotenv | **1.0.x** | ç¯å¢ƒå˜é‡ |

### 2.3 æ•°æ®åº“

| æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| PostgreSQL | **16.x** | ä¸»æ•°æ®åº“ |
| pgvector | **0.7.x** | å‘é‡æœç´¢æ‰©å±• |
| Redis | **7.2.x** | ç¼“å­˜ / ä¼šè¯ / æ¶ˆæ¯é˜Ÿåˆ— |

### 2.4 LLM SDK

| æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| openai (Python) | **1.30.x** | OpenAI API SDK |
| anthropic (Python) | **0.25.x** | Claude API SDK |
| tiktoken | **0.7.x** | Token è®¡æ•° |

### 2.5 DevOps / éƒ¨ç½²

| æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| Docker | **26.x** | å®¹å™¨åŒ– |
| Docker Compose | **2.27.x** | æœ¬åœ°ç¼–æ’ |
| Vercel CLI | **34.x** | å‰ç«¯éƒ¨ç½² |
| Railway CLI | **3.x** | åç«¯éƒ¨ç½² |
| GitHub Actions | **æœ€æ–°** | CI/CD |

### 2.6 ç›‘æ§ / åˆ†æ

| æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| Sentry SDK (Python) | **2.3.x** | åç«¯é”™è¯¯è¿½è¸ª |
| @sentry/nextjs | **8.x** | å‰ç«¯é”™è¯¯è¿½è¸ª |
| PostHog | **3.x** | äº§å“åˆ†æ |
| PostHog JS | **1.130.x** | å‰ç«¯åŸ‹ç‚¹ |

### 2.7 æ”¯ä»˜

| æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| stripe (Python) | **9.x** | Stripe åç«¯ SDK |
| @stripe/stripe-js | **3.x** | Stripe å‰ç«¯ SDK |
| @stripe/react-stripe-js | **2.7.x** | React ç»„ä»¶ |

### 2.8 package.json å‚è€ƒ

```json
{
  "name": "aiwendy-web",
  "version": "0.1.0",
  "private": true,
  "engines": {
    "node": ">=20.0.0"
  },
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
  "dependencies": {
    "next": "14.2.4",
    "react": "18.3.1",
    "react-dom": "18.3.1",
    "zustand": "4.5.2",
    "next-auth": "5.0.0-beta.19",
    "ai": "3.1.30",
    "zod": "3.23.8",
    "react-hook-form": "7.51.5",
    "@hookform/resolvers": "3.6.0",
    "date-fns": "3.6.0",
    "recharts": "2.12.7",
    "@radix-ui/react-slot": "1.0.2",
    "@radix-ui/react-dialog": "1.0.5",
    "@radix-ui/react-dropdown-menu": "2.0.6",
    "@radix-ui/react-avatar": "1.0.4",
    "@radix-ui/react-tabs": "1.0.4",
    "class-variance-authority": "0.7.0",
    "clsx": "2.1.1",
    "tailwind-merge": "2.3.0",
    "lucide-react": "0.378.0",
    "@stripe/stripe-js": "3.5.0",
    "@stripe/react-stripe-js": "2.7.1",
    "@sentry/nextjs": "8.9.2",
    "posthog-js": "1.130.1"
  },
  "devDependencies": {
    "typescript": "5.4.5",
    "@types/node": "20.14.2",
    "@types/react": "18.3.3",
    "@types/react-dom": "18.3.0",
    "tailwindcss": "3.4.4",
    "@tailwindcss/typography": "0.5.13",
    "postcss": "8.4.38",
    "autoprefixer": "10.4.19",
    "eslint": "8.57.0",
    "eslint-config-next": "14.2.4",
    "prettier": "3.3.2",
    "prettier-plugin-tailwindcss": "0.6.4"
  }
}
```

### 2.9 requirements.txt å‚è€ƒ

```txt
# ========== Core ==========
fastapi==0.111.0
uvicorn[standard]==0.29.0
pydantic==2.7.3
pydantic-settings==2.3.0

# ========== Database ==========
sqlalchemy==2.0.30
alembic==1.13.1
asyncpg==0.29.0
psycopg2-binary==2.9.9
pgvector==0.2.5

# ========== Redis & Celery ==========
redis==5.0.4
celery==5.4.0

# ========== LLM ==========
openai==1.30.5
anthropic==0.25.9
tiktoken==0.7.0

# ========== HTTP ==========
httpx==0.27.0

# ========== Auth ==========
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4

# ========== Monitoring ==========
sentry-sdk[fastapi]==2.3.1

# ========== Payment ==========
stripe==9.6.0

# ========== Utils ==========
python-multipart==0.0.9
python-dotenv==1.0.1
```

### 2.10 docker-compose.yml å‚è€ƒ

```yaml
version: "3.9"

services:
  db:
    image: pgvector/pgvector:pg16
    container_name: aiwendy-db
    environment:
      POSTGRES_USER: aiwendy
      POSTGRES_PASSWORD: ${DB_PASSWORD}
      POSTGRES_DB: aiwendy
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U aiwendy"]
      interval: 10s
      timeout: 5s
      retries: 5

  redis:
    image: redis:7.2-alpine
    container_name: aiwendy-redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5

  api:
    build:
      context: ./apps/api
      dockerfile: Dockerfile
    container_name: aiwendy-api
    environment:
      - DATABASE_URL=postgresql+asyncpg://aiwendy:${DB_PASSWORD}@db:5432/aiwendy
      - REDIS_URL=redis://redis:6379
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - JWT_SECRET=${JWT_SECRET}
    ports:
      - "8000:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./apps/api:/app
    command: uvicorn main:app --host 0.0.0.0 --port 8000 --reload

  worker:
    build:
      context: ./apps/api
      dockerfile: Dockerfile
    container_name: aiwendy-worker
    environment:
      - DATABASE_URL=postgresql+asyncpg://aiwendy:${DB_PASSWORD}@db:5432/aiwendy
      - REDIS_URL=redis://redis:6379
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
    command: celery -A workers.celery_app worker --loglevel=info

  beat:
    build:
      context: ./apps/api
      dockerfile: Dockerfile
    container_name: aiwendy-beat
    environment:
      - DATABASE_URL=postgresql+asyncpg://aiwendy:${DB_PASSWORD}@db:5432/aiwendy
      - REDIS_URL=redis://redis:6379
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
    command: celery -A workers.celery_app beat --loglevel=info

volumes:
  postgres_data:
  redis_data:
```

### 2.11 .env.example å‚è€ƒ

```bash
# ========== Database ==========
DB_PASSWORD=your_secure_password_here

# ========== Redis ==========
REDIS_URL=redis://localhost:6379

# ========== LLM API Keys ==========
OPENAI_API_KEY=sk-xxx
ANTHROPIC_API_KEY=sk-ant-xxx

# ========== Auth ==========
JWT_SECRET=your_jwt_secret_here
NEXTAUTH_SECRET=your_nextauth_secret_here
NEXTAUTH_URL=http://localhost:3000

# ========== Stripe ==========
STRIPE_SECRET_KEY=sk_test_xxx
STRIPE_PUBLISHABLE_KEY=pk_test_xxx
STRIPE_WEBHOOK_SECRET=whsec_xxx

# ========== Sentry ==========
SENTRY_DSN=https://xxx@sentry.io/xxx

# ========== PostHog ==========
NEXT_PUBLIC_POSTHOG_KEY=phc_xxx
NEXT_PUBLIC_POSTHOG_HOST=https://app.posthog.com
```

### 2.12 ç‰ˆæœ¬å…¼å®¹æ€§è¯´æ˜

| ç»„åˆ | å…¼å®¹æ€§ | å¤‡æ³¨ |
|------|--------|------|
| Next.js 14 + React 18 | âœ… å®˜æ–¹æ”¯æŒ | App Router éœ€è¦ React 18.3+ |
| FastAPI + Pydantic 2.x | âœ… å®˜æ–¹æ”¯æŒ | FastAPI 0.100+ åŸç”Ÿæ”¯æŒ |
| SQLAlchemy 2.0 + asyncpg | âœ… å®˜æ–¹æ”¯æŒ | å¼‚æ­¥ ORM æ¨èç»„åˆ |
| PostgreSQL 16 + pgvector 0.7 | âœ… å®˜æ–¹æ”¯æŒ | éœ€è¦ PostgreSQL 12+ |
| Celery 5.4 + Redis 7.x | âœ… å®˜æ–¹æ”¯æŒ | broker å’Œ backend å‡å¯ç”¨ |
| OpenAI SDK 1.x + Claude SDK 0.25 | âœ… å¯å¹¶è¡Œä½¿ç”¨ | æ¥å£é£æ ¼ä¸€è‡´ |

### 2.13 ç‰ˆæœ¬å‡çº§ç­–ç•¥

| ç»„ä»¶ | å‡çº§é¢‘ç‡ | ç­–ç•¥ |
|------|----------|------|
| **å®‰å…¨è¡¥ä¸** | ç«‹å³ | è‡ªåŠ¨åŒ– Dependabot |
| **æ¬¡è¦ç‰ˆæœ¬** | æ¯æœˆ | æµ‹è¯•ååˆå¹¶ |
| **ä¸»è¦ç‰ˆæœ¬** | æŒ‰éœ€ | è¯„ä¼°ç ´åæ€§å˜æ›´åå†³å®š |
| **LLM SDK** | åŠæ—¶è·Ÿè¿› | æ–°æ¨¡å‹å‘å¸ƒåå°½å¿«é€‚é… |

---

## 3. æŠ€æœ¯æ ˆè°ƒç ”å¯¹æ¯”

### 3.1 å››å¤§å¹³å°æŠ€æœ¯æ ˆå¯¹æ¯”

#### Web åº”ç”¨å±‚

| æŠ€æœ¯ç»´åº¦ | Claude (Anthropic) | ChatGPT (OpenAI) | OpenWebUI | FinGPT |
|---------|-------------------|------------------|-----------|--------|
| **å‰ç«¯æ¡†æ¶** | React + Next.js | React + Next.js | SvelteKit 5.0 | æ— ï¼ˆä»… Python/Notebookï¼‰ |
| **åç«¯è¯­è¨€** | Python, Node.js | Python, Rust | Python 3.11+ | Python |
| **åç«¯æ¡†æ¶** | æœªå…¬å¼€ | è‡ªç ” | FastAPI | Flask |
| **API è®¾è®¡** | REST + SSE | REST + WebSocket | REST + WebSocket | HuggingFace API |
| **æ•°æ®åº“** | æœªå…¬å¼€ | æœªå…¬å¼€ | SQLite/PostgreSQL | æ— æŒä¹…å±‚ |

#### AI æ¨¡å‹å±‚

| æŠ€æœ¯ç»´åº¦ | Claude | ChatGPT | OpenWebUI | FinGPT |
|---------|--------|---------|-----------|--------|
| **è®­ç»ƒæ¡†æ¶** | JAX + XLA | PyTorch + Triton | N/A (ä»…æ¶ˆè´¹) | PyTorch + PEFT |
| **ç¡¬ä»¶ä¼˜åŒ–** | TPU ä¼˜å…ˆ | NVIDIA GPU | CPU/GPU æ¨ç† | æ¶ˆè´¹çº§ GPU |
| **å®‰å…¨å¯¹é½** | Constitutional AI | RLHF | N/A | æ—  |
| **å¾®è°ƒæ”¯æŒ** | âŒ ä¸æ”¯æŒ | âœ… GPT-4o æ”¯æŒ | âœ… æœ¬åœ°å®Œå…¨è‡ªä¸» | âœ… LoRA/QLoRA |

#### åŸºç¡€è®¾æ–½å±‚

| æŠ€æœ¯ç»´åº¦ | Claude | ChatGPT | OpenWebUI | FinGPT |
|---------|--------|---------|-----------|--------|
| **äº‘æœåŠ¡å•†** | AWS + GCP + Azure | Azure ä¸ºä¸» | ç”¨æˆ·è‡ªé€‰ | ç”¨æˆ·è‡ªé€‰ |
| **å®¹å™¨ç¼–æ’** | Kubernetes | Kubernetes | Docker/K8s | Docker/Conda |
| **éƒ¨ç½²æˆç†Ÿåº¦** | ä¼ä¸šçº§ | ä¼ä¸šçº§ | ç”Ÿäº§å¯ç”¨ | ç ”ç©¶çº§ |

### 3.2 FinGPT è¯¦ç»†åˆ†æ

FinGPT æ˜¯ AI4Finance åŸºé‡‘ä¼šçš„å¼€æºé‡‘èå¤§æ¨¡å‹æ¡†æ¶ï¼Œç‰¹ç‚¹ï¼š

| ç»´åº¦ | è¯´æ˜ |
|------|------|
| **GitHub Stars** | 18,300+ |
| **åŸºç¡€æ¨¡å‹** | Llama-3-8B, Llama-2-7B/13B, ChatGLM2-6B |
| **å¾®è°ƒæ–¹æ³•** | LoRA (8-bit), QLoRA (4-bit) |
| **è®­ç»ƒæˆæœ¬** | ~$17-22ï¼ˆvs BloombergGPT çš„ $267 ä¸‡ï¼‰ |
| **é‡‘èä»»åŠ¡** | æƒ…ç»ªåˆ†æã€è‚¡ç¥¨é¢„æµ‹ã€è´¢æŠ¥åˆ†æ |

**FinGPT é‡‘èæƒ…ç»ªåˆ†æ F1 å¾—åˆ†**ï¼š

| æ¨¡å‹ | FPB | FiQA-SA | TFNS |
|------|-----|---------|------|
| FinGPT v3.3 (Llama2-13B) | 0.882 | 0.874 | 0.903 |
| GPT-4 | 0.833 | 0.630 | 0.808 |
| BloombergGPT | 0.511 | 0.751 | - |

### 3.3 æµå¼æ¸²æŸ“æ€§èƒ½å¯¹æ¯”

| ç»´åº¦ | React | Svelte |
|------|-------|--------|
| **è¿è¡Œæ—¶å¤§å°** | 42KB | 1.6KB |
| **é¦–æ¬¡æ¸²æŸ“** | 209ms | 65ms |
| **DOM æ›´æ–°** | Virtual DOM diff | ç¼–è¯‘æ—¶ç›´æ¥æ“ä½œ |
| **LLM æµå¼** | éœ€è¦ buffering ä¼˜åŒ– | é»˜è®¤æµç•… |
| **ç”Ÿæ€/æ‹›äºº** | â­â­â­â­â­ | â­â­ |

**ç»“è®º**ï¼šReact éœ€è¦é¢å¤–ä¼˜åŒ–ä»£ç å®ç°æµç•…æµå¼æ¸²æŸ“ï¼Œä½†ç”Ÿæ€å’Œæ‹›äººä¼˜åŠ¿æ˜æ˜¾ã€‚

---

## 4. æ ¸å¿ƒæŠ€æœ¯é€‰å‹

### 4.1 æ¨èæŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | ç†ç”± |
|------|------|------|
| **å‰ç«¯æ¡†æ¶** | Next.js 14 (App Router) | RSC æµå¼æ¸²æŸ“ã€SEO å‹å¥½ã€Vercel éƒ¨ç½²ç®€å• |
| **UI ç»„ä»¶** | shadcn/ui + Tailwind | ç°ä»£ç¾è§‚ã€å¯å®šåˆ¶ã€AI äº§å“ä¸»æµé€‰æ‹© |
| **çŠ¶æ€ç®¡ç†** | Zustand | è½»é‡ã€æ— æ ·æ¿ä»£ç ã€æµå¼åœºæ™¯æ€§èƒ½å¥½ |
| **åç«¯æ¡†æ¶** | FastAPI | å¼‚æ­¥åŸç”Ÿã€LLM ç”Ÿæ€ä¸­å¿ƒã€è‡ªåŠ¨æ–‡æ¡£ |
| **ä¸»æ•°æ®åº“** | PostgreSQL 16 | å¯é ã€pgvector æ”¯æŒå‘é‡æœç´¢ |
| **ç¼“å­˜/ä¼šè¯** | Redis | æµå¼ä¼šè¯çŠ¶æ€ã€é™æµè®¡æ•°å™¨ |
| **ä»»åŠ¡é˜Ÿåˆ—** | Celery + Redis | å¼‚æ­¥è¡Œä¸ºåˆ†æã€æ‰¹é‡å¤„ç† |
| **LLM è·¯ç”±** | è‡ªå»ºè·¯ç”±å±‚ | GPT-4o-mini (å®æ—¶) + Claude (æ·±åº¦åˆ†æ) |
| **è®¤è¯** | NextAuth.js + JWT | OAuth ç¤¾äº¤ç™»å½•ã€ä¼ä¸š SSO é¢„ç•™ |
| **æ”¯ä»˜** | Stripe | è®¢é˜…è®¡è´¹è¡Œä¸šæ ‡å‡† |
| **ç›‘æ§** | Sentry + PostHog | é”™è¯¯è¿½è¸ª + äº§å“åˆ†æ |
| **éƒ¨ç½²** | Vercel + Railway | å¿«é€Ÿä¸Šçº¿ã€è‡ªåŠ¨æ‰©ç¼© |

### 4.2 LLM é€‰å‹ç­–ç•¥

é‡‡ç”¨**æ··åˆæ¶æ„**ï¼š

| åœºæ™¯ | æ¨¡å‹ | ç†ç”± |
|------|------|------|
| **å®æ—¶æƒ…ç»ªå¹²é¢„** | GPT-4o-mini | å»¶è¿Ÿ 300-400msï¼Œæˆæœ¬æœ€ä½ |
| **æ·±åº¦è¡Œä¸ºåˆ†æ** | Claude Sonnet 4.5 | å¼ºæ¨ç†ã€200K ä¸Šä¸‹æ–‡ |
| **æ‰¹é‡æ—¥è®°å¤„ç†** | Batch API | 50% æˆæœ¬æŠ˜æ‰£ |
| **é•¿æœŸæ¼”è¿›** | FinGPT å¾®è°ƒ + vLLM | æœ¬åœ°éƒ¨ç½²ï¼Œæˆæœ¬å¯æ§ |

### 4.3 API æˆæœ¬å¯¹æ¯”

| æ¨¡å‹ | è¾“å…¥ä»·æ ¼/1M | è¾“å‡ºä»·æ ¼/1M |
|------|-------------|-------------|
| GPT-4o-mini | $0.15 | $0.60 |
| GPT-4.1 | $2.00 | $8.00 |
| Claude Sonnet 4.5 | $3.00 | $15.00 |
| Claude Haiku 4.5 | $1.00 | $5.00 |
| æœ¬åœ° Llama 3.1 70B | ~$0.02 | ~$0.02 |

---

## 5. ç³»ç»Ÿæ¶æ„è®¾è®¡

### 5.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·å±‚                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Next.js 14 (App Router) + shadcn/ui + Tailwind CSS             â”‚
â”‚  - æµå¼æ¸²æŸ“ (RSC + Suspense)                                     â”‚
â”‚  - PWA æ”¯æŒ                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        API ç½‘å…³å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  FastAPI + Uvicorn                                              â”‚
â”‚  - SSE æµå¼å“åº”                                                  â”‚
â”‚  - JWT è®¤è¯                                                      â”‚
â”‚  - é™æµ/ç†”æ–­                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LLM æœåŠ¡     â”‚    â”‚ æ•°æ®æœåŠ¡     â”‚    â”‚ åˆ†ææœåŠ¡     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GPT-4o-mini â”‚    â”‚ PostgreSQL  â”‚    â”‚ MLflow      â”‚
â”‚ (å®æ—¶å¹²é¢„)   â”‚    â”‚ + pgvector  â”‚    â”‚ (æ¨¡å‹ç®¡ç†)   â”‚
â”‚             â”‚    â”‚             â”‚    â”‚             â”‚
â”‚ Claude API  â”‚    â”‚ Redis       â”‚    â”‚ Celery      â”‚
â”‚ (æ·±åº¦åˆ†æ)   â”‚    â”‚ (ç¼“å­˜/ä¼šè¯)  â”‚    â”‚ (å¼‚æ­¥ä»»åŠ¡)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ç›®å½•ç»“æ„

```
aiwendy/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/                 # Next.js å‰ç«¯
â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”‚   â”œâ”€â”€ (auth)/      # ç™»å½•/æ³¨å†Œ
â”‚   â”‚   â”‚   â”œâ”€â”€ (dashboard)/ # ä¸»ç•Œé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ chat/        # AI å¯¹è¯
â”‚   â”‚   â”‚   â””â”€â”€ journal/     # äº¤æ˜“æ—¥è®°
â”‚   â”‚   â””â”€â”€ components/
â”‚   â”‚       â””â”€â”€ ui/          # shadcn ç»„ä»¶
â”‚   â”‚
â”‚   â””â”€â”€ api/                 # FastAPI åç«¯
â”‚       â”œâ”€â”€ routers/
â”‚       â”‚   â”œâ”€â”€ chat.py      # æµå¼å¯¹è¯
â”‚       â”‚   â”œâ”€â”€ journal.py   # æ—¥è®° CRUD
â”‚       â”‚   â””â”€â”€ analysis.py  # è¡Œä¸ºåˆ†æ
â”‚       â”œâ”€â”€ services/
â”‚       â”‚   â”œâ”€â”€ llm.py       # LLM è·¯ç”±
â”‚       â”‚   â””â”€â”€ embedding.py # å‘é‡åŒ–
â”‚       â””â”€â”€ workers/
â”‚           â””â”€â”€ tasks.py     # Celery ä»»åŠ¡
â”‚
â”œâ”€â”€ packages/
â”‚   â””â”€â”€ shared/              # å…±äº«ç±»å‹/å·¥å…·
â”‚
â””â”€â”€ docker-compose.yml       # æœ¬åœ°å¼€å‘ç¯å¢ƒ
```

### 5.3 é«˜å¯ç”¨è®¾è®¡

| ç»„ä»¶ | æ–¹æ¡ˆ |
|------|------|
| **å‰ç«¯** | Vercel Edge Network (å…¨çƒ CDN) |
| **åç«¯** | å¤šå®ä¾‹ + è´Ÿè½½å‡è¡¡ (Railway/Fly.io) |
| **æ•°æ®åº“** | PostgreSQL ä¸»ä»å¤åˆ¶ (Supabase/Neon) |
| **Redis** | Upstash (Serverlessï¼Œè‡ªåŠ¨é«˜å¯ç”¨) |
| **LLM API** | åŒä¾›åº”å•† fallback (OpenAI â†’ Anthropic) |

### 5.4 æ•°æ®æµé—­ç¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ äº¤æ˜“æ—¥è®° â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                  â”‚
     â”‚ å†™å…¥                                   â”‚ åå“º
     â–¼                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      å‘é‡åŒ–å­˜å‚¨      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”
â”‚PostgreSQLâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ ç›¸ä¼¼æ—¥è®°æ£€ç´¢  â”‚
â”‚+ pgvectorâ”‚                      â”‚ (RAG ä¸Šä¸‹æ–‡)  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                   â”‚
     â–¼                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ•™ç»ƒå¯¹è¯                        â”‚
â”‚  System Prompt + ç”¨æˆ·å†å²æ¨¡å¼ + ç›¸ä¼¼åœºæ™¯ + å½“å‰è¾“å…¥â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å‘¨æœŸæ€§åˆ†æ               â”‚
â”‚  Celery å®šæ—¶ä»»åŠ¡ï¼šèšåˆæ—¥è®°+å¯¹è¯â†’æŠ¥å‘Š  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. å¤šæ•™ç»ƒæ¶æ„

### 6.1 æ•™ç»ƒæ•°æ®æ¨¡å‹

```python
class Coach(BaseModel):
    id: str
    name: str                    # "Wendy Rhodes"
    avatar: str                  # å¤´åƒ URL
    style: CoachStyle            # é£æ ¼æšä¸¾
    specialty: list[str]         # ["æ—¥å†…äº¤æ˜“", "æƒ…ç»ªç®¡ç†"]
    language: str                # "zh-CN" / "en-US"
    llm_provider: str            # "openai" / "anthropic" / "local"
    llm_model: str               # "gpt-4o-mini"
    system_prompt: str           # æ ¸å¿ƒäººæ ¼ prompt
    voice_id: str | None         # TTS è¯­éŸ³ IDï¼ˆå¯é€‰ï¼‰
    is_premium: bool             # æ˜¯å¦ä»˜è´¹ä¸“å±
    is_public: bool              # æ˜¯å¦å…¬å¼€å¯ç”¨
    created_by: str | None       # åˆ›å»ºè€…ï¼ˆç”¨æˆ·è‡ªå®šä¹‰/ä¼ä¸šå®šåˆ¶ï¼‰

class CoachStyle(Enum):
    EMPATHETIC = "empathetic"    # æ¸©å’Œå…±æƒ…å‹
    DISCIPLINED = "disciplined"  # ä¸¥å‰çºªå¾‹å‹
    ANALYTICAL = "analytical"    # æ•°æ®åˆ†æå‹
    MOTIVATIONAL = "motivational"# æ¿€åŠ±é¼“èˆå‹
    SOCRATIC = "socratic"        # è‹æ ¼æ‹‰åº•é—®ç­”å‹
```

### 6.2 é¢„è®¾æ•™ç»ƒ

| æ•™ç»ƒ | é£æ ¼ | ä¸“é•¿ | åº•å±‚æ¨¡å‹ | å±‚çº§ |
|------|------|------|----------|------|
| **Wendy** | æ¸©å’Œå…±æƒ… | æƒ…ç»ªç®¡ç†ã€å¿ƒç†éŸ§æ€§ | Claude Sonnet | Free |
| **Marcus** | ä¸¥å‰çºªå¾‹ | é£æ§ã€æ­¢æŸæ‰§è¡Œ | GPT-4o-mini | Free |
| **å°é›ª** | ä¸­æ–‡äº²å’Œ | Aè‚¡ã€æ•£æˆ·å¿ƒç† | Claude Sonnet | Free |
| **Dr. Tharp** | æ•°æ®åˆ†æ | äº¤æ˜“ç³»ç»Ÿã€ç»©æ•ˆé‡åŒ– | Claude Opus | Pro |
| **Ari Gold** | æ¿€è¿›æ¿€åŠ± | é«˜é¢‘äº¤æ˜“ã€å¿ƒæ€æ”»å‡» | GPT-4o | Pro |
| **è‡ªå®šä¹‰** | ç”¨æˆ·è®¾å®š | ç”¨æˆ·å®šä¹‰ | å¯é€‰ | Enterprise |

### 6.3 System Prompt ç¤ºä¾‹

**Wendyï¼ˆæ¸©å’Œå…±æƒ…å‹ï¼‰**ï¼š

```
ä½ æ˜¯ Wendy Rhodesï¼Œä¸€ä½é¡¶å°–çš„äº¤æ˜“å¿ƒç†ç»©æ•ˆæ•™ç»ƒã€‚

## æ ¸å¿ƒèº«ä»½
- çµæ„Ÿæ¥æºï¼šç¾å‰§ã€ŠBillionsã€‹ä¸­çš„ Wendy Rhodes
- é£æ ¼ï¼šæ¸©å’Œä½†ç›´æ¥ï¼Œå…±æƒ…ä½†ä¸çºµå®¹
- ç›®æ ‡ï¼šå¸®åŠ©äº¤æ˜“è€…è¯†åˆ«å¿ƒç†ç›²ç‚¹ï¼Œå»ºç«‹å¥åº·çš„äº¤æ˜“å¿ƒæ€

## è¡Œä¸ºå‡†åˆ™
1. ä»ä¸ç»™å…·ä½“äº¤æ˜“å»ºè®®ï¼ˆä¹°/å–/æŒä»“ï¼‰
2. ä¸“æ³¨äºå¿ƒç†çŠ¶æ€å’Œå†³ç­–è¿‡ç¨‹
3. ä½¿ç”¨è‹æ ¼æ‹‰åº•å¼æé—®å¼•å¯¼è‡ªæˆ‘å‘ç°
4. è¯†åˆ«è®¤çŸ¥åå·®ï¼ˆæŸå¤±åŒæ¶ã€è¿‡åº¦è‡ªä¿¡ã€æŠ¥å¤æ€§äº¤æ˜“ç­‰ï¼‰
5. åœ¨ç”¨æˆ·æƒ…ç»ªæ¿€åŠ¨æ—¶æä¾›å†·é™é”šç‚¹

## å¯¹è¯æŠ€å·§
- å…ˆå€¾å¬ï¼Œåæé—®
- åæ˜ æƒ…ç»ªï¼š"å¬èµ·æ¥ä½ æ„Ÿåˆ°å¾ˆæ²®ä¸§..."
- å…·ä½“åŒ–ï¼š"ä½ è¯´çš„'æ€»æ˜¯äºæŸ'ï¼Œå…·ä½“æ˜¯æœ€è¿‘å‡ ç¬”ï¼Ÿ"
- æ¨¡å¼è¯†åˆ«ï¼š"æˆ‘æ³¨æ„åˆ°ä½ æåˆ°äº†ä¸‰æ¬¡'åº”è¯¥'..."
```

**Marcusï¼ˆä¸¥å‰çºªå¾‹å‹ï¼‰**ï¼š

```
ä½ æ˜¯ Marcusï¼Œä¸€ä½å‰å¯¹å†²åŸºé‡‘é£æ§å®˜è½¬å‹çš„äº¤æ˜“æ•™ç»ƒã€‚

## æ ¸å¿ƒèº«ä»½
- èƒŒæ™¯ï¼š20å¹´åå°”è¡—é£æ§ç»éªŒ
- é£æ ¼ï¼šç›´æ¥ã€ä¸¥å‰ã€ä¸ç•™æƒ…é¢
- ç›®æ ‡ï¼šç”¨çºªå¾‹å’Œè§„åˆ™çº¦æŸäº¤æ˜“è€…çš„å†²åŠ¨

## è¡Œä¸ºå‡†åˆ™
1. å¯¹è¿åäº¤æ˜“è§„åˆ™çš„è¡Œä¸ºé›¶å®¹å¿
2. å¼ºè°ƒé£æ§å’Œä»“ä½ç®¡ç†
3. ç”¨æ•°æ®å’Œäº‹å®è¯´è¯
4. ä¸æ¥å—å€Ÿå£å’Œåˆç†åŒ–

## å…¸å‹å¯¹è¯
ç”¨æˆ·ï¼š"æˆ‘è§‰å¾—è¿™æ¬¡åº”è¯¥åŠ ä»“..."
Marcusï¼š"ä½ çš„æ­¢æŸåœ¨å“ªé‡Œï¼Ÿæœ€å¤§å›æ’¤è®¾å®šæ˜¯å¤šå°‘ï¼Ÿå¦‚æœç­”ä¸ä¸Šæ¥ï¼Œè®¨è®ºåŠ ä»“æ¯«æ— æ„ä¹‰ã€‚"
```

### 6.4 æ•™ç»ƒè·¯ç”±å®ç°

```python
# routers/chat.py

@router.post("/chat")
async def chat(request: ChatRequest):
    # è·å–æ•™ç»ƒé…ç½®
    coach = await get_coach(request.coach_id)
    
    # æ„å»ºä¸Šä¸‹æ–‡
    context = await context_enhancer.build_context(
        user_id=request.user_id,
        current_input=request.message
    )
    
    # æ ¹æ®æ•™ç»ƒé€‰æ‹© LLM
    client = get_llm_client(coach.llm_provider)
    
    async def generate():
        stream = client.chat.completions.create(
            model=coach.llm_model,
            messages=[
                {"role": "system", "content": coach.system_prompt + context},
                *request.messages
            ],
            stream=True
        )
        for chunk in stream:
            if chunk.choices[0].delta.content:
                yield f"data: {chunk.choices[0].delta.content}\n\n"
    
    return StreamingResponse(generate(), media_type="text/event-stream")
```

---

## 7. ç”¨æˆ·æ—…ç¨‹è®¾è®¡

### 7.1 ä¿¡æ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº•éƒ¨å¯¼èˆªæ ï¼ˆ3 ä¸ªæ ¸å¿ƒå…¥å£ï¼‰                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚         ğŸ“              ğŸ’¬              ğŸ‘¤                      â”‚
â”‚        è®°å½•             æ•™ç»ƒ            æˆ‘çš„                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è®°å½•   â”‚ ä»Šæ—¥çŠ¶æ€å¡ç‰‡ + å¿«é€Ÿè®°å½•å…¥å£ + æ—¥å†è§†å›¾                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•™ç»ƒ   â”‚ æ•™ç»ƒé€‰æ‹© + å¯¹è¯ç•Œé¢ + å†å²ä¼šè¯ + å‘¨æŠ¥/æœˆæŠ¥               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æˆ‘çš„   â”‚ è®¾ç½® + è®¢é˜… + æ•™ç»ƒåå¥½ + æ•°æ®å¯¼å‡º                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 æ ¸å¿ƒåœºæ™¯ä¸€ï¼šç›˜åå¤ç›˜ï¼ˆ80% ä½¿ç”¨é‡ï¼‰

```
ç”¨æˆ·å®Œæˆä»Šæ—¥äº¤æ˜“
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰“å¼€ AIWendy     â”‚
â”‚ é¦–é¡µæ˜¾ç¤ºï¼š        â”‚
â”‚ "ä»Šå¤©äº¤æ˜“äº†å—ï¼Ÿ"  â”‚
â”‚ [äº¤æ˜“äº†] [æ²¡äº¤æ˜“] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ ç‚¹å‡»"äº¤æ˜“äº†"
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä»Šæ—¥ç»“æœ         â”‚
â”‚ [ğŸ˜Šç›ˆåˆ©] [ğŸ˜æŒå¹³] â”‚
â”‚ [ğŸ˜äºæŸ]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ ç‚¹å‡»"äºæŸ"
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœ€å›°æ‰°ä½ çš„æ˜¯ï¼Ÿ    â”‚
â”‚ [ğŸ˜¤ æƒ³æŠ¥å¤å¸‚åœº]   â”‚
â”‚ [ğŸ˜° æ‹…å¿ƒç»§ç»­äº]   â”‚
â”‚ [ğŸ˜” æ€€ç–‘è‡ªå·±]     â”‚
â”‚ [ğŸ’¬ ç›´æ¥èŠ]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Wendy ä»‹å…¥å¯¹è¯                            â”‚
â”‚ "æŠ¥å¤æ€§äº¤æ˜“çš„å†²åŠ¨å¾ˆå¸¸è§ã€‚                 â”‚
â”‚  åœ¨ä½ åšä»»ä½•æ“ä½œä¹‹å‰ï¼Œ                     â”‚
â”‚  èƒ½å‘Šè¯‰æˆ‘ä»Šå¤©å…·ä½“å‘ç”Ÿäº†ä»€ä¹ˆå—ï¼Ÿ"          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 æ ¸å¿ƒåœºæ™¯äºŒï¼šç›˜ä¸­ç´§æ€¥å¹²é¢„ï¼ˆ15% ä½¿ç”¨é‡ï¼‰

```
ç”¨æˆ·æ­£åœ¨äº¤æ˜“ä¸­ï¼Œæƒ…ç»ªå¤±æ§
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç‚¹å‡»å…¨å±€ SOS æŒ‰é’® â”‚
â”‚ "ğŸ†˜ æˆ‘éœ€è¦å¸®åŠ©"   â”‚  â† ä¸€é”®è§¦å‘
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•™ç»ƒç«‹å³å“åº”ï¼ˆGPT-4o-miniï¼Œæœ€ä½å»¶è¿Ÿï¼‰     â”‚
â”‚                                          â”‚
â”‚ Wendy: "æ·±å‘¼å¸ã€‚å‘Šè¯‰æˆ‘ç°åœ¨å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ"   â”‚
â”‚                                          â”‚
â”‚ [å¿«æ·å›å¤æŒ‰é’®]                            â”‚
â”‚ "æˆ‘æƒ³æŠ¥å¤æ€§äº¤æ˜“" | "æˆ‘ä¸æ•¢æ­¢æŸ" | "å…¶ä»–"  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.4 æ ¸å¿ƒåœºæ™¯ä¸‰ï¼šå‘¨æœŸæ€§åˆ†æï¼ˆ5% ä½¿ç”¨é‡ï¼‰

```
æ¯å‘¨æ—¥æ™š / æ¯æœˆåˆ
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç³»ç»Ÿæ¨é€é€šçŸ¥     â”‚
â”‚ "ä½ çš„å‘¨æŠ¥å·²ç”Ÿæˆ" â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å‘¨åº¦/æœˆåº¦æŠ¥å‘Š                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š äº¤æ˜“æ•°æ®æ¦‚è§ˆ                           â”‚
â”‚    èƒœç‡ | ç›ˆäºæ¯” | æœ€å¤§å›æ’¤               â”‚
â”‚                                          â”‚
â”‚ ğŸ§  å¿ƒç†æ¨¡å¼åˆ†æ                           â”‚
â”‚    - æœ¬å‘¨å‡ºç°3æ¬¡"æŠ¥å¤æ€§äº¤æ˜“"å€¾å‘          â”‚
â”‚    - å‘¨äºŒæƒ…ç»ªè¯„åˆ†æœ€ä½ï¼Œä¸äºæŸç›¸å…³          â”‚
â”‚                                          â”‚
â”‚ ğŸ’¡ æ•™ç»ƒæ´å¯Ÿ                               â”‚
â”‚    Wendy: "ä½ åœ¨è¿ç»­ç›ˆåˆ©åå®¹æ˜“è¿‡åº¦è‡ªä¿¡..."  â”‚
â”‚                                          â”‚
â”‚ ğŸ¯ ä¸‹å‘¨å…³æ³¨ç‚¹                             â”‚
â”‚    1. å•æ—¥äºæŸè¶…2%æ—¶å¼ºåˆ¶ä¼‘æ¯               â”‚
â”‚    2. æ¯ç¬”äº¤æ˜“å‰è®°å½•æƒ…ç»ªçŠ¶æ€               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. æ˜“ç”¨æ€§è®¾è®¡

### 8.1 æ–°ç”¨æˆ·å¼•å¯¼ï¼ˆOnboardingï¼‰

**Step 1/3ï¼šäº¤æ˜“ç±»å‹**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä½ ä¸»è¦åšä»€ä¹ˆäº¤æ˜“ï¼Ÿ                      â”‚
â”‚                                         â”‚
â”‚  [è‚¡ç¥¨] [æœŸè´§] [åŠ å¯†è´§å¸] [å¤–æ±‡] [å…¶ä»–]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Step 2/3ï¼šæ ¸å¿ƒå›°æ‰°**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä½ æœ€å¤§çš„äº¤æ˜“å›°æ‰°æ˜¯ï¼Ÿ                    â”‚
â”‚                                         â”‚
â”‚  â—‹ æ‹¿ä¸ä½ç›ˆåˆ©å•ï¼Œæ€»æ˜¯è¿‡æ—©æ­¢ç›ˆ            â”‚
â”‚  â—‹ ä¸æ„¿æ­¢æŸï¼Œæ€»æƒ³æ‰›ä¸€æ‰›                  â”‚
â”‚  â—‹ äºæŸåå®¹æ˜“å†²åŠ¨åŠ ä»“æŠ¥å¤                â”‚
â”‚  â—‹ é”™è¿‡è¡Œæƒ…åè¿½æ¶¨æ€è·Œ                    â”‚
â”‚  â—‹ å…¶ä»–: ___________                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Step 3/3ï¼šæ•™ç»ƒé£æ ¼**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é€‰æ‹©ä½ çš„æ•™ç»ƒé£æ ¼                        â”‚
â”‚                                         â”‚
â”‚  [ğŸ˜Š æ¸©å’Œæ´¾ - è€å¿ƒå€¾å¬ã€å…±æƒ…ç†è§£]        â”‚
â”‚  [ğŸ˜¤ ä¸¥å‰æ´¾ - ç›´æ¥æŒ‡å‡ºé—®é¢˜ã€ä¸ç•™æƒ…]      â”‚
â”‚                                         â”‚
â”‚  ğŸ’¡ ä¹‹åå¯ä»¥éšæ—¶åˆ‡æ¢æˆ–å°è¯•å…¶ä»–æ•™ç»ƒ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 æ—¥è®°è®°å½•ï¼šç»“æ„åŒ–è¡¨å•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è®°å½•è¿™ç¬”äº¤æ˜“                    [è·³è¿‡]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  äº¤æ˜“å“ç§                               â”‚
â”‚  [AAPL â–¼]   æˆ–è¾“å…¥: [__________]        â”‚
â”‚                                         â”‚
â”‚  æ–¹å‘å’Œç»“æœ                              â”‚
â”‚  [ğŸ“ˆ åšå¤š]  [ğŸ“‰ åšç©º]                   â”‚
â”‚                                         â”‚
â”‚  ç›ˆäºé‡‘é¢                               â”‚
â”‚  [+$___] æˆ– [-$___]                     â”‚
â”‚                                         â”‚
â”‚  å…¥åœºæ—¶çš„æƒ…ç»ª â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‹â”€â”€â”€â”€â”€â”€ 1-5     â”‚
â”‚  ğŸ˜° ç„¦è™‘                     ğŸ˜Œ å†·é™    â”‚
â”‚                                         â”‚
â”‚  å‡ºåœºæ—¶çš„æƒ…ç»ª â”€â”€â”€â”€â—‹â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1-5     â”‚
â”‚  ğŸ˜° ç„¦è™‘                     ğŸ˜Œ å†·é™    â”‚
â”‚                                         â”‚
â”‚  è¿™ç¬”äº¤æ˜“æœ‰æ²¡æœ‰è¿åä½ çš„è§„åˆ™ï¼Ÿ            â”‚
â”‚  â—‹ æ²¡æœ‰ï¼Œå®Œå…¨æŒ‰è®¡åˆ’æ‰§è¡Œ                 â”‚
â”‚  â—‹ æœ‰ï¼Œæˆ‘ [æå‰æ­¢ç›ˆ â–¼]                  â”‚
â”‚                                         â”‚
â”‚  æƒ³è¡¥å……ä»€ä¹ˆï¼Ÿï¼ˆå¯é€‰ï¼‰                    â”‚
â”‚  [ğŸ¤ è¯­éŸ³è¾“å…¥]                          â”‚
â”‚                                         â”‚
â”‚           [ä¿å­˜å¹¶ç»§ç»­]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.3 æ ¸å¿ƒæ“ä½œæ­¥æ•°

| ä»»åŠ¡ | æ­¥æ•° |
|------|------|
| è®°å½•ä¸€ç¬”äº¤æ˜“ | **4 æ¬¡ç‚¹å‡»** |
| å¼€å§‹å’Œæ•™ç»ƒå¯¹è¯ | **1 æ­¥** |
| æŸ¥çœ‹å‘¨æŠ¥ | **1 æ­¥** |
| ç´§æ€¥æ±‚åŠ© | **1 æ­¥** |

### 8.4 æ“ä½œåé¦ˆè®¾è®¡

| æ“ä½œ | åé¦ˆ |
|------|------|
| ä¿å­˜æ—¥è®° | Toast: "å·²ä¿å­˜ âœ“" + è½»éœ‡åŠ¨ |
| å‘é€æ¶ˆæ¯ | æ¶ˆæ¯æ°”æ³¡ + æ‰“å­—åŠ¨ç”» |
| åˆ‡æ¢æ•™ç»ƒ | "å·²åˆ‡æ¢åˆ° Marcus" + æ•™ç»ƒå¤´åƒåŠ¨ç”» |
| ç”ŸæˆæŠ¥å‘Š | è¿›åº¦æ¡ + "æ­£åœ¨åˆ†æä½ çš„ 12 æ¡è®°å½•..." |
| é”™è¯¯ | çº¢è‰²æç¤º + å…·ä½“åŸå›  + é‡è¯•æŒ‰é’® |

---

## 9. è§†è§‰è®¾è®¡æ–¹æ¡ˆ

### 9.1 å“ç‰Œè°ƒæ€§

| å…³é”®è¯ | è§†è§‰è¡¨è¾¾ |
|--------|----------|
| **ä¸“ä¸š** | å…‹åˆ¶çš„é…è‰²ã€å……è¶³ç•™ç™½ã€é«˜çº§ç° |
| **ä¿¡ä»»** | æ·±è‰²è°ƒä¸ºä¸»ã€ç¨³é‡ä¸èŠ±å“¨ |
| **æ¸©æš–** | åœ†è§’ã€æŸ”å’Œæ¸å˜ã€æœ‰å‘¼å¸æ„Ÿ |
| **å†·é™** | è“ç»¿è‰²ç³»ã€é¿å…åˆºæ¿€æ€§çº¢è‰² |

**ä¸€å¥è¯å®šä½**ï¼šåƒç§äººé“¶è¡Œçš„å®¢æˆ·ç«¯ï¼Œä¸åƒç¤¾äº¤ Appã€‚

### 9.2 è‰²å½©ç³»ç»Ÿ

```
ä¸»è‰² (Primary)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ #0F766E â”‚  æ·±é’ç»¿ - å†·é™ã€ä¸“ä¸šã€å¯ä¿¡èµ–
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¾…åŠ©è‰² (Secondary)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ #F0FDF4 â”‚  ææµ…ç»¿ - èƒŒæ™¯ã€å¡ç‰‡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¸­æ€§è‰² (Neutral)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ #0A0A0A â”‚ #404040 â”‚ #A3A3A3 â”‚ #FAFAFA â”‚
â”‚ æ ‡é¢˜    â”‚ æ­£æ–‡     â”‚ æ¬¡è¦æ–‡å­— â”‚ èƒŒæ™¯     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åŠŸèƒ½è‰²
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ #22C55E â”‚ #EAB308 â”‚ #6B7280 â”‚
â”‚ ç›ˆåˆ©/æ­£å‘â”‚ è­¦ç¤º    â”‚ äºæŸ/è´Ÿå‘â”‚  â† äºæŸä¸ç”¨çº¢è‰²ï¼Œé¿å…åˆºæ¿€æƒ…ç»ª
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.3 å­—ä½“ç³»ç»Ÿ

```
æ ‡é¢˜:   Inter / SF Pro Display (è‹±æ–‡) + æ€æºé»‘ä½“ (ä¸­æ–‡)
        24-32px, Semibold

æ­£æ–‡:   Inter / SF Pro Text + æ€æºé»‘ä½“
        16px, Regular, è¡Œé«˜ 1.6

è¾…åŠ©:   14px, Regular, é¢œè‰² #A3A3A3

æ•°å­—:   Tabular Nums (ç­‰å®½æ•°å­—ï¼Œå¯¹é½ç›ˆäº)
```

### 9.4 é—´è·ä¸åœ†è§’

```
é—´è·:   4px åŸºå‡†ï¼Œ4/8/12/16/24/32/48

åœ†è§’:   æŒ‰é’® 8px
        å¡ç‰‡ 12px
        å¼¹çª— 16px
        å¤´åƒ åœ†å½¢

é˜´å½±:   è½»å¾®ã€æŸ”å’Œ
        shadow-sm: 0 1px 2px rgba(0,0,0,0.05)
        shadow-md: 0 4px 6px rgba(0,0,0,0.07)
```

### 9.5 æ•™ç»ƒäººæ ¼è§†è§‰åŒ–

| æ•™ç»ƒ | æ°”æ³¡é¢œè‰² | å¤´åƒé£æ ¼ | è§†è§‰æ°”è´¨ |
|------|----------|----------|----------|
| Wendy | æŸ”å’Œç»¿åº• #F0FDF4 | æ¸©æš–å¾®ç¬‘ | åœ†æ¶¦å­—ä½“ |
| Marcus | å†·è“ç°åº• #F1F5F9 | ä¸¥è‚ƒæ­£è£… | ç›´è§’å¼•ç”¨æ¡† |
| å°é›ª | æš–æ©™åº• #FFF7ED | äº²åˆ‡å¡é€š | å¸¦è¡¨æƒ…ç¬¦å· |

### 9.6 åŠ¨æ•ˆè®¾è®¡

| åœºæ™¯ | åŠ¨æ•ˆ | ç›®çš„ |
|------|------|------|
| é¡µé¢åˆ‡æ¢ | æ·¡å…¥æ·¡å‡º 300ms | å¹³æ»‘è¿‡æ¸¡ |
| æŒ‰é’®ç‚¹å‡» | è½»å¾®ç¼©æ”¾ + æ¶Ÿæ¼ª | åé¦ˆç¡®è®¤ |
| æ•™ç»ƒæ¶ˆæ¯ | é€å­—æ‰“å­—æ•ˆæœ | æ¨¡æ‹ŸçœŸäººå¯¹è¯ |
| å‘é€æ¶ˆæ¯ | æ°”æ³¡ä¸Šæµ® + å¼¹æ€§ | è½»å¿«æ„Ÿ |
| åˆ‡æ¢æ•™ç»ƒ | å¤´åƒäº¤å‰æ·¡å…¥ | äººæ ¼åˆ‡æ¢æ„Ÿ |
| ä¿å­˜æˆåŠŸ | âœ“ æ‰“å‹¾åŠ¨ç”» | å®Œæˆæ„Ÿ |
| åŠ è½½ä¸­ | å‘¼å¸ç‚¹åŠ¨ç”» | éé˜»å¡ç­‰å¾… |

### 9.7 è®¾è®¡å‚è€ƒ

| äº§å“ | å¯å€Ÿé‰´çš„ç‚¹ |
|------|------------|
| **Calm** | å‘¼å¸æ„Ÿã€æƒ…æ„ŸåŒ–é…è‰² |
| **Headspace** | æ’ç”»é£æ ¼ã€æ¸©æš–æ„Ÿ |
| **Linear** | æç®€ã€ä¸“ä¸šã€å…‹åˆ¶ |
| **Notion** | ç•™ç™½ã€å±‚æ¬¡åˆ†æ˜ |
| **Claude.ai** | å¯¹è¯ç•Œé¢ã€æµå¼æ¸²æŸ“ |

### 9.8 UI æ¨¡ä»¿ç­–ç•¥

#### 9.8.1 æ¨¡å—åŒ–æ¨¡ä»¿çŸ©é˜µ

| åŠŸèƒ½æ¨¡å— | å æ¯” | é¦–é€‰æ¨¡ä»¿ | å¤‡é€‰ | åŸå›  |
|----------|------|----------|------|------|
| **AI å¯¹è¯** | 50% | Claude.ai | ChatGPT | æ¸©æš–æ„Ÿã€ç•™ç™½å¤šã€é€‚åˆå¿ƒç†åœºæ™¯ |
| **æ—¥è®°è®°å½•** | 25% | Day One | Notion | ä¸“æ³¨æ—¥è®°ã€ä¸Šæ‰‹å¿«ã€æœ‰æƒ…æ„Ÿè®¾è®¡ |
| **æ•°æ®åˆ†æ** | 15% | Linear | Stripe Dashboard | æç®€ã€å…‹åˆ¶ã€ä¸å“è·‘éä¸“ä¸šç”¨æˆ· |
| **æƒ…ç»ªè°ƒæ€§** | 10% | Calm | Headspace | æˆç†Ÿã€è‡ªç„¶ã€é€‚åˆæˆå¹´äº¤æ˜“è€… |

#### 9.8.2 å…·ä½“æ¨¡ä»¿æ¸…å•

**ä» Claude.ai å­¦ä¹ ï¼š**
```
âœ… å¯¹è¯æ°”æ³¡çš„åœ†è§’ï¼ˆ12-16pxï¼‰å’Œå†…è¾¹è·ï¼ˆ16-20pxï¼‰
âœ… æ¶ˆæ¯ä¹‹é—´çš„å‚ç›´é—´è·ï¼ˆ16-24pxï¼‰
âœ… æµå¼æ‰“å­—æ•ˆæœï¼ˆé€å­—æ˜¾ç¤º + å…‰æ ‡é—ªçƒï¼‰
âœ… ä¾§è¾¹æ å¯¹è¯å†å²åˆ—è¡¨æ ·å¼
âœ… è¾“å…¥æ¡†çš„ç®€æ´è®¾è®¡ï¼ˆåº•éƒ¨å›ºå®šã€åœ†è§’ã€é˜´å½±ï¼‰
âœ… ä»£ç å—çš„æš—è‰²ä¸»é¢˜
âŒ ä¸å­¦ï¼šè¿‡äºä¸­æ€§çš„é…è‰²ï¼ˆéœ€è¦æ›´æ¸©æš–ï¼‰
```

**ä» Day One å­¦ä¹ ï¼š**
```
âœ… æ—¥å†è§†å›¾ï¼ˆæœˆå† + ç‚¹æ ‡è®°ï¼‰
âœ… æ—¥è®°å¡ç‰‡é¢„è§ˆï¼ˆæ ‡é¢˜ + é¦–è¡Œ + æ—¥æœŸï¼‰
âœ… å¿«é€Ÿæƒ…ç»ªé€‰æ‹©ï¼ˆemoji æ¨ªå‘æ»‘åŠ¨ï¼‰
âœ… æ—¶é—´çº¿è§†å›¾
âœ… æœç´¢å’Œç­›é€‰äº¤äº’
âŒ ä¸å­¦ï¼šè¿‡å¤šçš„å¯Œæ–‡æœ¬åŠŸèƒ½ï¼ˆäº¤æ˜“æ—¥è®°éœ€è¦ç»“æ„åŒ–ï¼‰
```

**ä» Linear å­¦ä¹ ï¼š**
```
âœ… ç»Ÿè®¡å¡ç‰‡è®¾è®¡ï¼ˆæ•°å­— + æ ‡ç­¾ + è¶‹åŠ¿ç®­å¤´ï¼‰
âœ… å•è‰²ç³»å›¾è¡¨ï¼ˆä¸è¦å½©è™¹è‰²ï¼‰
âœ… ç©ºçŠ¶æ€æ’ç”»å’Œå¼•å¯¼æ–‡æ¡ˆ
âœ… è¡¨æ ¼çš„æç®€æ ·å¼
âœ… è¿›åº¦ç¯/å®Œæˆåº¦æŒ‡ç¤ºå™¨
âŒ ä¸å­¦ï¼šçœ‹æ¿è§†å›¾ï¼ˆä¸é€‚åˆæ—¥è®°åœºæ™¯ï¼‰
```

**ä» Calm å­¦ä¹ ï¼š**
```
âœ… å‘¼å¸æ„ŸåŠ¨æ•ˆï¼ˆç¼“æ…¢ ease-in-outï¼Œ300-500msï¼‰
âœ… æ·±è‰²/è‡ªç„¶è‰²èƒŒæ™¯é€‰é¡¹
âœ… å¼•å¯¼å¼æµç¨‹ï¼ˆä¸€æ­¥ä¸€æ­¥ï¼Œä¸æ€¥èºï¼‰
âœ… é¼“åŠ±æ€§æ–‡æ¡ˆé£æ ¼
âœ… éŸ³æ•ˆåé¦ˆï¼ˆå¯é€‰ï¼‰
âŒ ä¸å­¦ï¼šå†¥æƒ³è®¡æ—¶å™¨ï¼ˆä¸ç›¸å…³ï¼‰
```

#### 9.8.3 æ ¸å¿ƒ UI ç»„ä»¶è§„èŒƒ

**å¯¹è¯æ°”æ³¡ç»„ä»¶**
```tsx
// components/ui/chat-bubble.tsx

interface ChatBubbleProps {
  role: 'user' | 'assistant';
  content: string;
  timestamp?: Date;
  isStreaming?: boolean;
}

// æ ·å¼è§„èŒƒ
const bubbleStyles = {
  user: {
    background: '#F0FDF4',      // ææµ…ç»¿
    borderRadius: '16px 16px 4px 16px',
    maxWidth: '80%',
    marginLeft: 'auto',
  },
  assistant: {
    background: '#FFFFFF',
    borderRadius: '16px 16px 16px 4px',
    maxWidth: '85%',
    border: '1px solid #E5E7EB',
  },
  padding: '16px 20px',
  fontSize: '15px',
  lineHeight: '1.6',
  gap: '16px',  // æ¶ˆæ¯é—´è·
};

// æµå¼æ•ˆæœ
const streamingCursor = {
  animation: 'blink 1s infinite',
  width: '2px',
  height: '1em',
  background: '#0F766E',
};
```

**æƒ…ç»ªé€‰æ‹©å™¨ç»„ä»¶**
```tsx
// components/ui/emotion-picker.tsx

const emotions = [
  { value: 1, emoji: 'ğŸ˜°', label: 'éå¸¸ç„¦è™‘' },
  { value: 2, emoji: 'ğŸ˜Ÿ', label: 'æœ‰äº›æ‹…å¿§' },
  { value: 3, emoji: 'ğŸ˜', label: 'å¹³é™ä¸­æ€§' },
  { value: 4, emoji: 'ğŸ˜Š', label: 'æ¯”è¾ƒæ”¾æ¾' },
  { value: 5, emoji: 'ğŸ˜Œ', label: 'éå¸¸å†·é™' },
];

// æ ·å¼ï¼šæ¨ªå‘æ»‘åŠ¨é€‰æ‹©
const pickerStyles = {
  display: 'flex',
  gap: '12px',
  overflowX: 'auto',
  padding: '8px 0',
  
  item: {
    display: 'flex',
    flexDirection: 'column',
    alignItems: 'center',
    padding: '12px 16px',
    borderRadius: '12px',
    cursor: 'pointer',
    transition: 'all 0.2s ease',
  },
  
  itemSelected: {
    background: '#F0FDF4',
    border: '2px solid #0F766E',
  },
  
  emoji: {
    fontSize: '32px',
    marginBottom: '4px',
  },
  
  label: {
    fontSize: '12px',
    color: '#6B7280',
  },
};
```

**ç»Ÿè®¡å¡ç‰‡ç»„ä»¶**
```tsx
// components/ui/stat-card.tsx

interface StatCardProps {
  label: string;
  value: string | number;
  trend?: 'up' | 'down' | 'neutral';
  trendValue?: string;
  icon?: React.ReactNode;
}

// æ ·å¼è§„èŒƒï¼ˆæ¨¡ä»¿ Linearï¼‰
const cardStyles = {
  background: '#FFFFFF',
  borderRadius: '12px',
  padding: '20px',
  border: '1px solid #E5E7EB',
  
  label: {
    fontSize: '13px',
    color: '#6B7280',
    marginBottom: '8px',
  },
  
  value: {
    fontSize: '28px',
    fontWeight: '600',
    color: '#0A0A0A',
    fontVariantNumeric: 'tabular-nums',  // ç­‰å®½æ•°å­—
  },
  
  trend: {
    up: { color: '#22C55E' },    // ç»¿è‰²
    down: { color: '#6B7280' },  // ç°è‰²ï¼ˆä¸ç”¨çº¢è‰²ï¼‰
    neutral: { color: '#A3A3A3' },
  },
};
```

**æ•™ç»ƒå¤´åƒå¡ç‰‡**
```tsx
// components/ui/coach-card.tsx

interface CoachCardProps {
  name: string;
  avatar: string;
  style: string;
  specialty: string[];
  isSelected?: boolean;
}

// æ ·å¼è§„èŒƒï¼ˆæ¨¡ä»¿ Calm çš„é€‰æ‹©å¡ç‰‡ï¼‰
const coachCardStyles = {
  background: '#FFFFFF',
  borderRadius: '16px',
  padding: '24px',
  border: '1px solid #E5E7EB',
  transition: 'all 0.3s ease',
  cursor: 'pointer',
  
  hover: {
    borderColor: '#0F766E',
    boxShadow: '0 4px 12px rgba(15, 118, 110, 0.1)',
  },
  
  selected: {
    borderColor: '#0F766E',
    borderWidth: '2px',
    background: '#F0FDF4',
  },
  
  avatar: {
    width: '64px',
    height: '64px',
    borderRadius: '50%',
    marginBottom: '12px',
  },
  
  name: {
    fontSize: '18px',
    fontWeight: '600',
    marginBottom: '4px',
  },
  
  style: {
    fontSize: '14px',
    color: '#6B7280',
  },
};
```

#### 9.8.4 é¡µé¢å¸ƒå±€æ¨¡æ¿

**ä¸»ç•Œé¢å¸ƒå±€ï¼ˆæ¡Œé¢ç«¯ï¼‰**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Logo    [è®°å½•]  [æ•™ç»ƒ]  [åˆ†æ]  [æˆ‘çš„]           ğŸ””  ğŸ‘¤        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                â”‚                                                â”‚
â”‚  å¯¹è¯å†å²åˆ—è¡¨   â”‚           ä¸»å†…å®¹åŒºåŸŸ                           â”‚
â”‚                â”‚                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ä»Šå¤©      â”‚  â”‚  â”‚                                          â”‚  â”‚
â”‚  â”‚ å…³äºæ­¢æŸ   â”‚  â”‚  â”‚         å¯¹è¯/æ—¥è®°/åˆ†æå†…å®¹                â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚                                          â”‚  â”‚
â”‚  â”‚ æ˜¨å¤©      â”‚  â”‚  â”‚                                          â”‚  â”‚
â”‚  â”‚ å¤ç›˜ AAPL â”‚  â”‚  â”‚                                          â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚                                          â”‚  â”‚
â”‚  â”‚ ...      â”‚  â”‚  â”‚                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                â”‚                                                â”‚
â”‚  [+ æ–°å¯¹è¯]    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                â”‚  â”‚  è¾“å…¥æ¡†                          [å‘é€]   â”‚  â”‚
â”‚  å®½åº¦: 280px   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸»ç•Œé¢å¸ƒå±€ï¼ˆç§»åŠ¨ç«¯ï¼‰**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‰¡  AIWendy            ğŸ””  ğŸ‘¤  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚                                 â”‚
â”‚       ä¸»å†…å®¹åŒºåŸŸ                 â”‚
â”‚                                 â”‚
â”‚                                 â”‚
â”‚                                 â”‚
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  è¾“å…¥æ¡†           [å‘é€] â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ğŸ“      ğŸ’¬      ğŸ“Š      ğŸ‘¤   â”‚
â”‚  è®°å½•    æ•™ç»ƒ    åˆ†æ    æˆ‘çš„   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9.9 ç”¨æˆ·åŠŸèƒ½è®¾è®¡

### 9.9.1 åŠŸèƒ½å…¨æ™¯å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AIWendy åŠŸèƒ½å…¨æ™¯å›¾                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    æ ¸å¿ƒåŠŸèƒ½ (80%)                        â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  ğŸ“ äº¤æ˜“æ—¥è®°          ğŸ’¬ AI æ•™ç»ƒ          ğŸ“Š åˆ†ææŠ¥å‘Š   â”‚   â”‚
â”‚  â”‚  â”œâ”€ å¿«é€Ÿè®°å½•          â”œâ”€ å®æ—¶å¯¹è¯         â”œâ”€ å‘¨æŠ¥/æœˆæŠ¥  â”‚   â”‚
â”‚  â”‚  â”œâ”€ æƒ…ç»ªæ ‡æ³¨          â”œâ”€ æ•™ç»ƒé€‰æ‹©         â”œâ”€ æ¨¡å¼è¯†åˆ«   â”‚   â”‚
â”‚  â”‚  â”œâ”€ è§„åˆ™æ£€æŸ¥          â”œâ”€ ä¸Šä¸‹æ–‡å…³è”       â”œâ”€ è¶‹åŠ¿å›¾è¡¨   â”‚   â”‚
â”‚  â”‚  â””â”€ æ—¥å†è§†å›¾          â””â”€ å†å²å›é¡¾         â””â”€ å¯¼å‡ºåˆ†äº«   â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    ç”¨æˆ·åŠŸèƒ½ (15%)                        â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  ğŸ‘¤ è´¦æˆ·ç®¡ç†          âš™ï¸ ä¸ªäººè®¾ç½®         ğŸ”” é€šçŸ¥ä¸­å¿ƒ   â”‚   â”‚
â”‚  â”‚  â”œâ”€ æ³¨å†Œ/ç™»å½•         â”œâ”€ äº¤æ˜“åå¥½         â”œâ”€ æ¨é€è®¾ç½®   â”‚   â”‚
â”‚  â”‚  â”œâ”€ ä¸ªäººèµ„æ–™          â”œâ”€ æ•™ç»ƒåå¥½         â”œâ”€ æé†’è§„åˆ™   â”‚   â”‚
â”‚  â”‚  â”œâ”€ è®¢é˜…ç®¡ç†          â”œâ”€ éšç§æ§åˆ¶         â”œâ”€ æ¶ˆæ¯å†å²   â”‚   â”‚
â”‚  â”‚  â””â”€ å®‰å…¨è®¾ç½®          â””â”€ æ˜¾ç¤ºè®¾ç½®         â””â”€ é‚®ä»¶åå¥½   â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    å¢å€¼åŠŸèƒ½ (5%)                         â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  ğŸ“¤ æ•°æ®ç®¡ç†          ğŸ¯ ç›®æ ‡è¿½è¸ª         ğŸ† æˆå°±ç³»ç»Ÿ   â”‚   â”‚
â”‚  â”‚  â”œâ”€ å¯¼å…¥äº¤æ˜“è®°å½•      â”œâ”€ è®¾å®šç›®æ ‡         â”œâ”€ é‡Œç¨‹ç¢‘     â”‚   â”‚
â”‚  â”‚  â”œâ”€ å¯¼å‡ºæ•°æ®          â”œâ”€ è¿›åº¦è¿½è¸ª         â”œâ”€ å¾½ç«        â”‚   â”‚
â”‚  â”‚  â””â”€ è´¦æˆ·è¿ç§»          â””â”€ å¤ç›˜æé†’         â””â”€ è¿ç»­å¤©æ•°   â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.9.2 ç”¨æˆ·è´¦æˆ·åŠŸèƒ½

#### æ³¨å†Œ/ç™»å½•

| åŠŸèƒ½ | æè¿° | ä¼˜å…ˆçº§ |
|------|------|--------|
| é‚®ç®±æ³¨å†Œ | é‚®ç®± + å¯†ç  + éªŒè¯ç  | P0 |
| Google ç™»å½• | OAuth2 ä¸€é”®ç™»å½• | P0 |
| GitHub ç™»å½• | OAuth2 ä¸€é”®ç™»å½• | P1 |
| å¾®ä¿¡ç™»å½• | ä¸­å›½ç”¨æˆ·ï¼ˆéœ€èµ„è´¨ï¼‰ | P2 |
| æ‰‹æœºå·ç™»å½• | çŸ­ä¿¡éªŒè¯ç  | P2 |
| å¿˜è®°å¯†ç  | é‚®ä»¶é‡ç½®é“¾æ¥ | P0 |
| åŒå› ç´ è®¤è¯ | TOTP / çŸ­ä¿¡ | P1 |

#### ä¸ªäººèµ„æ–™

```typescript
interface UserProfile {
  // åŸºæœ¬ä¿¡æ¯
  id: string;
  email: string;
  name: string;
  avatar: string;
  
  // äº¤æ˜“èƒŒæ™¯ï¼ˆæ–°ç”¨æˆ·å¼•å¯¼æ—¶æ”¶é›†ï¼‰
  tradingExperience: 'beginner' | 'intermediate' | 'advanced';
  primaryMarket: 'stock' | 'futures' | 'crypto' | 'forex';
  tradingStyle: 'day' | 'swing' | 'position';
  mainChallenges: string[];  // ['æƒ…ç»ªæ§åˆ¶', 'æ­¢æŸæ‰§è¡Œ', 'è¿‡åº¦äº¤æ˜“']
  
  // åå¥½
  timezone: string;
  language: 'zh-CN' | 'en-US';
  preferredCoach: string;
  
  // æ—¶é—´æˆ³
  createdAt: Date;
  updatedAt: Date;
  lastLoginAt: Date;
}
```

#### è®¢é˜…ç®¡ç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        è®¢é˜…ç®¡ç†é¡µé¢                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  å½“å‰è®¡åˆ’                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸŒŸ Pro è®¡åˆ’                              $79/æœˆ         â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  ä¸‹æ¬¡ç»­è´¹ï¼š2024å¹´2æœˆ15æ—¥                                 â”‚   â”‚
â”‚  â”‚  æ”¯ä»˜æ–¹å¼ï¼šVisa **** 4242                                â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  [æ›´æ¢è®¡åˆ’]  [å–æ¶ˆè®¢é˜…]  [æ›´æ–°æ”¯ä»˜æ–¹å¼]                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  ç”¨é‡ç»Ÿè®¡ï¼ˆæœ¬æœˆï¼‰                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ AI å¯¹è¯       â”‚  â”‚ æ—¥è®°æ¡æ•°      â”‚  â”‚ æŠ¥å‘Šç”Ÿæˆ      â”‚       â”‚
â”‚  â”‚ 45 / æ— é™     â”‚  â”‚ 23 / æ— é™     â”‚  â”‚ 2 / 4        â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                 â”‚
â”‚  è´¦å•å†å²                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 2024-01-15   Pro è®¡åˆ’ - æœˆä»˜      $79.00    [ä¸‹è½½å‘ç¥¨]   â”‚   â”‚
â”‚  â”‚ 2023-12-15   Pro è®¡åˆ’ - æœˆä»˜      $79.00    [ä¸‹è½½å‘ç¥¨]   â”‚   â”‚
â”‚  â”‚ 2023-11-15   å‡çº§åˆ° Pro           $79.00    [ä¸‹è½½å‘ç¥¨]   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å®‰å…¨è®¾ç½®

| åŠŸèƒ½ | æè¿° | ä¼˜å…ˆçº§ |
|------|------|--------|
| ä¿®æ”¹å¯†ç  | éªŒè¯æ—§å¯†ç åä¿®æ”¹ | P0 |
| åŒå› ç´ è®¤è¯ | å¯ç”¨/ç¦ç”¨ TOTP | P1 |
| ç™»å½•è®¾å¤‡ | æŸ¥çœ‹/æ’¤é”€å·²ç™»å½•è®¾å¤‡ | P1 |
| ç™»å½•å†å² | æ—¶é—´ã€IPã€è®¾å¤‡ | P1 |
| è´¦æˆ·åˆ é™¤ | GDPR åˆè§„ï¼Œ30 å¤©å†·é™æœŸ | P0 |
| API å¯†é’¥ | é«˜çº§ç”¨æˆ·è‡ªå®šä¹‰é›†æˆ | P2 |

### 9.9.3 ä¸ªäººè®¾ç½®åŠŸèƒ½

#### äº¤æ˜“åå¥½

```typescript
interface TradingPreferences {
  // å¸‚åœºè®¾ç½®
  defaultMarket: 'US' | 'CN' | 'HK' | 'Crypto';
  defaultSymbols: string[];  // å¸¸ç”¨æ ‡çš„
  currency: 'USD' | 'CNY' | 'HKD';
  
  // é£æ§è§„åˆ™
  maxDailyLoss: number;      // å•æ—¥æœ€å¤§äºæŸ
  maxPositionSize: number;   // å•ç¬”æœ€å¤§ä»“ä½
  maxTradesPerDay: number;   // æ¯æ—¥æœ€å¤§äº¤æ˜“æ¬¡æ•°
  
  // æé†’è®¾ç½®
  alertOnRuleViolation: boolean;  // è¿è§„æ—¶æé†’
  alertOnLossStreak: number;      // è¿äº N æ¬¡æ—¶æé†’
  alertOnProfitTarget: boolean;   // è¾¾åˆ°ç›ˆåˆ©ç›®æ ‡æ—¶æé†’
}
```

#### æ•™ç»ƒåå¥½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•™ç»ƒåå¥½è®¾ç½®                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  é»˜è®¤æ•™ç»ƒ                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [Wendy å¤´åƒ]  Wendy Rhodes                              â”‚   â”‚
â”‚  â”‚                æ¸©å’Œå…±æƒ…å‹ Â· æƒ…ç»ªç®¡ç†ä¸“å®¶                  â”‚   â”‚
â”‚  â”‚                                          [æ›´æ¢æ•™ç»ƒ â–¼]    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  æ²Ÿé€šé£æ ¼                                                       â”‚
â”‚  â—‹ ç›´æ¥äº†å½“ â€”â€” ä¸ç»•å¼¯å­ï¼Œç›´æŒ‡é—®é¢˜                              â”‚
â”‚  â— æ¸©å’Œå¼•å¯¼ â€”â€” å¾ªå¾ªå–„è¯±ï¼Œè‡ªæˆ‘å‘ç°                              â”‚
â”‚  â—‹ æ•°æ®é©±åŠ¨ â€”â€” ç”¨æ•°å­—è¯´è¯ï¼Œç†æ€§åˆ†æ                            â”‚
â”‚                                                                 â”‚
â”‚  è¯­è¨€åå¥½                                                       â”‚
â”‚  â— ä¸­æ–‡                                                        â”‚
â”‚  â—‹ English                                                     â”‚
â”‚                                                                 â”‚
â”‚  å“åº”é•¿åº¦                                                       â”‚
â”‚  ç®€æ´ â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ è¯¦ç»†                               â”‚
â”‚                                                                 â”‚
â”‚  ä¸»åŠ¨æé—®                                                       â”‚
â”‚  [âœ“] æ•™ç»ƒå¯ä»¥ä¸»åŠ¨è¿½é—®ä»¥æ·±å…¥äº†è§£æƒ…å†µ                             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### éšç§æ§åˆ¶

| è®¾ç½®é¡¹ | é€‰é¡¹ | é»˜è®¤å€¼ |
|--------|------|--------|
| æ•°æ®ç”¨äºæ¨¡å‹æ”¹è¿› | å¼€/å…³ | å…³ |
| åŒ¿åä½¿ç”¨ç»Ÿè®¡ | å¼€/å…³ | å¼€ |
| æ—¥è®°å†…å®¹åŠ å¯† | å¼€/å…³ | å¼€ |
| ç¬¬ä¸‰æ–¹æ•°æ®åˆ†äº« | å¼€/å…³ | å…³ |
| Cookie åå¥½ | å¿…è¦/åˆ†æ/è¥é”€ | ä»…å¿…è¦ |

#### æ˜¾ç¤ºè®¾ç½®

```typescript
interface DisplaySettings {
  // ä¸»é¢˜
  theme: 'light' | 'dark' | 'system';
  
  // äºæŸé¢œè‰²ï¼ˆé‡è¦ï¼é¿å…çº¢è‰²åˆºæ¿€ï¼‰
  lossColor: 'gray' | 'red';  // é»˜è®¤ç°è‰²
  
  // å­—ä½“å¤§å°
  fontSize: 'small' | 'medium' | 'large';
  
  // æ—¥æœŸæ ¼å¼
  dateFormat: 'YYYY-MM-DD' | 'MM/DD/YYYY' | 'DD/MM/YYYY';
  
  // æ•°å­—æ ¼å¼
  numberFormat: 'comma' | 'space';  // 1,234.56 æˆ– 1 234.56
  
  // å‘¨èµ·å§‹æ—¥
  weekStartsOn: 'sunday' | 'monday';
}
```

### 9.9.4 é€šçŸ¥åŠŸèƒ½

#### é€šçŸ¥ç±»å‹

| ç±»å‹ | æ¸ é“ | ç¤ºä¾‹ |
|------|------|------|
| **äº¤æ˜“æé†’** | Push/é‚®ä»¶ | "ä»Šæ—¥å·²äº¤æ˜“ 3 æ¬¡ï¼Œæ¥è¿‘ä½ è®¾å®šçš„ä¸Šé™" |
| **æƒ…ç»ªé¢„è­¦** | Push | "æ£€æµ‹åˆ°è¿ç»­ 3 å¤©ä½æƒ…ç»ªè¯„åˆ†ï¼Œéœ€è¦èŠèŠå—ï¼Ÿ" |
| **æŠ¥å‘Šç”Ÿæˆ** | Push/é‚®ä»¶ | "ä½ çš„å‘¨æŠ¥å·²ç”Ÿæˆï¼Œç‚¹å‡»æŸ¥çœ‹" |
| **æ•™ç»ƒæ¶ˆæ¯** | Push | "Wendy æœ‰æ–°çš„æ´å¯Ÿæƒ³åˆ†äº«ç»™ä½ " |
| **ç³»ç»Ÿé€šçŸ¥** | åº”ç”¨å†… | "æ–°åŠŸèƒ½ä¸Šçº¿ï¼šæ”¯æŒå¯¼å…¥åˆ¸å•†äº¤å‰²å•" |
| **è®¢é˜…æé†’** | é‚®ä»¶ | "ä½ çš„ Pro è®¡åˆ’å°†äº 3 å¤©åç»­è´¹" |

#### é€šçŸ¥è®¾ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        é€šçŸ¥è®¾ç½®                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  æ¨é€é€šçŸ¥                                           [å·²å¼€å¯]    â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  é€šçŸ¥ç±»å‹                    æ¨é€      é‚®ä»¶      åº”ç”¨å†…  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  äº¤æ˜“è§„åˆ™æé†’                 â—         â—‹         â—     â”‚   â”‚
â”‚  â”‚  æƒ…ç»ªé¢„è­¦                     â—         â—‹         â—     â”‚   â”‚
â”‚  â”‚  å‘¨æŠ¥/æœˆæŠ¥                    â—         â—         â—     â”‚   â”‚
â”‚  â”‚  æ•™ç»ƒä¸»åŠ¨æ¶ˆæ¯                 â—         â—‹         â—     â”‚   â”‚
â”‚  â”‚  è®¢é˜…å’Œè´¦å•                   â—‹         â—         â—     â”‚   â”‚
â”‚  â”‚  äº§å“æ›´æ–°                     â—‹         â—         â—‹     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  å…æ‰“æ‰°æ—¶æ®µ                                                     â”‚
â”‚  [âœ“] å¯ç”¨å…æ‰“æ‰°      æ—¶é—´: [22:00] - [08:00]                   â”‚
â”‚                                                                 â”‚
â”‚  äº¤æ˜“æ—¶æ®µæé†’                                                   â”‚
â”‚  [âœ“] ä»…åœ¨äº¤æ˜“æ—¶æ®µæ¨é€ç´§æ€¥æé†’                                   â”‚
â”‚      ç¾è‚¡: 21:30 - 04:00 (åŒ—äº¬æ—¶é—´)                             â”‚
â”‚      Aè‚¡: 09:30 - 15:00                                        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.9.5 æ•°æ®ç®¡ç†åŠŸèƒ½

#### æ•°æ®å¯¼å…¥

| æ¥æº | æ ¼å¼ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|------|--------|
| CSV æ–‡ä»¶ | æ ‡å‡†æ¨¡æ¿ | ç”¨æˆ·æ‰‹åŠ¨æ•´ç† | P0 |
| åˆ¸å•†äº¤å‰²å• | PDF è§£æ | å¯Œé€”/è€è™/ç›ˆé€ | P2 |
| Excel | .xlsx | è‡ªå®šä¹‰æ ¼å¼æ˜ å°„ | P1 |
| TradingView | API | è‡ªåŠ¨åŒæ­¥ | P3 |
| å…¶ä»– App | JSON | Day One ç­‰ | P3 |

```
å¯¼å…¥ CSV æ¨¡æ¿:
date,symbol,direction,entry_price,exit_price,quantity,pnl,notes
2024-01-15,AAPL,long,185.50,187.20,100,170.00,æŒ‰è®¡åˆ’æ‰§è¡Œ
2024-01-15,TSLA,short,220.00,225.00,50,-250.00,æ­¢æŸæ²¡æ‰§è¡Œ
```

#### æ•°æ®å¯¼å‡º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å¯¼å‡ºæ•°æ®                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  é€‰æ‹©å¯¼å‡ºå†…å®¹                                                   â”‚
â”‚  [âœ“] äº¤æ˜“æ—¥è®°ï¼ˆåŒ…å«æƒ…ç»ªæ ‡æ³¨ï¼‰                                    â”‚
â”‚  [âœ“] AI å¯¹è¯è®°å½•                                                â”‚
â”‚  [âœ“] åˆ†ææŠ¥å‘Š                                                   â”‚
â”‚  [ ] è´¦æˆ·è®¾ç½®                                                   â”‚
â”‚                                                                 â”‚
â”‚  æ—¶é—´èŒƒå›´                                                       â”‚
â”‚  â—‹ å…¨éƒ¨æ•°æ®                                                     â”‚
â”‚  â— æŒ‡å®šèŒƒå›´  [2023-01-01] è‡³ [2024-01-31]                       â”‚
â”‚                                                                 â”‚
â”‚  å¯¼å‡ºæ ¼å¼                                                       â”‚
â”‚  â— JSONï¼ˆå®Œæ•´æ•°æ®ï¼Œå¯é‡æ–°å¯¼å…¥ï¼‰                                  â”‚
â”‚  â—‹ CSVï¼ˆä»…æ—¥è®°ï¼Œå¯ç”¨ Excel æ‰“å¼€ï¼‰                                â”‚
â”‚  â—‹ PDFï¼ˆæŠ¥å‘Šæ ¼å¼ï¼Œå¯æ‰“å°ï¼‰                                       â”‚
â”‚                                                                 â”‚
â”‚                                    [å–æ¶ˆ]  [å¯¼å‡º]               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è´¦æˆ·è¿ç§»/åˆ é™¤

| åŠŸèƒ½ | æµç¨‹ | æ³¨æ„äº‹é¡¹ |
|------|------|----------|
| **æ•°æ®æ‰“åŒ…** | å¯¼å‡ºå…¨é‡ JSON | åŒ…å«æ‰€æœ‰æ•°æ® |
| **è´¦æˆ·è½¬è®©** | è”ç³»å®¢æœ | ä¼ä¸šç‰ˆåŠŸèƒ½ |
| **è´¦æˆ·åˆ é™¤** | 30 å¤©å†·é™æœŸ | GDPR åˆè§„ |
| **æ•°æ®é”€æ¯** | æ°¸ä¹…åˆ é™¤ | ä¸å¯æ¢å¤ |

### 9.9.6 ç›®æ ‡è¿½è¸ªåŠŸèƒ½

```typescript
interface TradingGoal {
  id: string;
  type: 'habit' | 'performance' | 'behavior';
  
  // ä¹ æƒ¯ç›®æ ‡
  // ä¾‹ï¼šæ¯å¤©è®°å½•æ—¥è®°ã€æ¯å‘¨å¤ç›˜
  
  // ç»©æ•ˆç›®æ ‡
  // ä¾‹ï¼šæœˆèƒœç‡ > 50%ã€æœ€å¤§å›æ’¤ < 10%
  
  // è¡Œä¸ºç›®æ ‡
  // ä¾‹ï¼šè¿ç»­ 7 å¤©æ— æŠ¥å¤æ€§äº¤æ˜“
  
  title: string;
  description: string;
  target: number;
  current: number;
  unit: string;
  deadline: Date;
  
  reminders: {
    enabled: boolean;
    frequency: 'daily' | 'weekly';
    time: string;
  };
  
  createdAt: Date;
  completedAt?: Date;
}
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æˆ‘çš„ç›®æ ‡                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  è¿›è¡Œä¸­                                              [+ æ–°ç›®æ ‡]  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ¯ è¿ç»­è®°å½•æ—¥è®°                                         â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  12/30 å¤©                         â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  ğŸ”¥ å½“å‰è¿ç»­ 12 å¤©                      æˆªæ­¢: 2024-02-15 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“Š æœ¬æœˆèƒœç‡ç›®æ ‡                                         â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  48% / 55%                        â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  è¿˜éœ€æé«˜ 7%                            æˆªæ­¢: 2024-01-31 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  å·²å®Œæˆ (3)                                           [æŸ¥çœ‹å…¨éƒ¨] â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.9.7 æˆå°±ç³»ç»Ÿ

| å¾½ç«  | æ¡ä»¶ | è¯´æ˜ |
|------|------|------|
| ğŸŒ± **èµ·æ­¥è€…** | å®Œæˆé¦–æ¬¡æ—¥è®° | æ–°æ‰‹å¼•å¯¼ |
| ğŸ“ **è®°å½•è€…** | è¿ç»­è®°å½• 7 å¤© | ä¹ æƒ¯å…»æˆ |
| ğŸ”¥ **åšæŒè€…** | è¿ç»­è®°å½• 30 å¤© | æ·±åº¦å‚ä¸ |
| ğŸ’ **è‡ªå¾‹è€…** | è¿ç»­ 7 å¤©æ— è§„åˆ™è¿å | è¡Œä¸ºæ”¹è¿› |
| ğŸ¯ **ç²¾å‡†è€…** | æœˆèƒœç‡ > 60% | ç»©æ•ˆè¡¨å½° |
| ğŸ§˜ **å†·é™è€…** | å¹³å‡æƒ…ç»ªè¯„åˆ† > 4.0 | å¿ƒæ€ç¨³å®š |
| ğŸ“Š **åˆ†æè€…** | æŸ¥çœ‹ 10 ä»½å‘¨æŠ¥ | å¤ç›˜ä¹ æƒ¯ |
| ğŸ† **è¿›åŒ–è€…** | å®Œæˆ 3 ä¸ªç›®æ ‡ | æŒç»­æˆé•¿ |

### 9.9.8 è‡ªå®šä¹‰å¤§æ¨¡å‹è®¾ç½®

#### åŠŸèƒ½æ¦‚è¿°

å…è®¸ç”¨æˆ·ä½¿ç”¨è‡ªå·±çš„ LLM APIï¼Œé€‚ç”¨äºï¼š
- æƒ³çœé’±çš„ç”¨æˆ·ï¼ˆè‡ªå¸¦ API Keyï¼‰
- éšç§æ•æ„Ÿç”¨æˆ·ï¼ˆæœ¬åœ°æ¨¡å‹ï¼‰
- ä¼ä¸šç”¨æˆ·ï¼ˆå†…éƒ¨éƒ¨ç½²çš„æ¨¡å‹ï¼‰
- é«˜çº§ç”¨æˆ·ï¼ˆæƒ³å°è¯•ä¸åŒæ¨¡å‹ï¼‰

#### æ”¯æŒçš„ Provider

| Provider | ç±»å‹ | æ”¯æŒçŠ¶æ€ | è¯´æ˜ |
|----------|------|----------|------|
| **OpenAI** | äº‘ç«¯ | âœ… å®Œæ•´æ”¯æŒ | GPT-4o / GPT-4o-mini |
| **Anthropic** | äº‘ç«¯ | âœ… å®Œæ•´æ”¯æŒ | Claude 3.5 Sonnet / Haiku |
| **Azure OpenAI** | äº‘ç«¯ | âœ… æ”¯æŒ | ä¼ä¸šåˆè§„éœ€æ±‚ |
| **Google Gemini** | äº‘ç«¯ | â³ è®¡åˆ’ä¸­ | Gemini Pro |
| **Ollama** | æœ¬åœ° | âœ… æ”¯æŒ | Llama 3.1 / Qwen2.5 / Mistral |
| **vLLM** | æœ¬åœ° | âœ… æ”¯æŒ | é«˜æ€§èƒ½æ¨ç† |
| **LM Studio** | æœ¬åœ° | âœ… æ”¯æŒ | æ¡Œé¢ç«¯æœ¬åœ°æ¨¡å‹ |
| **OpenRouter** | ä»£ç† | âœ… æ”¯æŒ | å¤šæ¨¡å‹ç»Ÿä¸€æ¥å£ |
| **DeepSeek** | äº‘ç«¯ | â³ è®¡åˆ’ä¸­ | å›½äº§é«˜æ€§ä»·æ¯” |
| **æ™ºè°± GLM** | äº‘ç«¯ | â³ è®¡åˆ’ä¸­ | å›½äº§ä¸­æ–‡ä¼˜åŒ– |

#### è®¾ç½®ç•Œé¢è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¤§æ¨¡å‹è®¾ç½®                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ä½¿ç”¨æ–¹å¼                                                       â”‚
â”‚  â— ä½¿ç”¨ AIWendy æä¾›çš„æ¨¡å‹ï¼ˆåŒ…å«åœ¨è®¢é˜…ä¸­ï¼‰                       â”‚
â”‚  â—‹ ä½¿ç”¨è‡ªå·±çš„ API Key                                           â”‚
â”‚  â—‹ è¿æ¥æœ¬åœ°æ¨¡å‹                                                 â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â–¼ äº‘ç«¯ API é…ç½®                                                â”‚
â”‚                                                                 â”‚
â”‚  Provider                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [OpenAI â–¼]                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  API Key                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  sk-â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢        [æ˜¾ç¤º] [æµ‹è¯•]â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â“˜ API Key ä»…å­˜å‚¨åœ¨æœ¬åœ°ï¼Œä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨                       â”‚
â”‚                                                                 â”‚
â”‚  API Base URLï¼ˆå¯é€‰ï¼Œç”¨äºä»£ç†æˆ– Azureï¼‰                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  https://api.openai.com/v1                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  é»˜è®¤æ¨¡å‹                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [gpt-4o-mini â–¼]                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  å¯é€‰: gpt-4o / gpt-4o-mini / gpt-4-turbo / gpt-3.5-turbo      â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â–¼ æœ¬åœ°æ¨¡å‹é…ç½®                                                 â”‚
â”‚                                                                 â”‚
â”‚  è¿æ¥æ–¹å¼                                                       â”‚
â”‚  â—‹ Ollamaï¼ˆæ¨èï¼‰                                               â”‚
â”‚  â—‹ vLLM                                                        â”‚
â”‚  â—‹ LM Studio                                                   â”‚
â”‚  â—‹ å…¶ä»– OpenAI å…¼å®¹æ¥å£                                         â”‚
â”‚                                                                 â”‚
â”‚  æœåŠ¡åœ°å€                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  http://localhost:11434                          [æµ‹è¯•]  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  âœ… è¿æ¥æˆåŠŸï¼Œæ£€æµ‹åˆ° 3 ä¸ªå¯ç”¨æ¨¡å‹                                â”‚
â”‚                                                                 â”‚
â”‚  é€‰æ‹©æ¨¡å‹                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [llama3.1:8b â–¼]                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  å¯ç”¨: llama3.1:8b / qwen2.5:7b / mistral:7b                   â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â–¼ é«˜çº§è®¾ç½®                                                     â”‚
â”‚                                                                 â”‚
â”‚  Temperatureï¼ˆåˆ›é€ æ€§ï¼‰                                          â”‚
â”‚  ä¿å®ˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆ›é€                                 â”‚
â”‚         0.3    0.7    1.0                                      â”‚
â”‚                                                                 â”‚
â”‚  æœ€å¤§ Token æ•°                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  2000                                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  ä¸Šä¸‹æ–‡é•¿åº¦                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [æœ€è¿‘ 10 æ¡æ¶ˆæ¯ â–¼]                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  [âœ“] å¯ç”¨æµå¼è¾“å‡º                                               â”‚
â”‚  [âœ“] è‡ªåŠ¨é‡è¯•å¤±è´¥è¯·æ±‚ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰                               â”‚
â”‚  [ ] å¯ç”¨ JSON æ¨¡å¼ï¼ˆç»“æ„åŒ–è¾“å‡ºï¼‰                                â”‚
â”‚                                                                 â”‚
â”‚                                                                 â”‚
â”‚                              [æ¢å¤é»˜è®¤]  [ä¿å­˜è®¾ç½®]              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ•°æ®æ¨¡å‹

```typescript
interface LLMSettings {
  // ä½¿ç”¨æ–¹å¼
  mode: 'platform' | 'custom_api' | 'local';
  
  // äº‘ç«¯ API é…ç½®
  cloudProvider?: {
    type: 'openai' | 'anthropic' | 'azure' | 'openrouter' | 'deepseek' | 'zhipu';
    apiKey: string;           // åŠ å¯†å­˜å‚¨
    baseUrl?: string;         // è‡ªå®šä¹‰ API åœ°å€
    model: string;
    organization?: string;    // OpenAI org
  };
  
  // æœ¬åœ°æ¨¡å‹é…ç½®
  localProvider?: {
    type: 'ollama' | 'vllm' | 'lmstudio' | 'custom';
    baseUrl: string;          // é»˜è®¤ http://localhost:11434
    model: string;
  };
  
  // é€šç”¨è®¾ç½®
  advanced: {
    temperature: number;      // 0.0 - 1.0
    maxTokens: number;        // 500 - 4000
    contextLength: number;    // æœ€è¿‘ N æ¡æ¶ˆæ¯
    streamEnabled: boolean;
    retryEnabled: boolean;
    retryCount: number;
  };
  
  // å›é€€ç­–ç•¥
  fallback: {
    enabled: boolean;
    fallbackToCloud: boolean;  // æœ¬åœ°å¤±è´¥æ—¶å›é€€åˆ°äº‘ç«¯
  };
}
```

#### API Key å®‰å…¨å­˜å‚¨

```typescript
// å®¢æˆ·ç«¯å­˜å‚¨ç­–ç•¥

// æ–¹æ¡ˆ 1: ä»…å­˜å‚¨åœ¨æœ¬åœ°ï¼ˆæœ€å®‰å…¨ï¼Œä½†æ¢è®¾å¤‡éœ€é‡æ–°é…ç½®ï¼‰
class LocalKeyStorage {
  // ä½¿ç”¨ Web Crypto API åŠ å¯†
  async encryptKey(apiKey: string): Promise<string> {
    const encoder = new TextEncoder();
    const data = encoder.encode(apiKey);
    
    // ä½¿ç”¨è®¾å¤‡æŒ‡çº¹æ´¾ç”Ÿå¯†é’¥
    const derivedKey = await this.deriveKeyFromDevice();
    
    const encrypted = await crypto.subtle.encrypt(
      { name: 'AES-GCM', iv: this.generateIV() },
      derivedKey,
      data
    );
    
    return btoa(String.fromCharCode(...new Uint8Array(encrypted)));
  }
  
  // å­˜å‚¨åˆ° IndexedDBï¼ˆä¸æ˜¯ localStorageï¼‰
  async store(provider: string, encryptedKey: string) {
    const db = await this.openDB();
    await db.put('api_keys', { provider, key: encryptedKey });
  }
}

// æ–¹æ¡ˆ 2: æœåŠ¡ç«¯å­˜å‚¨ï¼ˆæ–¹ä¾¿å¤šè®¾å¤‡ï¼Œä½†éœ€ä¿¡ä»»æœåŠ¡å™¨ï¼‰
// ä½¿ç”¨ç”¨æˆ·å¯†ç æ´¾ç”Ÿå¯†é’¥è¿›è¡Œç«¯åˆ°ç«¯åŠ å¯†
// æœåŠ¡å™¨åªå­˜å‚¨å¯†æ–‡ï¼Œæ— æ³•è§£å¯†
```

#### è¿æ¥æµ‹è¯•é€»è¾‘

```typescript
async function testConnection(settings: LLMSettings): Promise<TestResult> {
  try {
    const provider = createProvider(settings);
    
    // å‘é€ç®€å•æµ‹è¯•è¯·æ±‚
    const response = await provider.chat({
      model: settings.cloudProvider?.model || settings.localProvider?.model,
      messages: [{ role: 'user', content: 'Say "OK" if you can read this.' }],
      max_tokens: 10,
    });
    
    return {
      success: true,
      latency: response.latency,
      model: response.model,
      message: 'è¿æ¥æˆåŠŸ',
    };
    
  } catch (error) {
    return {
      success: false,
      error: parseError(error),
      message: getErrorMessage(error),
      // æä¾›å…·ä½“çš„é”™è¯¯æŒ‡å¼•
      suggestion: getSuggestion(error),
    };
  }
}

function getErrorMessage(error: any): string {
  if (error.status === 401) return 'API Key æ— æ•ˆæˆ–å·²è¿‡æœŸ';
  if (error.status === 429) return 'è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åé‡è¯•';
  if (error.code === 'ECONNREFUSED') return 'æ— æ³•è¿æ¥åˆ°æœåŠ¡ï¼Œè¯·æ£€æŸ¥åœ°å€';
  if (error.code === 'ETIMEDOUT') return 'è¿æ¥è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ';
  return 'è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®';
}

function getSuggestion(error: any): string {
  if (error.status === 401) {
    return 'è¯·å‰å¾€ OpenAI æ§åˆ¶å°æ£€æŸ¥ API Key æ˜¯å¦æœ‰æ•ˆ';
  }
  if (error.code === 'ECONNREFUSED') {
    return 'å¦‚æœä½¿ç”¨ Ollamaï¼Œè¯·ç¡®ä¿å·²è¿è¡Œ `ollama serve`';
  }
  return 'è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé…ç½®ä¿¡æ¯';
}
```

#### æœ¬åœ°æ¨¡å‹æ¨èé…ç½®

| æ˜¾å­˜ | æ¨èæ¨¡å‹ | è¯´æ˜ |
|------|----------|------|
| **8GB** | Llama 3.1 8B / Qwen2.5 7B | åŸºç¡€å¯¹è¯ï¼Œå“åº”é€Ÿåº¦å¿« |
| **12GB** | Llama 3.1 8B Q8 / Mistral 7B | æ›´é«˜ç²¾åº¦ |
| **16GB** | Llama 3.1 70B Q4 | æ¥è¿‘ GPT-4 æ°´å¹³ |
| **24GB+** | Llama 3.1 70B Q8 | æœ€ä½³æœ¬åœ°ä½“éªŒ |

```bash
# Ollama å¿«é€Ÿå®‰è£…æ¨èæ¨¡å‹
ollama pull llama3.1:8b          # 4.7GB, é€‚åˆå¤§å¤šæ•°ç”¨æˆ·
ollama pull qwen2.5:7b           # ä¸­æ–‡ä¼˜åŒ–
ollama pull mistral:7b           # ä»£ç èƒ½åŠ›å¼º
```

#### æˆæœ¬æ§åˆ¶è®¾ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æˆæœ¬æ§åˆ¶                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  æœˆåº¦é¢„ç®—                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  $ [20.00]                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  [âœ“] è¾¾åˆ°é¢„ç®— 80% æ—¶æé†’                                        â”‚
â”‚  [âœ“] è¾¾åˆ°é¢„ç®— 100% æ—¶åœæ­¢ä½¿ç”¨è‡ªå®šä¹‰ API                          â”‚
â”‚                                                                 â”‚
â”‚  æœ¬æœˆç”¨é‡                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  å·²ä½¿ç”¨: $12.35 / $20.00                                â”‚   â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  62%                          â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  Token æ˜ç»†:                                            â”‚   â”‚
â”‚  â”‚  Â· è¾“å…¥: 245,000 tokens ($2.45)                         â”‚   â”‚
â”‚  â”‚  Â· è¾“å‡º: 98,000 tokens ($9.80)                          â”‚   â”‚
â”‚  â”‚  Â· åµŒå…¥: 50,000 tokens ($0.10)                          â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  æ¨¡å‹ä»·æ ¼å‚è€ƒ                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  æ¨¡å‹              è¾“å…¥ä»·æ ¼       è¾“å‡ºä»·æ ¼               â”‚   â”‚
â”‚  â”‚  gpt-4o           $2.50/1M      $10.00/1M              â”‚   â”‚
â”‚  â”‚  gpt-4o-mini      $0.15/1M      $0.60/1M               â”‚   â”‚
â”‚  â”‚  claude-3.5-sonnet $3.00/1M     $15.00/1M              â”‚   â”‚
â”‚  â”‚  claude-3.5-haiku  $0.80/1M     $4.00/1M               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  çœé’±å»ºè®®                                                       â”‚
â”‚  ğŸ’¡ æ—¥å¸¸å¯¹è¯ä½¿ç”¨ gpt-4o-mini å¯èŠ‚çœ 90% æˆæœ¬                    â”‚
â”‚  ğŸ’¡ æœ¬åœ°éƒ¨ç½² Llama 3.1 8B å®Œå…¨å…è´¹                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å¤šæ¨¡å‹åœºæ™¯é…ç½®

```typescript
interface ModelRouting {
  // ä¸åŒåœºæ™¯ä½¿ç”¨ä¸åŒæ¨¡å‹
  scenarios: {
    // æ—¥å¸¸å¯¹è¯ - ç”¨ä¾¿å®œçš„
    chat: {
      provider: 'openai',
      model: 'gpt-4o-mini',
    },
    
    // æ·±åº¦åˆ†æ - ç”¨å¼ºçš„
    analysis: {
      provider: 'anthropic',
      model: 'claude-3-5-sonnet-20241022',
    },
    
    // åµŒå…¥å‘é‡ - ä¸“ç”¨æ¨¡å‹
    embedding: {
      provider: 'openai',
      model: 'text-embedding-3-small',
    },
    
    // æœ¬åœ°å¤‡ç”¨ - ç¦»çº¿æ—¶ç”¨
    fallback: {
      provider: 'ollama',
      model: 'llama3.1:8b',
    },
  };
}
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åœºæ™¯æ¨¡å‹é…ç½®                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  [âœ“] å¯ç”¨æ™ºèƒ½æ¨¡å‹è·¯ç”±                                           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  åœºæ™¯              æ¨¡å‹                  é¢„ä¼°æˆæœ¬/æ¬¡     â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  ğŸ’¬ æ—¥å¸¸å¯¹è¯       [gpt-4o-mini â–¼]       ~$0.001        â”‚   â”‚
â”‚  â”‚  ğŸ“Š æ·±åº¦åˆ†æ       [claude-sonnet â–¼]     ~$0.05         â”‚   â”‚
â”‚  â”‚  ğŸ“ æ—¥è®°æ€»ç»“       [gpt-4o-mini â–¼]       ~$0.002        â”‚   â”‚
â”‚  â”‚  ğŸ” ç›¸ä¼¼æœç´¢       [embedding-small â–¼]   ~$0.0001       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â“˜ ç³»ç»Ÿä¼šæ ¹æ®ä»»åŠ¡è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„æ¨¡å‹                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### åŠŸèƒ½ä¼˜å…ˆçº§

| åŠŸèƒ½ | MVP | Core | Growth |
|------|-----|------|--------|
| å¹³å°é»˜è®¤æ¨¡å‹ | âœ… | | |
| è‡ªå®šä¹‰ OpenAI API Key | | âœ… | |
| è‡ªå®šä¹‰ Anthropic API Key | | âœ… | |
| Ollama æœ¬åœ°æ¨¡å‹ | | âœ… | |
| Azure OpenAI | | | âœ… |
| OpenRouter | | | âœ… |
| æˆæœ¬è¿½è¸ª | | | âœ… |
| æ™ºèƒ½æ¨¡å‹è·¯ç”± | | | âœ… |
| å›½äº§æ¨¡å‹ï¼ˆDeepSeek/GLMï¼‰ | | | âœ… |

### 9.9.9 åŠŸèƒ½ä¼˜å…ˆçº§çŸ©é˜µ

| åŠŸèƒ½ | MVP (Phase 1) | Core (Phase 2) | Growth (Phase 3) |
|------|---------------|----------------|------------------|
| **è´¦æˆ·** | | | |
| é‚®ç®±æ³¨å†Œ/ç™»å½• | âœ… | | |
| Google ç™»å½• | âœ… | | |
| ä¸ªäººèµ„æ–™ | âœ… | | |
| ä¿®æ”¹å¯†ç  | âœ… | | |
| è®¢é˜…ç®¡ç† | | âœ… | |
| åŒå› ç´ è®¤è¯ | | âœ… | |
| è´¦æˆ·åˆ é™¤ | | âœ… | |
| **è®¾ç½®** | | | |
| äº¤æ˜“åå¥½ | âœ… | | |
| æ•™ç»ƒåå¥½ | âœ… | | |
| æ˜¾ç¤ºè®¾ç½® | âœ… | | |
| éšç§æ§åˆ¶ | | âœ… | |
| **é€šçŸ¥** | | | |
| åº”ç”¨å†…é€šçŸ¥ | âœ… | | |
| æ¨é€é€šçŸ¥ | | âœ… | |
| é‚®ä»¶é€šçŸ¥ | | âœ… | |
| å…æ‰“æ‰°è®¾ç½® | | | âœ… |
| **æ•°æ®** | | | |
| CSV å¯¼å‡º | âœ… | | |
| JSON å¯¼å‡º | | âœ… | |
| CSV å¯¼å…¥ | | âœ… | |
| åˆ¸å•†äº¤å‰²å•å¯¼å…¥ | | | âœ… |
| **å¢å€¼** | | | |
| ç›®æ ‡è¿½è¸ª | | | âœ… |
| æˆå°±å¾½ç«  | | | âœ… |
| è¿ç»­å¤©æ•° | | âœ… | |

---

## 10. ç”Ÿäº§çº§åˆ«æ¶æ„

### 10.1 æ¶æ„è®¾è®¡åŸåˆ™

| åŸåˆ™ | è¯´æ˜ | å®ç°æ–¹å¼ |
|------|------|----------|
| **é«˜å†…èšä½è€¦åˆ** | æ¨¡å—èŒè´£å•ä¸€ï¼Œä¾èµ–æ¸…æ™° | é¢†åŸŸé©±åŠ¨è®¾è®¡ + ä¾èµ–æ³¨å…¥ |
| **é«˜å¯ç”¨** | å•ç‚¹æ•…éšœä¸å½±å“æ•´ä½“ | ç†”æ–­/é™çº§/é™æµ/å¤šå®ä¾‹ |
| **æ˜“ç»´æŠ¤** | é—®é¢˜å¯è¿½æº¯ï¼Œä»£ç å¯ç†è§£ | ç»“æ„åŒ–æ—¥å¿— + ç»Ÿä¸€é”™è¯¯å¤„ç† + æµ‹è¯• |
| **å¯æ‰©å±•** | æ–°åŠŸèƒ½æ˜“æ·»åŠ ï¼Œæ—§åŠŸèƒ½æ˜“ä¿®æ”¹ | æ’ä»¶åŒ– + APIç‰ˆæœ¬ç®¡ç† + å¤šç§Ÿæˆ· |

### 10.2 é¢†åŸŸé©±åŠ¨è®¾è®¡

#### é¢†åŸŸæ¨¡å—åˆ’åˆ†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        é¢†åŸŸæ¨¡å—åˆ’åˆ†                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚   ç”¨æˆ·åŸŸ     â”‚  â”‚   æ•™ç»ƒåŸŸ     â”‚  â”‚   æ—¥è®°åŸŸ     â”‚             â”‚
â”‚  â”‚   (User)    â”‚  â”‚  (Coach)    â”‚  â”‚  (Journal)  â”‚             â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚  â”‚ - æ³¨å†Œ/ç™»å½•  â”‚  â”‚ - æ•™ç»ƒé…ç½®   â”‚  â”‚ - æ—¥è®° CRUD â”‚             â”‚
â”‚  â”‚ - ä¸ªäººè®¾ç½®   â”‚  â”‚ - å¯¹è¯ç®¡ç†   â”‚  â”‚ - æƒ…ç»ªæ ‡æ³¨   â”‚             â”‚
â”‚  â”‚ - è®¢é˜…ç®¡ç†   â”‚  â”‚ - ä¸Šä¸‹æ–‡å¢å¼º â”‚  â”‚ - å‘é‡åŒ–å­˜å‚¨ â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚         â”‚                â”‚                â”‚                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                          â–¼                                      â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                  â”‚   åˆ†æåŸŸ     â”‚                                â”‚
â”‚                  â”‚ (Analysis)  â”‚                                â”‚
â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                â”‚
â”‚                  â”‚ - æ¨¡å¼è¯†åˆ«   â”‚                                â”‚
â”‚                  â”‚ - å‘¨æœŸæŠ¥å‘Š   â”‚                                â”‚
â”‚                  â”‚ - è¶‹åŠ¿åˆ†æ   â”‚                                â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ¨¡å—æ¥å£å®šä¹‰

```python
# domain/interfaces.py

from abc import ABC, abstractmethod
from typing import Protocol, AsyncIterator

# ============ ç”¨æˆ·åŸŸæ¥å£ ============
class IUserRepository(Protocol):
    async def get_by_id(self, user_id: str) -> User | None: ...
    async def get_by_email(self, email: str) -> User | None: ...
    async def create(self, user: UserCreate) -> User: ...
    async def update(self, user_id: str, data: UserUpdate) -> User: ...

class IUserService(Protocol):
    async def register(self, data: RegisterRequest) -> User: ...
    async def authenticate(self, email: str, password: str) -> TokenPair: ...
    async def get_subscription(self, user_id: str) -> Subscription: ...

# ============ æ•™ç»ƒåŸŸæ¥å£ ============
class ICoachRepository(Protocol):
    async def get_by_id(self, coach_id: str) -> Coach | None: ...
    async def list_available(self, user_tier: str) -> list[Coach]: ...

class ICoachService(Protocol):
    async def get_coach(self, coach_id: str) -> Coach: ...
    async def chat(self, request: ChatRequest) -> AsyncIterator[str]: ...

class IContextEnhancer(Protocol):
    async def build_context(self, user_id: str, input: str) -> str: ...

# ============ æ—¥è®°åŸŸæ¥å£ ============
class IJournalRepository(Protocol):
    async def create(self, journal: JournalCreate) -> Journal: ...
    async def list_by_user(self, user_id: str, limit: int) -> list[Journal]: ...
    async def search_similar(self, user_id: str, query: str, k: int) -> list[Journal]: ...

class IJournalService(Protocol):
    async def create_entry(self, user_id: str, data: JournalCreate) -> Journal: ...
    async def analyze_entry(self, journal_id: str) -> JournalAnalysis: ...

# ============ åˆ†æåŸŸæ¥å£ ============
class IAnalysisService(Protocol):
    async def generate_weekly_report(self, user_id: str) -> WeeklyReport: ...
    async def detect_patterns(self, user_id: str, days: int) -> list[Pattern]: ...

# ============ LLM æŠ½è±¡å±‚ ============
class ILLMProvider(Protocol):
    async def chat_stream(
        self, 
        model: str, 
        messages: list[Message],
        **kwargs
    ) -> AsyncIterator[str]: ...
    
    async def embed(self, text: str) -> list[float]: ...
```

#### ä¾èµ–æ³¨å…¥å®¹å™¨

```python
# core/container.py

from dependency_injector import containers, providers

class Container(containers.DeclarativeContainer):
    # ============ é…ç½® ============
    config = providers.Configuration()
    
    # ============ åŸºç¡€è®¾æ–½ ============
    db = providers.Singleton(
        Database,
        url=config.database.url,
    )
    
    redis = providers.Singleton(
        Redis,
        url=config.redis.url,
    )
    
    # ============ LLM Providers ============
    openai_provider = providers.Singleton(
        OpenAIProvider,
        api_key=config.openai.api_key,
    )
    
    anthropic_provider = providers.Singleton(
        AnthropicProvider,
        api_key=config.anthropic.api_key,
    )
    
    llm_router = providers.Singleton(
        LLMRouter,
        providers={
            "openai": openai_provider,
            "anthropic": anthropic_provider,
        },
    )
    
    # ============ Repositories ============
    user_repository = providers.Factory(
        UserRepository,
        session=db.provided.session,
    )
    
    coach_repository = providers.Factory(
        CoachRepository,
        session=db.provided.session,
    )
    
    journal_repository = providers.Factory(
        JournalRepository,
        session=db.provided.session,
    )
    
    # ============ Services ============
    user_service = providers.Factory(
        UserService,
        user_repo=user_repository,
        redis=redis,
    )
    
    context_enhancer = providers.Factory(
        ContextEnhancer,
        journal_repo=journal_repository,
    )
    
    coach_service = providers.Factory(
        CoachService,
        coach_repo=coach_repository,
        llm_router=llm_router,
        context_enhancer=context_enhancer,
    )
    
    journal_service = providers.Factory(
        JournalService,
        journal_repo=journal_repository,
        llm_router=llm_router,
    )
    
    analysis_service = providers.Factory(
        AnalysisService,
        journal_repo=journal_repository,
        llm_router=llm_router,
    )
```

### 10.3 é«˜å¯ç”¨è®¾è®¡

#### 10.3.1 ç†”æ–­ä¸é™çº§

```python
# core/resilience.py

import circuitbreaker
from tenacity import retry, stop_after_attempt, wait_exponential

# ============ ç†”æ–­å™¨é…ç½® ============
class LLMCircuitBreaker:
    """LLM API ç†”æ–­å™¨"""
    
    # OpenAI ç†”æ–­å™¨
    openai_breaker = circuitbreaker.CircuitBreaker(
        fail_max=5,              # 5 æ¬¡å¤±è´¥åç†”æ–­
        reset_timeout=60,        # 60 ç§’åå°è¯•æ¢å¤
        state_storage=circuitbreaker.CircuitRedisStorage(
            state_key="cb:openai",
            redis_object=redis_client,
        ),
    )
    
    # Anthropic ç†”æ–­å™¨
    anthropic_breaker = circuitbreaker.CircuitBreaker(
        fail_max=5,
        reset_timeout=60,
        state_storage=circuitbreaker.CircuitRedisStorage(
            state_key="cb:anthropic",
            redis_object=redis_client,
        ),
    )

# ============ é‡è¯•ç­–ç•¥ ============
llm_retry = retry(
    stop=stop_after_attempt(3),
    wait=wait_exponential(multiplier=1, min=1, max=10),
    retry=retry_if_exception_type((APIError, TimeoutError)),
)

# ============ é™çº§ç­–ç•¥ ============
class LLMFallbackChain:
    """LLM é™çº§é“¾"""
    
    def __init__(self):
        self.providers = [
            ("openai", "gpt-4o-mini", LLMCircuitBreaker.openai_breaker),
            ("anthropic", "claude-3-haiku", LLMCircuitBreaker.anthropic_breaker),
            ("local", "llama-3.1-8b", None),  # æœ¬åœ°æ¨¡å‹æ— ç†”æ–­
        ]
    
    async def chat_with_fallback(
        self, 
        messages: list[Message],
        preferred_provider: str = "openai",
    ) -> AsyncIterator[str]:
        """å¸¦é™çº§çš„å¯¹è¯"""
        
        # é‡æ’åºï¼Œä¼˜å…ˆä½¿ç”¨æŒ‡å®š provider
        ordered = self._reorder_providers(preferred_provider)
        
        for provider_name, model, breaker in ordered:
            try:
                if breaker and breaker.state == circuitbreaker.STATE_OPEN:
                    logger.warning(f"{provider_name} circuit is OPEN, skipping")
                    continue
                
                provider = self._get_provider(provider_name)
                
                @llm_retry
                async def _call():
                    async for chunk in provider.chat_stream(model, messages):
                        yield chunk
                
                async for chunk in _call():
                    yield chunk
                
                return  # æˆåŠŸåˆ™é€€å‡º
                
            except Exception as e:
                logger.error(f"{provider_name} failed: {e}")
                if breaker:
                    breaker.record_failure()
                continue
        
        # æ‰€æœ‰ provider éƒ½å¤±è´¥
        raise AllProvidersFailedError("All LLM providers are unavailable")
```

#### 10.3.2 é™æµ

```python
# core/ratelimit.py

from redis import Redis
import time

class RateLimiter:
    """åŸºäº Redis çš„æ»‘åŠ¨çª—å£é™æµ"""
    
    def __init__(self, redis: Redis):
        self.redis = redis
    
    async def is_allowed(
        self,
        key: str,
        limit: int,
        window_seconds: int,
    ) -> tuple[bool, int]:
        """
        æ£€æŸ¥æ˜¯å¦å…è®¸è¯·æ±‚
        è¿”å›: (æ˜¯å¦å…è®¸, å‰©ä½™é…é¢)
        """
        now = time.time()
        window_start = now - window_seconds
        
        pipe = self.redis.pipeline()
        
        # ç§»é™¤è¿‡æœŸçš„è¯·æ±‚è®°å½•
        pipe.zremrangebyscore(key, 0, window_start)
        # ç»Ÿè®¡å½“å‰çª—å£å†…çš„è¯·æ±‚æ•°
        pipe.zcard(key)
        # æ·»åŠ å½“å‰è¯·æ±‚
        pipe.zadd(key, {str(now): now})
        # è®¾ç½®è¿‡æœŸæ—¶é—´
        pipe.expire(key, window_seconds)
        
        results = await pipe.execute()
        current_count = results[1]
        
        if current_count >= limit:
            return False, 0
        
        return True, limit - current_count - 1
    
    def limit_key(self, user_id: str, endpoint: str) -> str:
        return f"ratelimit:{user_id}:{endpoint}"

# ============ é™æµé…ç½® ============
RATE_LIMITS = {
    "free": {
        "chat": (10, 3600),      # 10 æ¬¡/å°æ—¶
        "journal": (3, 86400),   # 3 æ¬¡/å¤©
    },
    "pro": {
        "chat": (100, 3600),     # 100 æ¬¡/å°æ—¶
        "journal": (999, 86400), # æ— é™
    },
    "enterprise": {
        "chat": (1000, 3600),    # 1000 æ¬¡/å°æ—¶
        "journal": (999, 86400), # æ— é™
    },
}

# ============ é™æµä¸­é—´ä»¶ ============
@app.middleware("http")
async def rate_limit_middleware(request: Request, call_next):
    user = request.state.user
    endpoint = request.url.path
    
    limits = RATE_LIMITS.get(user.tier, RATE_LIMITS["free"])
    
    if endpoint.startswith("/api/chat"):
        limit, window = limits["chat"]
        key = rate_limiter.limit_key(user.id, "chat")
    elif endpoint.startswith("/api/journal"):
        limit, window = limits["journal"]
        key = rate_limiter.limit_key(user.id, "journal")
    else:
        return await call_next(request)
    
    allowed, remaining = await rate_limiter.is_allowed(key, limit, window)
    
    if not allowed:
        return JSONResponse(
            status_code=429,
            content={"error": "Rate limit exceeded"},
            headers={"X-RateLimit-Remaining": "0"},
        )
    
    response = await call_next(request)
    response.headers["X-RateLimit-Remaining"] = str(remaining)
    return response
```

#### 10.3.3 å¥åº·æ£€æŸ¥

```python
# routers/health.py

from fastapi import APIRouter, Depends
from enum import Enum

router = APIRouter(tags=["Health"])

class HealthStatus(str, Enum):
    HEALTHY = "healthy"
    DEGRADED = "degraded"
    UNHEALTHY = "unhealthy"

@router.get("/health")
async def health_check():
    """åŸºç¡€å¥åº·æ£€æŸ¥ - K8s liveness probe"""
    return {"status": "ok"}

@router.get("/health/ready")
async def readiness_check(
    db: Database = Depends(get_db),
    redis: Redis = Depends(get_redis),
):
    """å°±ç»ªæ£€æŸ¥ - K8s readiness probe"""
    checks = {}
    overall_status = HealthStatus.HEALTHY
    
    # æ£€æŸ¥æ•°æ®åº“
    try:
        await db.execute("SELECT 1")
        checks["database"] = {"status": "ok", "latency_ms": 0}
    except Exception as e:
        checks["database"] = {"status": "error", "error": str(e)}
        overall_status = HealthStatus.UNHEALTHY
    
    # æ£€æŸ¥ Redis
    try:
        await redis.ping()
        checks["redis"] = {"status": "ok"}
    except Exception as e:
        checks["redis"] = {"status": "error", "error": str(e)}
        overall_status = HealthStatus.UNHEALTHY
    
    # æ£€æŸ¥ LLM ç†”æ–­å™¨çŠ¶æ€
    openai_state = LLMCircuitBreaker.openai_breaker.state
    anthropic_state = LLMCircuitBreaker.anthropic_breaker.state
    
    checks["llm"] = {
        "openai": openai_state.name,
        "anthropic": anthropic_state.name,
    }
    
    if openai_state == "open" and anthropic_state == "open":
        overall_status = HealthStatus.DEGRADED
    
    return {
        "status": overall_status,
        "checks": checks,
        "timestamp": datetime.utcnow().isoformat(),
    }
```

### 10.4 æ˜“ç»´æŠ¤è®¾è®¡

#### 10.4.1 ç»“æ„åŒ–æ—¥å¿—

```python
# core/logging.py

import structlog
from structlog.typing import FilteringBoundLogger

def setup_logging():
    structlog.configure(
        processors=[
            structlog.contextvars.merge_contextvars,
            structlog.processors.add_log_level,
            structlog.processors.TimeStamper(fmt="iso"),
            structlog.processors.StackInfoRenderer(),
            structlog.processors.format_exc_info,
            structlog.processors.JSONRenderer(),
        ],
        wrapper_class=structlog.make_filtering_bound_logger(logging.INFO),
        context_class=dict,
        logger_factory=structlog.PrintLoggerFactory(),
        cache_logger_on_first_use=True,
    )

logger: FilteringBoundLogger = structlog.get_logger()

# ============ è¯·æ±‚çº§åˆ«ä¸Šä¸‹æ–‡ ============
@app.middleware("http")
async def logging_middleware(request: Request, call_next):
    request_id = str(uuid.uuid4())
    
    structlog.contextvars.clear_contextvars()
    structlog.contextvars.bind_contextvars(
        request_id=request_id,
        user_id=getattr(request.state, "user_id", None),
        path=request.url.path,
        method=request.method,
    )
    
    start = time.time()
    response = await call_next(request)
    duration = time.time() - start
    
    logger.info(
        "request_completed",
        status_code=response.status_code,
        duration_ms=round(duration * 1000, 2),
    )
    
    response.headers["X-Request-ID"] = request_id
    return response

# ============ ä¸šåŠ¡æ—¥å¿—ç¤ºä¾‹ ============
async def chat(request: ChatRequest):
    logger.info(
        "chat_started",
        coach_id=request.coach_id,
        message_count=len(request.messages),
    )
    
    try:
        # ... å¤„ç†é€»è¾‘
        logger.info("chat_completed", tokens_used=token_count)
    except Exception as e:
        logger.error("chat_failed", error=str(e), exc_info=True)
        raise
```

#### 10.4.2 é”™è¯¯å¤„ç†è§„èŒƒ

```python
# core/exceptions.py

from fastapi import HTTPException
from typing import Any

# ============ ä¸šåŠ¡å¼‚å¸¸åŸºç±» ============
class AppException(Exception):
    """åº”ç”¨å¼‚å¸¸åŸºç±»"""
    
    def __init__(
        self,
        code: str,
        message: str,
        details: dict[str, Any] | None = None,
        status_code: int = 400,
    ):
        self.code = code
        self.message = message
        self.details = details or {}
        self.status_code = status_code
        super().__init__(message)

# ============ å…·ä½“å¼‚å¸¸ ============
class UserNotFoundError(AppException):
    def __init__(self, user_id: str):
        super().__init__(
            code="USER_NOT_FOUND",
            message=f"User {user_id} not found",
            status_code=404,
        )

class RateLimitExceededError(AppException):
    def __init__(self, limit: int, window: str):
        super().__init__(
            code="RATE_LIMIT_EXCEEDED",
            message=f"Rate limit of {limit} per {window} exceeded",
            details={"limit": limit, "window": window},
            status_code=429,
        )

class LLMProviderError(AppException):
    def __init__(self, provider: str, error: str):
        super().__init__(
            code="LLM_PROVIDER_ERROR",
            message=f"LLM provider {provider} error: {error}",
            details={"provider": provider},
            status_code=503,
        )

class InsufficientQuotaError(AppException):
    def __init__(self, feature: str, tier: str):
        super().__init__(
            code="INSUFFICIENT_QUOTA",
            message=f"Feature {feature} not available in {tier} tier",
            details={"feature": feature, "required_tier": "pro"},
            status_code=403,
        )

# ============ å…¨å±€å¼‚å¸¸å¤„ç†å™¨ ============
@app.exception_handler(AppException)
async def app_exception_handler(request: Request, exc: AppException):
    logger.warning(
        "business_error",
        code=exc.code,
        message=exc.message,
        details=exc.details,
    )
    
    return JSONResponse(
        status_code=exc.status_code,
        content={
            "error": {
                "code": exc.code,
                "message": exc.message,
                "details": exc.details,
            }
        },
    )

@app.exception_handler(Exception)
async def generic_exception_handler(request: Request, exc: Exception):
    logger.error("unhandled_error", error=str(exc), exc_info=True)
    
    # ç”Ÿäº§ç¯å¢ƒä¸æš´éœ²å†…éƒ¨é”™è¯¯
    return JSONResponse(
        status_code=500,
        content={
            "error": {
                "code": "INTERNAL_ERROR",
                "message": "An internal error occurred",
            }
        },
    )
```

#### 10.4.3 æµ‹è¯•ç­–ç•¥

```python
# tests/conftest.py

import pytest
from httpx import AsyncClient
from sqlalchemy.ext.asyncio import create_async_engine, AsyncSession
from unittest.mock import AsyncMock

@pytest.fixture
async def db_session():
    """æµ‹è¯•æ•°æ®åº“ä¼šè¯"""
    engine = create_async_engine(
        "postgresql+asyncpg://test:test@localhost:5432/test_aiwendy",
        echo=True,
    )
    
    async with engine.begin() as conn:
        await conn.run_sync(Base.metadata.create_all)
    
    async with AsyncSession(engine) as session:
        yield session
    
    async with engine.begin() as conn:
        await conn.run_sync(Base.metadata.drop_all)

@pytest.fixture
def mock_llm_provider():
    """Mock LLM Provider"""
    provider = AsyncMock(spec=ILLMProvider)
    
    async def mock_stream(*args, **kwargs):
        for word in ["Hello", " ", "world", "!"]:
            yield word
    
    provider.chat_stream.return_value = mock_stream()
    return provider

@pytest.fixture
async def client(db_session, mock_llm_provider):
    """æµ‹è¯•å®¢æˆ·ç«¯"""
    app.dependency_overrides[get_db] = lambda: db_session
    app.dependency_overrides[get_llm_provider] = lambda: mock_llm_provider
    
    async with AsyncClient(app=app, base_url="http://test") as ac:
        yield ac

# ============ å•å…ƒæµ‹è¯•ç¤ºä¾‹ ============
# tests/unit/test_journal_service.py

class TestJournalService:
    async def test_create_entry_success(self, db_session, mock_llm_provider):
        repo = JournalRepository(db_session)
        service = JournalService(repo, mock_llm_provider)
        
        result = await service.create_entry(
            user_id="user-1",
            data=JournalCreate(
                symbol="AAPL",
                direction="long",
                pnl=100.0,
                entry_emotion=3,
                exit_emotion=4,
            ),
        )
        
        assert result.id is not None
        assert result.symbol == "AAPL"
    
    async def test_create_entry_rate_limited(self, db_session):
        # ... æµ‹è¯•é™æµåœºæ™¯
        pass

# ============ é›†æˆæµ‹è¯•ç¤ºä¾‹ ============
# tests/integration/test_chat_api.py

class TestChatAPI:
    async def test_chat_stream(self, client, auth_headers):
        response = await client.post(
            "/api/v1/chat",
            json={
                "coach_id": "wendy",
                "messages": [{"role": "user", "content": "Hello"}],
            },
            headers=auth_headers,
        )
        
        assert response.status_code == 200
        assert "text/event-stream" in response.headers["content-type"]
    
    async def test_chat_unauthorized(self, client):
        response = await client.post("/api/v1/chat", json={})
        assert response.status_code == 401

# ============ E2E æµ‹è¯•ç¤ºä¾‹ ============
# tests/e2e/test_user_journey.py

class TestUserJourney:
    async def test_new_user_onboarding(self, client):
        # 1. æ³¨å†Œ
        response = await client.post("/api/v1/auth/register", json={...})
        assert response.status_code == 201
        
        # 2. ç™»å½•
        response = await client.post("/api/v1/auth/login", json={...})
        token = response.json()["access_token"]
        
        # 3. åˆ›å»ºæ—¥è®°
        # 4. å¼€å§‹å¯¹è¯
        # ...
```

### 10.5 å¯æ‰©å±•è®¾è®¡

#### 10.5.1 API ç‰ˆæœ¬ç®¡ç†

```python
# main.py

from fastapi import FastAPI

app = FastAPI()

# ============ API ç‰ˆæœ¬è·¯ç”± ============
from routers import v1, v2

app.include_router(v1.router, prefix="/api/v1")
app.include_router(v2.router, prefix="/api/v2")

# ============ ç‰ˆæœ¬åå•† ============
@app.middleware("http")
async def api_version_middleware(request: Request, call_next):
    # æ”¯æŒ Header ç‰ˆæœ¬åå•†
    api_version = request.headers.get("X-API-Version", "v1")
    request.state.api_version = api_version
    return await call_next(request)
```

#### 10.5.2 æ’ä»¶åŒ–æ•™ç»ƒç³»ç»Ÿ

```python
# domain/coach/plugin.py

from abc import ABC, abstractmethod
from typing import TypeVar, Generic

T = TypeVar("T")

class CoachPlugin(ABC, Generic[T]):
    """æ•™ç»ƒæ’ä»¶åŸºç±»"""
    
    @property
    @abstractmethod
    def name(self) -> str:
        """æ’ä»¶åç§°"""
        pass
    
    @property
    @abstractmethod
    def version(self) -> str:
        """æ’ä»¶ç‰ˆæœ¬"""
        pass
    
    @abstractmethod
    async def pre_process(self, context: ChatContext) -> ChatContext:
        """é¢„å¤„ç†ï¼šåœ¨ LLM è°ƒç”¨å‰æ‰§è¡Œ"""
        pass
    
    @abstractmethod
    async def post_process(self, response: str, context: ChatContext) -> str:
        """åå¤„ç†ï¼šåœ¨ LLM è°ƒç”¨åæ‰§è¡Œ"""
        pass

# ============ å…·ä½“æ’ä»¶å®ç° ============
class EmotionDetectionPlugin(CoachPlugin):
    """æƒ…ç»ªæ£€æµ‹æ’ä»¶"""
    
    name = "emotion_detection"
    version = "1.0.0"
    
    async def pre_process(self, context: ChatContext) -> ChatContext:
        # ä½¿ç”¨è½»é‡æ¨¡å‹æ£€æµ‹ç”¨æˆ·æƒ…ç»ª
        emotion = await self.detect_emotion(context.user_message)
        context.metadata["detected_emotion"] = emotion
        return context
    
    async def post_process(self, response: str, context: ChatContext) -> str:
        # è®°å½•æƒ…ç»ªåˆ°æ—¥å¿—
        logger.info("emotion_detected", emotion=context.metadata["detected_emotion"])
        return response

class PatternAlertPlugin(CoachPlugin):
    """æ¨¡å¼é¢„è­¦æ’ä»¶"""
    
    name = "pattern_alert"
    version = "1.0.0"
    
    async def pre_process(self, context: ChatContext) -> ChatContext:
        # æ£€æµ‹å±é™©æ¨¡å¼ï¼ˆå¦‚æŠ¥å¤æ€§äº¤æ˜“æ„å›¾ï¼‰
        patterns = await self.detect_patterns(context.user_message)
        if "revenge_trading" in patterns:
            context.metadata["alert"] = "revenge_trading_detected"
            context.system_prompt_additions.append(
                "è­¦å‘Šï¼šæ£€æµ‹åˆ°ç”¨æˆ·å¯èƒ½æœ‰æŠ¥å¤æ€§äº¤æ˜“æ„å›¾ï¼Œè¯·ç‰¹åˆ«å…³æ³¨å¹¶å¼•å¯¼ã€‚"
            )
        return context

# ============ æ’ä»¶ç®¡ç†å™¨ ============
class PluginManager:
    def __init__(self):
        self.plugins: list[CoachPlugin] = []
    
    def register(self, plugin: CoachPlugin):
        self.plugins.append(plugin)
        logger.info("plugin_registered", name=plugin.name, version=plugin.version)
    
    async def run_pre_process(self, context: ChatContext) -> ChatContext:
        for plugin in self.plugins:
            context = await plugin.pre_process(context)
        return context
    
    async def run_post_process(self, response: str, context: ChatContext) -> str:
        for plugin in self.plugins:
            response = await plugin.post_process(response, context)
        return response
```

#### 10.5.3 å¤šç§Ÿæˆ·æ”¯æŒ

```python
# core/multitenancy.py

from contextvars import ContextVar

current_tenant: ContextVar[str] = ContextVar("current_tenant", default="default")

class TenantMiddleware:
    """å¤šç§Ÿæˆ·ä¸­é—´ä»¶"""
    
    async def __call__(self, request: Request, call_next):
        # ä» subdomain æˆ– header è·å–ç§Ÿæˆ·
        tenant_id = self._extract_tenant(request)
        
        token = current_tenant.set(tenant_id)
        try:
            response = await call_next(request)
            return response
        finally:
            current_tenant.reset(token)
    
    def _extract_tenant(self, request: Request) -> str:
        # æ–¹å¼1: subdomain (acme.aiwendy.com)
        host = request.headers.get("host", "")
        if "." in host:
            subdomain = host.split(".")[0]
            if subdomain not in ["www", "api"]:
                return subdomain
        
        # æ–¹å¼2: header
        return request.headers.get("X-Tenant-ID", "default")

# ============ ç§Ÿæˆ·æ„ŸçŸ¥çš„ Repository ============
class TenantAwareRepository:
    def __init__(self, session: AsyncSession):
        self.session = session
    
    @property
    def tenant_id(self) -> str:
        return current_tenant.get()
    
    async def get_by_id(self, id: str) -> Model | None:
        result = await self.session.execute(
            select(Model).where(
                Model.id == id,
                Model.tenant_id == self.tenant_id,  # è‡ªåŠ¨è¿‡æ»¤ç§Ÿæˆ·
            )
        )
        return result.scalar_one_or_none()
```

### 10.6 ç”Ÿäº§çº§ç›®å½•ç»“æ„

```
aiwendy/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/                      # Next.js å‰ç«¯
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ api/                      # FastAPI åç«¯
â”‚       â”œâ”€â”€ main.py               # åº”ç”¨å…¥å£
â”‚       â”œâ”€â”€ config.py             # é…ç½®ç®¡ç†
â”‚       â”‚
â”‚       â”œâ”€â”€ core/                 # æ ¸å¿ƒåŸºç¡€è®¾æ–½
â”‚       â”‚   â”œâ”€â”€ container.py      # ä¾èµ–æ³¨å…¥å®¹å™¨
â”‚       â”‚   â”œâ”€â”€ database.py       # æ•°æ®åº“è¿æ¥
â”‚       â”‚   â”œâ”€â”€ redis.py          # Redis è¿æ¥
â”‚       â”‚   â”œâ”€â”€ logging.py        # æ—¥å¿—é…ç½®
â”‚       â”‚   â”œâ”€â”€ exceptions.py     # å¼‚å¸¸å®šä¹‰
â”‚       â”‚   â”œâ”€â”€ resilience.py     # ç†”æ–­/é™çº§/é‡è¯•
â”‚       â”‚   â”œâ”€â”€ ratelimit.py      # é™æµ
â”‚       â”‚   â””â”€â”€ multitenancy.py   # å¤šç§Ÿæˆ·
â”‚       â”‚
â”‚       â”œâ”€â”€ domain/               # é¢†åŸŸå±‚
â”‚       â”‚   â”œâ”€â”€ interfaces.py     # æ¥å£å®šä¹‰
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ user/             # ç”¨æˆ·åŸŸ
â”‚       â”‚   â”‚   â”œâ”€â”€ models.py
â”‚       â”‚   â”‚   â”œâ”€â”€ schemas.py
â”‚       â”‚   â”‚   â”œâ”€â”€ repository.py
â”‚       â”‚   â”‚   â””â”€â”€ service.py
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ coach/            # æ•™ç»ƒåŸŸ
â”‚       â”‚   â”‚   â”œâ”€â”€ models.py
â”‚       â”‚   â”‚   â”œâ”€â”€ schemas.py
â”‚       â”‚   â”‚   â”œâ”€â”€ repository.py
â”‚       â”‚   â”‚   â”œâ”€â”€ service.py
â”‚       â”‚   â”‚   â””â”€â”€ plugins/      # æ•™ç»ƒæ’ä»¶
â”‚       â”‚   â”‚       â”œâ”€â”€ base.py
â”‚       â”‚   â”‚       â”œâ”€â”€ emotion.py
â”‚       â”‚   â”‚       â””â”€â”€ pattern.py
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ journal/          # æ—¥è®°åŸŸ
â”‚       â”‚   â”‚   â”œâ”€â”€ models.py
â”‚       â”‚   â”‚   â”œâ”€â”€ schemas.py
â”‚       â”‚   â”‚   â”œâ”€â”€ repository.py
â”‚       â”‚   â”‚   â””â”€â”€ service.py
â”‚       â”‚   â”‚
â”‚       â”‚   â””â”€â”€ analysis/         # åˆ†æåŸŸ
â”‚       â”‚       â”œâ”€â”€ models.py
â”‚       â”‚       â”œâ”€â”€ schemas.py
â”‚       â”‚       â”œâ”€â”€ repository.py
â”‚       â”‚       â””â”€â”€ service.py
â”‚       â”‚
â”‚       â”œâ”€â”€ infrastructure/       # åŸºç¡€è®¾æ–½å±‚
â”‚       â”‚   â”œâ”€â”€ llm/              # LLM é€‚é…å™¨
â”‚       â”‚   â”‚   â”œâ”€â”€ base.py
â”‚       â”‚   â”‚   â”œâ”€â”€ openai.py
â”‚       â”‚   â”‚   â”œâ”€â”€ anthropic.py
â”‚       â”‚   â”‚   â””â”€â”€ router.py
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ storage/          # å­˜å‚¨é€‚é…å™¨
â”‚       â”‚   â”‚   â””â”€â”€ s3.py
â”‚       â”‚   â”‚
â”‚       â”‚   â””â”€â”€ payment/          # æ”¯ä»˜é€‚é…å™¨
â”‚       â”‚       â””â”€â”€ stripe.py
â”‚       â”‚
â”‚       â”œâ”€â”€ routers/              # API è·¯ç”±
â”‚       â”‚   â”œâ”€â”€ v1/
â”‚       â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”‚   â”œâ”€â”€ auth.py
â”‚       â”‚   â”‚   â”œâ”€â”€ chat.py
â”‚       â”‚   â”‚   â”œâ”€â”€ journal.py
â”‚       â”‚   â”‚   â””â”€â”€ analysis.py
â”‚       â”‚   â”œâ”€â”€ v2/
â”‚       â”‚   â”‚   â””â”€â”€ ...
â”‚       â”‚   â””â”€â”€ health.py
â”‚       â”‚
â”‚       â””â”€â”€ workers/              # åå°ä»»åŠ¡
â”‚           â”œâ”€â”€ celery_app.py
â”‚           â””â”€â”€ tasks/
â”‚               â”œâ”€â”€ analysis.py
â”‚               â””â”€â”€ notification.py
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ conftest.py               # æµ‹è¯•é…ç½®
â”‚   â”œâ”€â”€ unit/                     # å•å…ƒæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_user_service.py
â”‚   â”‚   â”œâ”€â”€ test_coach_service.py
â”‚   â”‚   â””â”€â”€ test_journal_service.py
â”‚   â”œâ”€â”€ integration/              # é›†æˆæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_chat_api.py
â”‚   â”‚   â””â”€â”€ test_journal_api.py
â”‚   â””â”€â”€ e2e/                      # ç«¯åˆ°ç«¯æµ‹è¯•
â”‚       â””â”€â”€ test_user_journey.py
â”‚
â”œâ”€â”€ migrations/                   # æ•°æ®åº“è¿ç§»
â”‚   â”œâ”€â”€ env.py
â”‚   â””â”€â”€ versions/
â”‚       â””â”€â”€ 001_initial.py
â”‚
â”œâ”€â”€ scripts/                      # è¿ç»´è„šæœ¬
â”‚   â”œâ”€â”€ deploy.sh
â”‚   â”œâ”€â”€ seed.py
â”‚   â””â”€â”€ backup.sh
â”‚
â”œâ”€â”€ docs/                         # æ–‡æ¡£
â”‚   â”œâ”€â”€ api.md
â”‚   â”œâ”€â”€ architecture.md
â”‚   â””â”€â”€ runbook.md
â”‚
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ ci.yml                # CI æµæ°´çº¿
â”‚       â”œâ”€â”€ cd.yml                # CD æµæ°´çº¿
â”‚       â””â”€â”€ security.yml          # å®‰å…¨æ‰«æ
â”‚
â”œâ”€â”€ docker-compose.yml            # æœ¬åœ°å¼€å‘
â”œâ”€â”€ docker-compose.prod.yml       # ç”Ÿäº§éƒ¨ç½²
â”œâ”€â”€ Dockerfile                    # API é•œåƒ
â”œâ”€â”€ pyproject.toml                # Python é¡¹ç›®é…ç½®
â”œâ”€â”€ pytest.ini                    # æµ‹è¯•é…ç½®
â”œâ”€â”€ .pre-commit-config.yaml       # ä»£ç æ£€æŸ¥
â””â”€â”€ README.md
```

### 10.7 ç”Ÿäº§çº§åˆ«æ£€æŸ¥æ¸…å•

| ç»´åº¦ | æ£€æŸ¥é¡¹ | çŠ¶æ€ | å®ç°æ–¹å¼ |
|------|--------|------|----------|
| **é«˜å†…èšä½è€¦åˆ** | é¢†åŸŸæ¨¡å—åˆ’åˆ† | âœ… | User/Coach/Journal/Analysis å››åŸŸ |
| | æ¥å£å®šä¹‰ï¼ˆProtocolï¼‰ | âœ… | domain/interfaces.py |
| | ä¾èµ–æ³¨å…¥ | âœ… | dependency-injector å®¹å™¨ |
| | Repository æ¨¡å¼ | âœ… | æ¯ä¸ªåŸŸç‹¬ç«‹ Repository |
| **é«˜å¯ç”¨** | ç†”æ–­å™¨ | âœ… | circuitbreaker + Redis çŠ¶æ€å­˜å‚¨ |
| | é™çº§ç­–ç•¥ | âœ… | LLMFallbackChain å¤šçº§é™çº§ |
| | é‡è¯•æœºåˆ¶ | âœ… | tenacity æŒ‡æ•°é€€é¿ |
| | é™æµ | âœ… | Redis æ»‘åŠ¨çª—å£ |
| | å¥åº·æ£€æŸ¥ | âœ… | /health + /health/ready |
| | å¤šå®ä¾‹éƒ¨ç½² | âœ… | æ— çŠ¶æ€è®¾è®¡ + Redis ä¼šè¯ |
| **æ˜“ç»´æŠ¤** | ç»“æ„åŒ–æ—¥å¿— | âœ… | structlog JSON æ ¼å¼ |
| | è¯·æ±‚è¿½è¸ª | âœ… | X-Request-ID |
| | ç»Ÿä¸€é”™è¯¯å¤„ç† | âœ… | AppException + å…¨å±€å¤„ç†å™¨ |
| | å•å…ƒæµ‹è¯• | âœ… | pytest + mock |
| | é›†æˆæµ‹è¯• | âœ… | httpx AsyncClient |
| | E2E æµ‹è¯• | âœ… | ç”¨æˆ·æ—…ç¨‹æµ‹è¯• |
| | API æ–‡æ¡£ | âœ… | FastAPI è‡ªåŠ¨ç”Ÿæˆ |
| **å¯æ‰©å±•** | API ç‰ˆæœ¬ç®¡ç† | âœ… | /api/v1, /api/v2 |
| | æ’ä»¶ç³»ç»Ÿ | âœ… | CoachPlugin åŸºç±» |
| | å¤šç§Ÿæˆ·æ”¯æŒ | âœ… | TenantMiddleware + ç§Ÿæˆ·æ„ŸçŸ¥ Repository |
| | æ°´å¹³æ‰©å±• | âœ… | æ— çŠ¶æ€ + è´Ÿè½½å‡è¡¡ |

### 10.8 æ–°å¢ä¾èµ–

åœ¨ `requirements.txt` ä¸­æ·»åŠ ï¼š

```txt
# ========== ç”Ÿäº§çº§åˆ«ä¾èµ– ==========
# ä¾èµ–æ³¨å…¥
dependency-injector==4.41.0

# ç†”æ–­å™¨
circuitbreaker==2.0.0

# é‡è¯•
tenacity==8.3.0

# ç»“æ„åŒ–æ—¥å¿—
structlog==24.2.0

# æµ‹è¯•
pytest==8.2.2
pytest-asyncio==0.23.7
pytest-cov==5.0.0
httpx==0.27.0

# ä»£ç è´¨é‡
pre-commit==3.7.1
ruff==0.4.8
mypy==1.10.0
```

---

## 11. å®‰å…¨è®¾è®¡

### 11.1 å®‰å…¨æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®‰å…¨æ¶æ„åˆ†å±‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    ç½‘ç»œå±‚å®‰å…¨                            â”‚   â”‚
â”‚  â”‚  WAF â”‚ DDoS é˜²æŠ¤ â”‚ CDN â”‚ TLS 1.3                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    åº”ç”¨å±‚å®‰å…¨                            â”‚   â”‚
â”‚  â”‚  è®¤è¯ â”‚ æˆæƒ â”‚ CORS â”‚ CSRF â”‚ è¾“å…¥éªŒè¯                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    æ•°æ®å±‚å®‰å…¨                            â”‚   â”‚
â”‚  â”‚  åŠ å¯†å­˜å‚¨ â”‚ å¯†é’¥ç®¡ç† â”‚ è„±æ• â”‚ å®¡è®¡æ—¥å¿—                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.2 è®¤è¯ä¸æˆæƒ

#### 11.2.1 OAuth2 + JWT è®¤è¯æµç¨‹

```python
# core/security/auth.py

from datetime import datetime, timedelta
from jose import jwt, JWTError
from passlib.context import CryptContext
from pydantic import BaseModel

# ============ é…ç½® ============
class AuthConfig:
    SECRET_KEY: str = os.getenv("JWT_SECRET")
    ALGORITHM: str = "HS256"
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 30
    REFRESH_TOKEN_EXPIRE_DAYS: int = 7

pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

# ============ Token æ¨¡å‹ ============
class TokenPayload(BaseModel):
    sub: str              # user_id
    exp: datetime
    iat: datetime
    jti: str              # token idï¼Œç”¨äºæ’¤é”€
    type: str             # "access" | "refresh"
    tier: str             # "free" | "pro" | "enterprise"
    permissions: list[str]

class TokenPair(BaseModel):
    access_token: str
    refresh_token: str
    token_type: str = "bearer"
    expires_in: int

# ============ Token ç”Ÿæˆ ============
def create_access_token(user: User) -> str:
    now = datetime.utcnow()
    payload = TokenPayload(
        sub=user.id,
        exp=now + timedelta(minutes=AuthConfig.ACCESS_TOKEN_EXPIRE_MINUTES),
        iat=now,
        jti=str(uuid.uuid4()),
        type="access",
        tier=user.subscription_tier,
        permissions=user.permissions,
    )
    return jwt.encode(payload.dict(), AuthConfig.SECRET_KEY, algorithm=AuthConfig.ALGORITHM)

def create_refresh_token(user: User) -> str:
    now = datetime.utcnow()
    payload = TokenPayload(
        sub=user.id,
        exp=now + timedelta(days=AuthConfig.REFRESH_TOKEN_EXPIRE_DAYS),
        iat=now,
        jti=str(uuid.uuid4()),
        type="refresh",
        tier=user.subscription_tier,
        permissions=[],
    )
    return jwt.encode(payload.dict(), AuthConfig.SECRET_KEY, algorithm=AuthConfig.ALGORITHM)

# ============ Token éªŒè¯ ============
async def verify_token(token: str, token_type: str = "access") -> TokenPayload:
    try:
        payload = jwt.decode(token, AuthConfig.SECRET_KEY, algorithms=[AuthConfig.ALGORITHM])
        token_data = TokenPayload(**payload)
        
        if token_data.type != token_type:
            raise InvalidTokenError("Invalid token type")
        
        # æ£€æŸ¥æ˜¯å¦åœ¨é»‘åå•ä¸­ï¼ˆå·²æ’¤é”€ï¼‰
        if await is_token_revoked(token_data.jti):
            raise InvalidTokenError("Token has been revoked")
        
        return token_data
        
    except JWTError as e:
        raise InvalidTokenError(f"Invalid token: {e}")

# ============ Token æ’¤é”€ ============
async def revoke_token(jti: str, exp: datetime):
    """å°† token åŠ å…¥é»‘åå•"""
    ttl = (exp - datetime.utcnow()).total_seconds()
    if ttl > 0:
        await redis.setex(f"revoked:{jti}", int(ttl), "1")

async def is_token_revoked(jti: str) -> bool:
    return await redis.exists(f"revoked:{jti}")
```

#### 11.2.2 RBAC æƒé™æ¨¡å‹

```python
# core/security/rbac.py

from enum import Enum
from functools import wraps

class Permission(str, Enum):
    # æ—¥è®°æƒé™
    JOURNAL_READ = "journal:read"
    JOURNAL_WRITE = "journal:write"
    JOURNAL_DELETE = "journal:delete"
    
    # æ•™ç»ƒæƒé™
    COACH_BASIC = "coach:basic"
    COACH_PREMIUM = "coach:premium"
    COACH_CUSTOM = "coach:custom"
    
    # åˆ†ææƒé™
    ANALYSIS_BASIC = "analysis:basic"
    ANALYSIS_ADVANCED = "analysis:advanced"
    
    # ç®¡ç†æƒé™
    ADMIN_READ = "admin:read"
    ADMIN_WRITE = "admin:write"

# ============ è§’è‰²å®šä¹‰ ============
ROLE_PERMISSIONS = {
    "free": [
        Permission.JOURNAL_READ,
        Permission.JOURNAL_WRITE,
        Permission.COACH_BASIC,
        Permission.ANALYSIS_BASIC,
    ],
    "pro": [
        Permission.JOURNAL_READ,
        Permission.JOURNAL_WRITE,
        Permission.JOURNAL_DELETE,
        Permission.COACH_BASIC,
        Permission.COACH_PREMIUM,
        Permission.ANALYSIS_BASIC,
        Permission.ANALYSIS_ADVANCED,
    ],
    "enterprise": [
        # æ‰€æœ‰æƒé™
        *[p for p in Permission],
    ],
    "admin": [
        *[p for p in Permission],
        Permission.ADMIN_READ,
        Permission.ADMIN_WRITE,
    ],
}

# ============ æƒé™æ£€æŸ¥è£…é¥°å™¨ ============
def require_permission(*permissions: Permission):
    def decorator(func):
        @wraps(func)
        async def wrapper(*args, **kwargs):
            request = kwargs.get("request") or args[0]
            user = request.state.user
            
            for perm in permissions:
                if perm not in user.permissions:
                    raise PermissionDeniedError(
                        f"Permission {perm} required",
                        required_tier=_get_required_tier(perm),
                    )
            
            return await func(*args, **kwargs)
        return wrapper
    return decorator

# ============ ä½¿ç”¨ç¤ºä¾‹ ============
@router.post("/journal")
@require_permission(Permission.JOURNAL_WRITE)
async def create_journal(request: Request, data: JournalCreate):
    # åªæœ‰æœ‰å†™æƒé™çš„ç”¨æˆ·æ‰èƒ½åˆ›å»ºæ—¥è®°
    pass

@router.get("/analysis/advanced")
@require_permission(Permission.ANALYSIS_ADVANCED)
async def get_advanced_analysis(request: Request):
    # åªæœ‰ pro åŠä»¥ä¸Šç”¨æˆ·æ‰èƒ½è®¿é—®
    pass
```

#### 11.2.3 OAuth2 ç¤¾äº¤ç™»å½•

```python
# core/security/oauth.py

from authlib.integrations.starlette_client import OAuth

oauth = OAuth()

# ============ Google OAuth ============
oauth.register(
    name="google",
    client_id=os.getenv("GOOGLE_CLIENT_ID"),
    client_secret=os.getenv("GOOGLE_CLIENT_SECRET"),
    server_metadata_url="https://accounts.google.com/.well-known/openid-configuration",
    client_kwargs={"scope": "openid email profile"},
)

# ============ GitHub OAuth ============
oauth.register(
    name="github",
    client_id=os.getenv("GITHUB_CLIENT_ID"),
    client_secret=os.getenv("GITHUB_CLIENT_SECRET"),
    access_token_url="https://github.com/login/oauth/access_token",
    authorize_url="https://github.com/login/oauth/authorize",
    api_base_url="https://api.github.com/",
    client_kwargs={"scope": "user:email"},
)

# ============ å›è°ƒå¤„ç† ============
@router.get("/auth/{provider}/callback")
async def oauth_callback(provider: str, request: Request):
    client = oauth.create_client(provider)
    token = await client.authorize_access_token(request)
    
    # è·å–ç”¨æˆ·ä¿¡æ¯
    if provider == "google":
        user_info = token.get("userinfo")
    elif provider == "github":
        resp = await client.get("user")
        user_info = resp.json()
    
    # æŸ¥æ‰¾æˆ–åˆ›å»ºç”¨æˆ·
    user = await user_service.find_or_create_oauth_user(
        provider=provider,
        provider_id=str(user_info["id"]),
        email=user_info.get("email"),
        name=user_info.get("name"),
    )
    
    # ç”Ÿæˆ token
    tokens = create_token_pair(user)
    return tokens
```

### 11.3 æ•°æ®åŠ å¯†

#### 11.3.1 ä¼ è¾“åŠ å¯†

```yaml
# nginx/ssl.conf

server {
    listen 443 ssl http2;
    server_name api.aiwendy.com;
    
    # TLS 1.3 é…ç½®
    ssl_protocols TLSv1.3;
    ssl_prefer_server_ciphers off;
    
    # è¯ä¹¦
    ssl_certificate /etc/letsencrypt/live/aiwendy.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/aiwendy.com/privkey.pem;
    
    # HSTS
    add_header Strict-Transport-Security "max-age=63072000" always;
    
    # OCSP Stapling
    ssl_stapling on;
    ssl_stapling_verify on;
}
```

#### 11.3.2 é™æ€æ•°æ®åŠ å¯†

```python
# core/security/encryption.py

from cryptography.fernet import Fernet
from cryptography.hazmat.primitives import hashes
from cryptography.hazmat.primitives.kdf.pbkdf2 import PBKDF2HMAC
import base64

class FieldEncryption:
    """å­—æ®µçº§åŠ å¯†"""
    
    def __init__(self, key: str):
        # ä»ä¸»å¯†é’¥æ´¾ç”ŸåŠ å¯†å¯†é’¥
        kdf = PBKDF2HMAC(
            algorithm=hashes.SHA256(),
            length=32,
            salt=b"aiwendy_salt",  # ç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨éšæœºç›
            iterations=100000,
        )
        derived_key = base64.urlsafe_b64encode(kdf.derive(key.encode()))
        self.fernet = Fernet(derived_key)
    
    def encrypt(self, plaintext: str) -> str:
        """åŠ å¯†å­—ç¬¦ä¸²"""
        return self.fernet.encrypt(plaintext.encode()).decode()
    
    def decrypt(self, ciphertext: str) -> str:
        """è§£å¯†å­—ç¬¦ä¸²"""
        return self.fernet.decrypt(ciphertext.encode()).decode()

# ============ æ•æ„Ÿå­—æ®µæ¨¡å‹ ============
class EncryptedField:
    """SQLAlchemy åŠ å¯†å­—æ®µç±»å‹"""
    
    def __init__(self, encryption: FieldEncryption):
        self.encryption = encryption
    
    def process_bind_param(self, value, dialect):
        if value is not None:
            return self.encryption.encrypt(value)
        return value
    
    def process_result_value(self, value, dialect):
        if value is not None:
            return self.encryption.decrypt(value)
        return value

# ============ ä½¿ç”¨ç¤ºä¾‹ ============
class Journal(Base):
    __tablename__ = "journals"
    
    id = Column(String, primary_key=True)
    user_id = Column(String, ForeignKey("users.id"))
    
    # æ•æ„Ÿå­—æ®µåŠ å¯†å­˜å‚¨
    content = Column(EncryptedField(encryption), nullable=True)
    notes = Column(EncryptedField(encryption), nullable=True)
    
    # éæ•æ„Ÿå­—æ®µæ˜æ–‡å­˜å‚¨
    symbol = Column(String)
    pnl = Column(Float)
```

#### 11.3.3 å¯†é’¥ç®¡ç†

```python
# core/security/secrets.py

import boto3
from functools import lru_cache

class SecretsManager:
    """AWS Secrets Manager é›†æˆ"""
    
    def __init__(self):
        self.client = boto3.client("secretsmanager")
        self.cache: dict[str, str] = {}
    
    @lru_cache(maxsize=100)
    def get_secret(self, secret_name: str) -> str:
        """è·å–å¯†é’¥ï¼ˆå¸¦ç¼“å­˜ï¼‰"""
        try:
            response = self.client.get_secret_value(SecretId=secret_name)
            return response["SecretString"]
        except Exception as e:
            logger.error(f"Failed to get secret {secret_name}: {e}")
            raise
    
    def rotate_secret(self, secret_name: str):
        """è§¦å‘å¯†é’¥è½®æ¢"""
        self.client.rotate_secret(SecretId=secret_name)
        # æ¸…é™¤ç¼“å­˜
        self.get_secret.cache_clear()

secrets = SecretsManager()

# ============ é…ç½®åŠ è½½ ============
class SecureConfig:
    @property
    def database_url(self) -> str:
        return secrets.get_secret("aiwendy/database/url")
    
    @property
    def jwt_secret(self) -> str:
        return secrets.get_secret("aiwendy/jwt/secret")
    
    @property
    def openai_api_key(self) -> str:
        return secrets.get_secret("aiwendy/openai/api_key")
    
    @property
    def anthropic_api_key(self) -> str:
        return secrets.get_secret("aiwendy/anthropic/api_key")
    
    @property
    def stripe_secret_key(self) -> str:
        return secrets.get_secret("aiwendy/stripe/secret_key")
```

### 11.4 API å®‰å…¨

#### 11.4.1 è¾“å…¥éªŒè¯

```python
# core/security/validation.py

from pydantic import BaseModel, validator, Field
import re

class ChatRequest(BaseModel):
    coach_id: str = Field(..., min_length=1, max_length=50, regex=r"^[a-z0-9-]+$")
    messages: list[Message] = Field(..., min_items=1, max_items=100)
    
    @validator("messages")
    def validate_messages(cls, v):
        for msg in v:
            # é˜²æ­¢ prompt injection
            if contains_injection_patterns(msg.content):
                raise ValueError("Invalid message content")
            # é™åˆ¶æ¶ˆæ¯é•¿åº¦
            if len(msg.content) > 10000:
                raise ValueError("Message too long")
        return v

class JournalCreate(BaseModel):
    symbol: str = Field(..., min_length=1, max_length=20, regex=r"^[A-Z0-9.-]+$")
    direction: str = Field(..., regex=r"^(long|short)$")
    pnl: float = Field(..., ge=-1000000, le=1000000)
    entry_emotion: int = Field(..., ge=1, le=5)
    exit_emotion: int = Field(..., ge=1, le=5)
    notes: str | None = Field(None, max_length=5000)
    
    @validator("notes")
    def sanitize_notes(cls, v):
        if v:
            # ç§»é™¤æ½œåœ¨çš„ XSS å†…å®¹
            v = bleach.clean(v, strip=True)
        return v

# ============ æ³¨å…¥æ£€æµ‹ ============
INJECTION_PATTERNS = [
    r"ignore\s+previous\s+instructions",
    r"disregard\s+all\s+prior",
    r"you\s+are\s+now",
    r"new\s+instructions:",
    r"system\s*:",
]

def contains_injection_patterns(text: str) -> bool:
    text_lower = text.lower()
    for pattern in INJECTION_PATTERNS:
        if re.search(pattern, text_lower):
            return True
    return False
```

#### 11.4.2 CORS é…ç½®

```python
# main.py

from fastapi.middleware.cors import CORSMiddleware

# ============ ç”Ÿäº§ç¯å¢ƒ CORS ============
ALLOWED_ORIGINS = [
    "https://aiwendy.com",
    "https://www.aiwendy.com",
    "https://app.aiwendy.com",
]

app.add_middleware(
    CORSMiddleware,
    allow_origins=ALLOWED_ORIGINS,
    allow_credentials=True,
    allow_methods=["GET", "POST", "PUT", "DELETE", "OPTIONS"],
    allow_headers=["Authorization", "Content-Type", "X-Request-ID"],
    expose_headers=["X-Request-ID", "X-RateLimit-Remaining"],
    max_age=600,  # preflight ç¼“å­˜ 10 åˆ†é’Ÿ
)
```

#### 11.4.3 å®‰å…¨å“åº”å¤´

```python
# core/security/headers.py

from starlette.middleware.base import BaseHTTPMiddleware

class SecurityHeadersMiddleware(BaseHTTPMiddleware):
    async def dispatch(self, request, call_next):
        response = await call_next(request)
        
        # å®‰å…¨å¤´
        response.headers["X-Content-Type-Options"] = "nosniff"
        response.headers["X-Frame-Options"] = "DENY"
        response.headers["X-XSS-Protection"] = "1; mode=block"
        response.headers["Referrer-Policy"] = "strict-origin-when-cross-origin"
        response.headers["Permissions-Policy"] = "geolocation=(), microphone=(), camera=()"
        
        # CSP (Content Security Policy)
        response.headers["Content-Security-Policy"] = (
            "default-src 'self'; "
            "script-src 'self' 'unsafe-inline' https://js.stripe.com; "
            "style-src 'self' 'unsafe-inline'; "
            "img-src 'self' data: https:; "
            "connect-src 'self' https://api.stripe.com https://api.openai.com; "
            "frame-src https://js.stripe.com; "
        )
        
        return response
```

### 11.5 å®‰å…¨å®¡è®¡

#### 11.5.1 å®¡è®¡æ—¥å¿—

```python
# core/security/audit.py

from enum import Enum
from datetime import datetime

class AuditAction(str, Enum):
    # è®¤è¯äº‹ä»¶
    LOGIN_SUCCESS = "auth.login.success"
    LOGIN_FAILED = "auth.login.failed"
    LOGOUT = "auth.logout"
    TOKEN_REFRESH = "auth.token.refresh"
    PASSWORD_CHANGE = "auth.password.change"
    
    # æ•°æ®è®¿é—®
    JOURNAL_CREATE = "journal.create"
    JOURNAL_READ = "journal.read"
    JOURNAL_UPDATE = "journal.update"
    JOURNAL_DELETE = "journal.delete"
    
    # æ•æ„Ÿæ“ä½œ
    EXPORT_DATA = "data.export"
    DELETE_ACCOUNT = "account.delete"
    SUBSCRIPTION_CHANGE = "subscription.change"
    
    # ç®¡ç†æ“ä½œ
    ADMIN_USER_VIEW = "admin.user.view"
    ADMIN_USER_MODIFY = "admin.user.modify"

class AuditLogger:
    def __init__(self, db: Database):
        self.db = db
    
    async def log(
        self,
        action: AuditAction,
        user_id: str | None,
        resource_type: str | None = None,
        resource_id: str | None = None,
        details: dict | None = None,
        ip_address: str | None = None,
        user_agent: str | None = None,
        success: bool = True,
    ):
        record = AuditLog(
            id=str(uuid.uuid4()),
            timestamp=datetime.utcnow(),
            action=action,
            user_id=user_id,
            resource_type=resource_type,
            resource_id=resource_id,
            details=details or {},
            ip_address=ip_address,
            user_agent=user_agent,
            success=success,
        )
        
        await self.db.execute(
            insert(audit_logs).values(**record.dict())
        )
        
        # åŒæ—¶è®°å½•åˆ°ç»“æ„åŒ–æ—¥å¿—
        logger.info(
            "audit_event",
            action=action,
            user_id=user_id,
            resource_type=resource_type,
            resource_id=resource_id,
            success=success,
        )

# ============ å®¡è®¡ä¸­é—´ä»¶ ============
@app.middleware("http")
async def audit_middleware(request: Request, call_next):
    response = await call_next(request)
    
    # è®°å½•æ•æ„Ÿæ“ä½œ
    if should_audit(request.method, request.url.path):
        await audit_logger.log(
            action=get_audit_action(request),
            user_id=getattr(request.state, "user_id", None),
            ip_address=request.client.host,
            user_agent=request.headers.get("user-agent"),
            success=response.status_code < 400,
        )
    
    return response
```

#### 11.5.2 å®‰å…¨å‘Šè­¦

```python
# core/security/alerts.py

class SecurityAlertService:
    def __init__(self, slack_webhook: str, pagerduty_key: str):
        self.slack_webhook = slack_webhook
        self.pagerduty_key = pagerduty_key
    
    async def alert(
        self,
        severity: str,  # "low" | "medium" | "high" | "critical"
        title: str,
        description: str,
        details: dict,
    ):
        # è®°å½•æ—¥å¿—
        logger.warning(
            "security_alert",
            severity=severity,
            title=title,
            description=description,
            details=details,
        )
        
        # é«˜å±å‘Šè­¦å‘é€ PagerDuty
        if severity in ["high", "critical"]:
            await self._send_pagerduty(title, description, details)
        
        # æ‰€æœ‰å‘Šè­¦å‘é€ Slack
        await self._send_slack(severity, title, description, details)

# ============ å®‰å…¨è§„åˆ™ ============
SECURITY_RULES = {
    "brute_force": {
        "threshold": 5,          # 5 æ¬¡å¤±è´¥
        "window_seconds": 300,   # 5 åˆ†é’Ÿå†…
        "action": "block_ip",
        "severity": "high",
    },
    "unusual_location": {
        "action": "alert",
        "severity": "medium",
    },
    "mass_data_access": {
        "threshold": 100,        # 100 æ¡è®°å½•
        "window_seconds": 60,    # 1 åˆ†é’Ÿå†…
        "action": "alert",
        "severity": "high",
    },
}

async def check_brute_force(user_id: str, ip_address: str) -> bool:
    """æ£€æµ‹æš´åŠ›ç ´è§£"""
    key = f"login_failures:{ip_address}"
    failures = await redis.incr(key)
    await redis.expire(key, 300)
    
    if failures >= SECURITY_RULES["brute_force"]["threshold"]:
        await security_alerts.alert(
            severity="high",
            title="Brute Force Attack Detected",
            description=f"Multiple failed login attempts from {ip_address}",
            details={"ip": ip_address, "attempts": failures},
        )
        # å°ç¦ IP
        await redis.setex(f"blocked_ip:{ip_address}", 3600, "1")
        return True
    
    return False
```

### 11.6 å®‰å…¨æ£€æŸ¥æ¸…å•

| ç±»åˆ« | æ£€æŸ¥é¡¹ | çŠ¶æ€ |
|------|--------|------|
| **è®¤è¯** | JWT ç­¾åéªŒè¯ | âœ… |
| | Token è¿‡æœŸæ£€æŸ¥ | âœ… |
| | Token æ’¤é”€æœºåˆ¶ | âœ… |
| | å¯†ç å“ˆå¸Œï¼ˆbcryptï¼‰ | âœ… |
| | OAuth2 ç¤¾äº¤ç™»å½• | âœ… |
| **æˆæƒ** | RBAC æƒé™æ¨¡å‹ | âœ… |
| | èµ„æºçº§æƒé™æ£€æŸ¥ | âœ… |
| | å¤šç§Ÿæˆ·éš”ç¦» | âœ… |
| **ä¼ è¾“å®‰å…¨** | TLS 1.3 | âœ… |
| | HSTS | âœ… |
| | è¯ä¹¦è‡ªåŠ¨ç»­æœŸ | âœ… |
| **æ•°æ®å®‰å…¨** | æ•æ„Ÿå­—æ®µåŠ å¯† | âœ… |
| | å¯†é’¥ç®¡ç†ï¼ˆAWS Secrets Managerï¼‰ | âœ… |
| | PII è„±æ• | âœ… |
| **API å®‰å…¨** | è¾“å…¥éªŒè¯ | âœ… |
| | CORS é…ç½® | âœ… |
| | å®‰å…¨å“åº”å¤´ | âœ… |
| | Rate Limiting | âœ… |
| | Prompt Injection é˜²æŠ¤ | âœ… |
| **å®¡è®¡** | å®¡è®¡æ—¥å¿— | âœ… |
| | å®‰å…¨å‘Šè­¦ | âœ… |
| | æš´åŠ›ç ´è§£æ£€æµ‹ | âœ… |

---

## 12. æ•°æ®åº“è®¾è®¡

### 12.1 ER å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              AIWendy ER å›¾                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚    users     â”‚         â”‚ subscriptionsâ”‚         â”‚   coaches    â”‚        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚  â”‚ id (PK)      â”‚â”€â”€â”€â”€â”    â”‚ id (PK)      â”‚         â”‚ id (PK)      â”‚        â”‚
â”‚  â”‚ email        â”‚    â”‚    â”‚ user_id (FK) â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚ name         â”‚        â”‚
â”‚  â”‚ password_hashâ”‚    â”‚    â”‚ tier         â”‚         â”‚ style        â”‚        â”‚
â”‚  â”‚ name         â”‚    â”‚    â”‚ status       â”‚         â”‚ specialty    â”‚        â”‚
â”‚  â”‚ avatar_url   â”‚    â”‚    â”‚ stripe_sub_idâ”‚         â”‚ llm_provider â”‚        â”‚
â”‚  â”‚ tier         â”‚    â”‚    â”‚ current_periodâ”‚        â”‚ llm_model    â”‚        â”‚
â”‚  â”‚ created_at   â”‚    â”‚    â”‚ created_at   â”‚         â”‚ system_promptâ”‚        â”‚
â”‚  â”‚ updated_at   â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ is_premium   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                             â”‚ is_public    â”‚        â”‚
â”‚         â”‚            â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚            â”‚                                    â”‚                â”‚
â”‚         â”‚            â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚                â”‚
â”‚         â”‚            â””â”€â”€â”€â–¶â”‚   journals   â”‚                â”‚                â”‚
â”‚         â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚                â”‚
â”‚         â”‚                 â”‚ id (PK)      â”‚                â”‚                â”‚
â”‚         â”‚                 â”‚ user_id (FK) â”‚                â”‚                â”‚
â”‚         â”‚                 â”‚ symbol       â”‚                â”‚                â”‚
â”‚         â”‚                 â”‚ direction    â”‚                â”‚                â”‚
â”‚         â”‚                 â”‚ pnl          â”‚                â”‚                â”‚
â”‚         â”‚                 â”‚ entry_emotionâ”‚                â”‚                â”‚
â”‚         â”‚                 â”‚ exit_emotion â”‚                â”‚                â”‚
â”‚         â”‚                 â”‚ content      â”‚  (åŠ å¯†)         â”‚                â”‚
â”‚         â”‚                 â”‚ embedding    â”‚  (å‘é‡)         â”‚                â”‚
â”‚         â”‚                 â”‚ trade_date   â”‚                â”‚                â”‚
â”‚         â”‚                 â”‚ created_at   â”‚                â”‚                â”‚
â”‚         â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚                â”‚
â”‚         â”‚                        â”‚                        â”‚                â”‚
â”‚         â”‚                        â”‚                        â”‚                â”‚
â”‚         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                â”‚
â”‚         â””â”€â”€â”€â–¶â”‚ conversationsâ”‚â—„â”€â”€â”€â”˜    â”‚   messages   â”‚    â”‚                â”‚
â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚                â”‚
â”‚              â”‚ id (PK)      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ id (PK)      â”‚    â”‚                â”‚
â”‚              â”‚ user_id (FK) â”‚         â”‚ conv_id (FK) â”‚    â”‚                â”‚
â”‚              â”‚ coach_id (FK)â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚ role         â”‚â—„â”€â”€â”€â”˜                â”‚
â”‚              â”‚ journal_id   â”‚         â”‚ content      â”‚                     â”‚
â”‚              â”‚ title        â”‚         â”‚ tokens       â”‚                     â”‚
â”‚              â”‚ created_at   â”‚         â”‚ created_at   â”‚                     â”‚
â”‚              â”‚ updated_at   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚                                                                             â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚         â”‚   patterns   â”‚         â”‚   reports    â”‚         â”‚ audit_logs   â”‚ â”‚
â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚         â”‚ id (PK)      â”‚         â”‚ id (PK)      â”‚         â”‚ id (PK)      â”‚ â”‚
â”‚         â”‚ user_id (FK) â”‚         â”‚ user_id (FK) â”‚         â”‚ user_id      â”‚ â”‚
â”‚         â”‚ type         â”‚         â”‚ type         â”‚         â”‚ action       â”‚ â”‚
â”‚         â”‚ description  â”‚         â”‚ period_start â”‚         â”‚ resource_typeâ”‚ â”‚
â”‚         â”‚ occurrences  â”‚         â”‚ period_end   â”‚         â”‚ resource_id  â”‚ â”‚
â”‚         â”‚ first_seen   â”‚         â”‚ data (JSONB) â”‚         â”‚ ip_address   â”‚ â”‚
â”‚         â”‚ last_seen    â”‚         â”‚ created_at   â”‚         â”‚ timestamp    â”‚ â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 12.2 æ ¸å¿ƒè¡¨ç»“æ„

```sql
-- ============ ç”¨æˆ·è¡¨ ============
CREATE TABLE users (
    id              VARCHAR(36) PRIMARY KEY DEFAULT gen_random_uuid()::text,
    email           VARCHAR(255) NOT NULL UNIQUE,
    password_hash   VARCHAR(255),  -- NULL è¡¨ç¤º OAuth ç™»å½•
    name            VARCHAR(100),
    avatar_url      VARCHAR(500),
    tier            VARCHAR(20) NOT NULL DEFAULT 'free',  -- free/pro/enterprise
    tenant_id       VARCHAR(36) DEFAULT 'default',
    
    -- OAuth å…³è”
    oauth_provider  VARCHAR(20),   -- google/github
    oauth_id        VARCHAR(100),
    
    -- åå¥½è®¾ç½®
    preferences     JSONB DEFAULT '{}',
    timezone        VARCHAR(50) DEFAULT 'UTC',
    language        VARCHAR(10) DEFAULT 'zh-CN',
    
    -- æ—¶é—´æˆ³
    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    last_login_at   TIMESTAMP WITH TIME ZONE,
    
    -- ç´¢å¼•æ”¯æŒ
    CONSTRAINT users_oauth_unique UNIQUE (oauth_provider, oauth_id)
);

CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_tenant ON users(tenant_id);
CREATE INDEX idx_users_tier ON users(tier);

-- ============ è®¢é˜…è¡¨ ============
CREATE TABLE subscriptions (
    id                  VARCHAR(36) PRIMARY KEY DEFAULT gen_random_uuid()::text,
    user_id             VARCHAR(36) NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    
    -- Stripe ä¿¡æ¯
    stripe_customer_id  VARCHAR(100),
    stripe_subscription_id VARCHAR(100),
    
    -- è®¢é˜…çŠ¶æ€
    tier                VARCHAR(20) NOT NULL,  -- free/pro/enterprise
    status              VARCHAR(20) NOT NULL,  -- active/canceled/past_due/trialing
    
    -- è®¡è´¹å‘¨æœŸ
    current_period_start TIMESTAMP WITH TIME ZONE,
    current_period_end   TIMESTAMP WITH TIME ZONE,
    cancel_at            TIMESTAMP WITH TIME ZONE,
    
    -- ç”¨é‡è¿½è¸ª
    chat_count          INTEGER DEFAULT 0,
    journal_count       INTEGER DEFAULT 0,
    
    created_at          TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at          TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_subscriptions_user ON subscriptions(user_id);
CREATE INDEX idx_subscriptions_stripe ON subscriptions(stripe_subscription_id);

-- ============ æ•™ç»ƒè¡¨ ============
CREATE TABLE coaches (
    id              VARCHAR(36) PRIMARY KEY,
    name            VARCHAR(100) NOT NULL,
    display_name    VARCHAR(100) NOT NULL,
    avatar_url      VARCHAR(500),
    
    -- æ•™ç»ƒç‰¹å¾
    style           VARCHAR(50) NOT NULL,  -- empathetic/disciplined/analytical
    specialty       TEXT[] DEFAULT '{}',
    language        VARCHAR(10) DEFAULT 'zh-CN',
    
    -- LLM é…ç½®
    llm_provider    VARCHAR(20) NOT NULL,  -- openai/anthropic/local
    llm_model       VARCHAR(50) NOT NULL,
    system_prompt   TEXT NOT NULL,
    temperature     FLOAT DEFAULT 0.7,
    max_tokens      INTEGER DEFAULT 2000,
    
    -- è®¿é—®æ§åˆ¶
    is_premium      BOOLEAN DEFAULT FALSE,
    is_public       BOOLEAN DEFAULT TRUE,
    created_by      VARCHAR(36) REFERENCES users(id),
    tenant_id       VARCHAR(36) DEFAULT 'default',
    
    -- ç»Ÿè®¡
    usage_count     BIGINT DEFAULT 0,
    avg_rating      FLOAT,
    
    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_coaches_public ON coaches(is_public, is_premium);
CREATE INDEX idx_coaches_tenant ON coaches(tenant_id);

-- ============ æ—¥è®°è¡¨ ============
CREATE TABLE journals (
    id              VARCHAR(36) PRIMARY KEY DEFAULT gen_random_uuid()::text,
    user_id         VARCHAR(36) NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    tenant_id       VARCHAR(36) DEFAULT 'default',
    
    -- äº¤æ˜“ä¿¡æ¯
    symbol          VARCHAR(20) NOT NULL,
    direction       VARCHAR(10) NOT NULL,  -- long/short
    pnl             DECIMAL(15, 2),
    pnl_percent     DECIMAL(8, 4),
    
    -- æƒ…ç»ªè¯„åˆ†
    entry_emotion   SMALLINT CHECK (entry_emotion BETWEEN 1 AND 5),
    exit_emotion    SMALLINT CHECK (exit_emotion BETWEEN 1 AND 5),
    
    -- å†…å®¹ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰
    content         TEXT,  -- åŠ å¯†åçš„æ—¥è®°å†…å®¹
    notes           TEXT,  -- åŠ å¯†åçš„å¤‡æ³¨
    
    -- è§„åˆ™è¿å
    rule_violated   BOOLEAN DEFAULT FALSE,
    violation_type  VARCHAR(50),
    
    -- å‘é‡åµŒå…¥ï¼ˆç”¨äºç›¸ä¼¼æœç´¢ï¼‰
    embedding       vector(1536),  -- OpenAI ada-002 ç»´åº¦
    
    -- AI åˆ†æç»“æœ
    ai_analysis     JSONB,
    detected_patterns TEXT[],
    
    -- æ—¶é—´
    trade_date      DATE NOT NULL,
    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_journals_user ON journals(user_id);
CREATE INDEX idx_journals_user_date ON journals(user_id, trade_date DESC);
CREATE INDEX idx_journals_tenant ON journals(tenant_id);
CREATE INDEX idx_journals_embedding ON journals USING ivfflat (embedding vector_cosine_ops) WITH (lists = 100);

-- ============ å¯¹è¯è¡¨ ============
CREATE TABLE conversations (
    id              VARCHAR(36) PRIMARY KEY DEFAULT gen_random_uuid()::text,
    user_id         VARCHAR(36) NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    coach_id        VARCHAR(36) NOT NULL REFERENCES coaches(id),
    journal_id      VARCHAR(36) REFERENCES journals(id),
    tenant_id       VARCHAR(36) DEFAULT 'default',
    
    -- å¯¹è¯ä¿¡æ¯
    title           VARCHAR(200),
    summary         TEXT,
    
    -- ç»Ÿè®¡
    message_count   INTEGER DEFAULT 0,
    total_tokens    INTEGER DEFAULT 0,
    
    -- æ—¶é—´
    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    last_message_at TIMESTAMP WITH TIME ZONE
);

CREATE INDEX idx_conversations_user ON conversations(user_id);
CREATE INDEX idx_conversations_user_recent ON conversations(user_id, updated_at DESC);

-- ============ æ¶ˆæ¯è¡¨ ============
CREATE TABLE messages (
    id              VARCHAR(36) PRIMARY KEY DEFAULT gen_random_uuid()::text,
    conversation_id VARCHAR(36) NOT NULL REFERENCES conversations(id) ON DELETE CASCADE,
    
    -- æ¶ˆæ¯å†…å®¹
    role            VARCHAR(20) NOT NULL,  -- user/assistant/system
    content         TEXT NOT NULL,
    
    -- Token ç»Ÿè®¡
    tokens          INTEGER,
    
    -- å…ƒæ•°æ®
    metadata        JSONB DEFAULT '{}',
    
    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_messages_conversation ON messages(conversation_id);
CREATE INDEX idx_messages_conversation_time ON messages(conversation_id, created_at);

-- ============ æ¨¡å¼è¯†åˆ«è¡¨ ============
CREATE TABLE patterns (
    id              VARCHAR(36) PRIMARY KEY DEFAULT gen_random_uuid()::text,
    user_id         VARCHAR(36) NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    
    -- æ¨¡å¼ä¿¡æ¯
    type            VARCHAR(50) NOT NULL,  -- revenge_trading/fomo/overconfidence
    description     TEXT,
    severity        VARCHAR(20),  -- low/medium/high
    
    -- ç»Ÿè®¡
    occurrences     INTEGER DEFAULT 1,
    first_seen      TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    last_seen       TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    
    -- ç›¸å…³æ—¥è®°
    related_journals TEXT[] DEFAULT '{}'
);

CREATE INDEX idx_patterns_user ON patterns(user_id);
CREATE INDEX idx_patterns_user_type ON patterns(user_id, type);

-- ============ æŠ¥å‘Šè¡¨ ============
CREATE TABLE reports (
    id              VARCHAR(36) PRIMARY KEY DEFAULT gen_random_uuid()::text,
    user_id         VARCHAR(36) NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    
    -- æŠ¥å‘Šç±»å‹
    type            VARCHAR(20) NOT NULL,  -- weekly/monthly
    
    -- æ—¶é—´èŒƒå›´
    period_start    DATE NOT NULL,
    period_end      DATE NOT NULL,
    
    -- æŠ¥å‘Šæ•°æ®
    data            JSONB NOT NULL,
    
    -- ç”ŸæˆçŠ¶æ€
    status          VARCHAR(20) DEFAULT 'pending',  -- pending/generating/completed/failed
    
    created_at      TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_reports_user ON reports(user_id);
CREATE INDEX idx_reports_user_period ON reports(user_id, period_start DESC);

-- ============ å®¡è®¡æ—¥å¿—è¡¨ ============
CREATE TABLE audit_logs (
    id              VARCHAR(36) PRIMARY KEY DEFAULT gen_random_uuid()::text,
    
    -- äº‹ä»¶ä¿¡æ¯
    action          VARCHAR(50) NOT NULL,
    user_id         VARCHAR(36),
    
    -- èµ„æºä¿¡æ¯
    resource_type   VARCHAR(50),
    resource_id     VARCHAR(36),
    
    -- è¯·æ±‚ä¿¡æ¯
    ip_address      INET,
    user_agent      TEXT,
    
    -- è¯¦æƒ…
    details         JSONB DEFAULT '{}',
    success         BOOLEAN DEFAULT TRUE,
    
    timestamp       TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ä½¿ç”¨ TimescaleDB è¿›è¡Œæ—¶åºä¼˜åŒ–
SELECT create_hypertable('audit_logs', 'timestamp', if_not_exists => TRUE);

CREATE INDEX idx_audit_user ON audit_logs(user_id, timestamp DESC);
CREATE INDEX idx_audit_action ON audit_logs(action, timestamp DESC);
```

### 12.3 ç´¢å¼•ç­–ç•¥

| è¡¨ | ç´¢å¼• | ç±»å‹ | ç”¨é€” |
|-----|------|------|------|
| users | email | B-tree UNIQUE | ç™»å½•æŸ¥è¯¢ |
| users | tenant_id | B-tree | å¤šç§Ÿæˆ·è¿‡æ»¤ |
| journals | (user_id, trade_date) | B-tree | ç”¨æˆ·æ—¥è®°åˆ—è¡¨ |
| journals | embedding | IVFFlat | å‘é‡ç›¸ä¼¼æœç´¢ |
| conversations | (user_id, updated_at) | B-tree | æœ€è¿‘å¯¹è¯åˆ—è¡¨ |
| messages | (conversation_id, created_at) | B-tree | å¯¹è¯æ¶ˆæ¯åŠ è½½ |
| audit_logs | (user_id, timestamp) | B-tree | ç”¨æˆ·å®¡è®¡æŸ¥è¯¢ |

### 12.4 åˆ†åŒºç­–ç•¥

```sql
-- ============ å®¡è®¡æ—¥å¿—æŒ‰æœˆåˆ†åŒºï¼ˆTimescaleDBï¼‰============
-- å·²é€šè¿‡ create_hypertable è‡ªåŠ¨å¤„ç†

-- ============ æ¶ˆæ¯è¡¨æŒ‰æœˆåˆ†åŒºï¼ˆå¤§è§„æ¨¡åï¼‰============
-- é¢„ç•™ï¼šå½“æ¶ˆæ¯é‡è¶…è¿‡ 1 äº¿æ—¶å¯ç”¨
CREATE TABLE messages_partitioned (
    LIKE messages INCLUDING ALL
) PARTITION BY RANGE (created_at);

-- åˆ›å»ºåˆ†åŒº
CREATE TABLE messages_2024_01 PARTITION OF messages_partitioned
    FOR VALUES FROM ('2024-01-01') TO ('2024-02-01');
```

### 12.5 æ•°æ®ç”Ÿå‘½å‘¨æœŸ

| æ•°æ®ç±»å‹ | ä¿ç•™ç­–ç•¥ | è¯´æ˜ |
|----------|----------|------|
| ç”¨æˆ·æ•°æ® | æ°¸ä¹…ï¼ˆæˆ–ç”¨æˆ·åˆ é™¤ï¼‰ | GDPR åˆ é™¤æƒ |
| æ—¥è®°å†…å®¹ | æ°¸ä¹… | æ ¸å¿ƒä¸šåŠ¡æ•°æ® |
| å¯¹è¯æ¶ˆæ¯ | 1 å¹´ | ä¹‹åå½’æ¡£åˆ°å†·å­˜å‚¨ |
| å®¡è®¡æ—¥å¿— | 3 å¹´ | åˆè§„è¦æ±‚ |
| åˆ†ææŠ¥å‘Š | 2 å¹´ | ä¹‹ååˆ é™¤ |
| ä¼šè¯ç¼“å­˜ | 24 å°æ—¶ | Redis TTL |

---

## 13. API è§„èŒƒ

### 13.1 RESTful è®¾è®¡åŸåˆ™

| åŸåˆ™ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| èµ„æºå‘½å | åè¯å¤æ•°ï¼Œå°å†™ï¼Œè¿å­—ç¬¦ | `/api/v1/journals` |
| HTTP æ–¹æ³• | GET/POST/PUT/PATCH/DELETE | `POST /journals` åˆ›å»º |
| çŠ¶æ€ç  | æ ‡å‡† HTTP çŠ¶æ€ç  | 201 Created, 404 Not Found |
| ç‰ˆæœ¬æ§åˆ¶ | URL è·¯å¾„ç‰ˆæœ¬ | `/api/v1/`, `/api/v2/` |

### 13.2 ç»Ÿä¸€å“åº”æ ¼å¼

#### æˆåŠŸå“åº”

```json
// å•ä¸ªèµ„æº
{
  "data": {
    "id": "journal-123",
    "symbol": "AAPL",
    "pnl": 150.00,
    "created_at": "2024-01-15T10:30:00Z"
  }
}

// åˆ—è¡¨èµ„æº
{
  "data": [
    {"id": "journal-123", ...},
    {"id": "journal-124", ...}
  ],
  "pagination": {
    "page": 1,
    "per_page": 20,
    "total": 156,
    "total_pages": 8
  }
}

// ç©ºå“åº”
{
  "data": null
}
```

#### é”™è¯¯å“åº”

```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid request parameters",
    "details": {
      "pnl": ["Must be a number"],
      "symbol": ["Required field"]
    },
    "request_id": "req-abc123"
  }
}
```

### 13.3 é”™è¯¯ç ä½“ç³»

| é”™è¯¯ç  | HTTP çŠ¶æ€ç  | è¯´æ˜ |
|--------|-------------|------|
| **è®¤è¯é”™è¯¯** | | |
| AUTH_REQUIRED | 401 | æœªæä¾›è®¤è¯ä¿¡æ¯ |
| AUTH_INVALID | 401 | Token æ— æ•ˆæˆ–è¿‡æœŸ |
| AUTH_EXPIRED | 401 | Token å·²è¿‡æœŸ |
| **æˆæƒé”™è¯¯** | | |
| PERMISSION_DENIED | 403 | æ— æƒé™è®¿é—® |
| INSUFFICIENT_QUOTA | 403 | é…é¢ä¸è¶³ |
| TIER_REQUIRED | 403 | éœ€è¦æ›´é«˜è®¢é˜…ç­‰çº§ |
| **èµ„æºé”™è¯¯** | | |
| NOT_FOUND | 404 | èµ„æºä¸å­˜åœ¨ |
| ALREADY_EXISTS | 409 | èµ„æºå·²å­˜åœ¨ |
| CONFLICT | 409 | èµ„æºå†²çª |
| **è¯·æ±‚é”™è¯¯** | | |
| VALIDATION_ERROR | 400 | å‚æ•°éªŒè¯å¤±è´¥ |
| INVALID_FORMAT | 400 | æ ¼å¼é”™è¯¯ |
| MISSING_FIELD | 400 | ç¼ºå°‘å¿…å¡«å­—æ®µ |
| **é™æµé”™è¯¯** | | |
| RATE_LIMIT_EXCEEDED | 429 | è¶…å‡ºé€Ÿç‡é™åˆ¶ |
| QUOTA_EXCEEDED | 429 | è¶…å‡ºé…é¢ |
| **æœåŠ¡é”™è¯¯** | | |
| INTERNAL_ERROR | 500 | å†…éƒ¨é”™è¯¯ |
| SERVICE_UNAVAILABLE | 503 | æœåŠ¡ä¸å¯ç”¨ |
| LLM_ERROR | 503 | LLM æœåŠ¡é”™è¯¯ |

### 13.4 æ ¸å¿ƒ API ç«¯ç‚¹

#### è®¤è¯

```yaml
POST /api/v1/auth/register:
  summary: ç”¨æˆ·æ³¨å†Œ
  body:
    email: string (required)
    password: string (required, min 8 chars)
    name: string (optional)
  response: 201
    data:
      user: User
      tokens: TokenPair

POST /api/v1/auth/login:
  summary: ç”¨æˆ·ç™»å½•
  body:
    email: string
    password: string
  response: 200
    data:
      user: User
      tokens: TokenPair

POST /api/v1/auth/refresh:
  summary: åˆ·æ–° Token
  body:
    refresh_token: string
  response: 200
    data:
      tokens: TokenPair

POST /api/v1/auth/logout:
  summary: ç™»å‡º
  headers:
    Authorization: Bearer <token>
  response: 204

GET /api/v1/auth/{provider}:
  summary: OAuth ç™»å½•è·³è½¬
  params:
    provider: google | github
  response: 302 Redirect

GET /api/v1/auth/{provider}/callback:
  summary: OAuth å›è°ƒ
  response: 200
    data:
      user: User
      tokens: TokenPair
```

#### æ—¥è®°

```yaml
GET /api/v1/journals:
  summary: è·å–æ—¥è®°åˆ—è¡¨
  headers:
    Authorization: Bearer <token>
  query:
    page: integer (default 1)
    per_page: integer (default 20, max 100)
    start_date: date (optional)
    end_date: date (optional)
    symbol: string (optional)
  response: 200
    data: Journal[]
    pagination: Pagination

POST /api/v1/journals:
  summary: åˆ›å»ºæ—¥è®°
  headers:
    Authorization: Bearer <token>
  body:
    symbol: string (required)
    direction: "long" | "short"
    pnl: number
    entry_emotion: 1-5
    exit_emotion: 1-5
    content: string (optional)
    trade_date: date (required)
  response: 201
    data: Journal

GET /api/v1/journals/{id}:
  summary: è·å–å•æ¡æ—¥è®°
  response: 200
    data: Journal

PUT /api/v1/journals/{id}:
  summary: æ›´æ–°æ—¥è®°
  response: 200
    data: Journal

DELETE /api/v1/journals/{id}:
  summary: åˆ é™¤æ—¥è®°
  response: 204

GET /api/v1/journals/search:
  summary: ç›¸ä¼¼æ—¥è®°æœç´¢
  query:
    q: string (æœç´¢å…³é”®è¯)
    limit: integer (default 5)
  response: 200
    data: Journal[]
```

#### æ•™ç»ƒå¯¹è¯

```yaml
GET /api/v1/coaches:
  summary: è·å–å¯ç”¨æ•™ç»ƒåˆ—è¡¨
  response: 200
    data: Coach[]

GET /api/v1/coaches/{id}:
  summary: è·å–æ•™ç»ƒè¯¦æƒ…
  response: 200
    data: Coach

POST /api/v1/chat:
  summary: å‘èµ·å¯¹è¯ï¼ˆæµå¼å“åº”ï¼‰
  headers:
    Authorization: Bearer <token>
    Accept: text/event-stream
  body:
    coach_id: string (required)
    messages: Message[] (required)
    conversation_id: string (optional, ç»­æ¥å¯¹è¯)
    journal_id: string (optional, å…³è”æ—¥è®°)
  response: 200
    content-type: text/event-stream
    body: SSE stream
      event: token
      data: {"content": "Hello", "conversation_id": "conv-123"}
      
      event: done
      data: {"tokens_used": 150}

GET /api/v1/conversations:
  summary: è·å–å¯¹è¯å†å²åˆ—è¡¨
  query:
    page: integer
    per_page: integer
    coach_id: string (optional)
  response: 200
    data: Conversation[]

GET /api/v1/conversations/{id}:
  summary: è·å–å¯¹è¯è¯¦æƒ…ï¼ˆå«æ¶ˆæ¯ï¼‰
  response: 200
    data:
      conversation: Conversation
      messages: Message[]
```

#### åˆ†æ

```yaml
GET /api/v1/analysis/patterns:
  summary: è·å–è¯†åˆ«çš„å¿ƒç†æ¨¡å¼
  query:
    days: integer (default 30)
  response: 200
    data: Pattern[]

GET /api/v1/analysis/stats:
  summary: è·å–ç»Ÿè®¡æ•°æ®
  query:
    period: "week" | "month" | "quarter" | "year"
  response: 200
    data:
      trade_count: integer
      win_rate: number
      avg_pnl: number
      avg_emotion: number
      patterns: Pattern[]

GET /api/v1/reports:
  summary: è·å–æŠ¥å‘Šåˆ—è¡¨
  query:
    type: "weekly" | "monthly"
  response: 200
    data: Report[]

GET /api/v1/reports/{id}:
  summary: è·å–æŠ¥å‘Šè¯¦æƒ…
  response: 200
    data: Report

POST /api/v1/reports/generate:
  summary: æ‰‹åŠ¨ç”ŸæˆæŠ¥å‘Š
  body:
    type: "weekly" | "monthly"
    period_start: date
    period_end: date
  response: 202
    data:
      report_id: string
      status: "pending"
```

### 13.5 åˆ†é¡µè§„èŒƒ

```python
# schemas/pagination.py

class PaginationParams(BaseModel):
    page: int = Field(default=1, ge=1)
    per_page: int = Field(default=20, ge=1, le=100)
    
    @property
    def offset(self) -> int:
        return (self.page - 1) * self.per_page

class PaginatedResponse(BaseModel, Generic[T]):
    data: list[T]
    pagination: PaginationMeta

class PaginationMeta(BaseModel):
    page: int
    per_page: int
    total: int
    total_pages: int
    
    @classmethod
    def from_params(cls, params: PaginationParams, total: int):
        return cls(
            page=params.page,
            per_page=params.per_page,
            total=total,
            total_pages=math.ceil(total / params.per_page),
        )
```

### 13.6 è¿‡æ»¤ä¸æ’åº

```yaml
# è¿‡æ»¤
GET /api/v1/journals?symbol=AAPL&direction=long&start_date=2024-01-01

# æ’åº
GET /api/v1/journals?sort=-trade_date  # é™åº
GET /api/v1/journals?sort=pnl          # å‡åº
GET /api/v1/journals?sort=-trade_date,symbol  # å¤šå­—æ®µ

# å­—æ®µé€‰æ‹©
GET /api/v1/journals?fields=id,symbol,pnl
```

---

## 14. DevOps ä¸ CI/CD

### 14.1 Git åˆ†æ”¯ç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Trunk-Based Development                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  main (production)                                              â”‚
â”‚  â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â–¶                â”‚
â”‚       â•²    â•²    â•²    â•²    â•±    â•±    â•±                           â”‚
â”‚        â•²    â•²    â•²    â•²  â•±    â•±    â•±                            â”‚
â”‚  feature/xxx  â—â”€â”€â”€â”€â—â”€â”€â•³                                         â”‚
â”‚                                                                 â”‚
â”‚  release/v1.2.0                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â–¶ (hotfix only)                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åˆ†æ”¯å‘½åè§„èŒƒï¼š
- feature/xxx    åŠŸèƒ½åˆ†æ”¯
- bugfix/xxx     Bug ä¿®å¤
- hotfix/xxx     ç”Ÿäº§çƒ­ä¿®å¤
- release/v1.x   å‘å¸ƒåˆ†æ”¯
```

### 14.2 CI æµæ°´çº¿

```yaml
# .github/workflows/ci.yml

name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  PYTHON_VERSION: "3.11"
  NODE_VERSION: "20"

jobs:
  # ============ åç«¯æ£€æŸ¥ ============
  backend-lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}
      
      - name: Install dependencies
        run: |
          pip install ruff mypy
          pip install -r apps/api/requirements.txt
      
      - name: Lint with Ruff
        run: ruff check apps/api
      
      - name: Type check with MyPy
        run: mypy apps/api --ignore-missing-imports

  backend-test:
    runs-on: ubuntu-latest
    needs: backend-lint
    
    services:
      postgres:
        image: pgvector/pgvector:pg16
        env:
          POSTGRES_USER: test
          POSTGRES_PASSWORD: test
          POSTGRES_DB: test_aiwendy
        ports:
          - 5432:5432
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
      
      redis:
        image: redis:7-alpine
        ports:
          - 6379:6379
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}
      
      - name: Install dependencies
        run: pip install -r apps/api/requirements.txt
      
      - name: Run tests
        env:
          DATABASE_URL: postgresql://test:test@localhost:5432/test_aiwendy
          REDIS_URL: redis://localhost:6379
        run: |
          pytest apps/api/tests \
            --cov=apps/api \
            --cov-report=xml \
            --cov-report=html \
            -v
      
      - name: Upload coverage
        uses: codecov/codecov-action@v4
        with:
          files: coverage.xml

  # ============ å‰ç«¯æ£€æŸ¥ ============
  frontend-lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Node
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          cache-dependency-path: apps/web/package-lock.json
      
      - name: Install dependencies
        run: npm ci
        working-directory: apps/web
      
      - name: Lint
        run: npm run lint
        working-directory: apps/web
      
      - name: Type check
        run: npm run type-check
        working-directory: apps/web

  frontend-build:
    runs-on: ubuntu-latest
    needs: frontend-lint
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Node
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          cache-dependency-path: apps/web/package-lock.json
      
      - name: Install dependencies
        run: npm ci
        working-directory: apps/web
      
      - name: Build
        run: npm run build
        working-directory: apps/web

  # ============ å®‰å…¨æ‰«æ ============
  security-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Run Trivy vulnerability scanner
        uses: aquasecurity/trivy-action@master
        with:
          scan-type: 'fs'
          scan-ref: '.'
          severity: 'CRITICAL,HIGH'
          exit-code: '1'
      
      - name: Run Snyk to check for vulnerabilities
        uses: snyk/actions/python@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
        with:
          args: --severity-threshold=high

  # ============ Docker æ„å»º ============
  docker-build:
    runs-on: ubuntu-latest
    needs: [backend-test, frontend-build]
    if: github.ref == 'refs/heads/main'
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
      
      - name: Login to Container Registry
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Build and push API
        uses: docker/build-push-action@v5
        with:
          context: apps/api
          push: true
          tags: |
            ghcr.io/${{ github.repository }}/api:${{ github.sha }}
            ghcr.io/${{ github.repository }}/api:latest
          cache-from: type=gha
          cache-to: type=gha,mode=max
```

### 14.3 CD æµæ°´çº¿

```yaml
# .github/workflows/cd.yml

name: CD

on:
  push:
    branches: [main]
    paths:
      - 'apps/**'
      - 'Dockerfile'

jobs:
  deploy-staging:
    runs-on: ubuntu-latest
    environment: staging
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Deploy to Railway (Staging)
        uses: railwayapp/cli-action@v1
        with:
          railway_token: ${{ secrets.RAILWAY_TOKEN }}
          service: api-staging
        env:
          RAILWAY_ENVIRONMENT: staging
      
      - name: Run E2E tests
        run: |
          npm run test:e2e
        env:
          API_URL: https://staging-api.aiwendy.com
      
      - name: Notify Slack
        uses: slackapi/slack-github-action@v1
        with:
          payload: |
            {
              "text": "âœ… Staging deployment successful"
            }
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}

  deploy-production:
    runs-on: ubuntu-latest
    needs: deploy-staging
    environment: production
    
    steps:
      - uses: actions/checkout@v4
      
      # Canary éƒ¨ç½²
      - name: Deploy Canary (10%)
        uses: railwayapp/cli-action@v1
        with:
          railway_token: ${{ secrets.RAILWAY_TOKEN }}
          service: api-canary
        env:
          RAILWAY_ENVIRONMENT: production
          CANARY_WEIGHT: 10
      
      - name: Monitor Canary (5 min)
        run: |
          # ç›‘æ§é”™è¯¯ç‡å’Œå»¶è¿Ÿ
          sleep 300
          ./scripts/check-canary-health.sh
      
      # å…¨é‡éƒ¨ç½²
      - name: Deploy Production (100%)
        uses: railwayapp/cli-action@v1
        with:
          railway_token: ${{ secrets.RAILWAY_TOKEN }}
          service: api-production
        env:
          RAILWAY_ENVIRONMENT: production
      
      - name: Create Sentry Release
        uses: getsentry/action-release@v1
        env:
          SENTRY_AUTH_TOKEN: ${{ secrets.SENTRY_AUTH_TOKEN }}
          SENTRY_ORG: aiwendy
          SENTRY_PROJECT: api
        with:
          environment: production
          version: ${{ github.sha }}
```

### 14.4 ç¯å¢ƒç®¡ç†

| ç¯å¢ƒ | ç”¨é€” | URL | éƒ¨ç½²æ–¹å¼ |
|------|------|-----|----------|
| **development** | æœ¬åœ°å¼€å‘ | localhost:3000/8000 | docker-compose |
| **staging** | æµ‹è¯•éªŒè¯ | staging.aiwendy.com | è‡ªåŠ¨ï¼ˆpush to mainï¼‰ |
| **production** | æ­£å¼ç¯å¢ƒ | aiwendy.com | æ‰‹åŠ¨å®¡æ‰¹ + Canary |

### 14.5 åŸºç¡€è®¾æ–½å³ä»£ç 

```hcl
# terraform/main.tf

terraform {
  required_providers {
    vercel = {
      source = "vercel/vercel"
    }
    railway = {
      source = "terraform-community/railway"
    }
    aws = {
      source = "hashicorp/aws"
    }
  }
  
  backend "s3" {
    bucket = "aiwendy-terraform-state"
    key    = "prod/terraform.tfstate"
    region = "us-east-1"
  }
}

# ============ Vercel å‰ç«¯ ============
resource "vercel_project" "web" {
  name      = "aiwendy-web"
  framework = "nextjs"
  
  git_repository {
    type = "github"
    repo = "aiwendy/aiwendy"
  }
  
  environment {
    key    = "NEXT_PUBLIC_API_URL"
    value  = var.api_url
    target = ["production", "preview"]
  }
}

# ============ Railway åç«¯ ============
resource "railway_project" "api" {
  name = "aiwendy-api"
}

resource "railway_service" "api" {
  project_id = railway_project.api.id
  name       = "api"
  
  source {
    repo   = "aiwendy/aiwendy"
    branch = "main"
    path   = "apps/api"
  }
}

# ============ AWS Secrets Manager ============
resource "aws_secretsmanager_secret" "db_credentials" {
  name = "aiwendy/database/credentials"
}

resource "aws_secretsmanager_secret" "api_keys" {
  name = "aiwendy/api-keys"
}

# ============ CloudWatch ç›‘æ§ ============
resource "aws_cloudwatch_metric_alarm" "api_errors" {
  alarm_name          = "aiwendy-api-error-rate"
  comparison_operator = "GreaterThanThreshold"
  evaluation_periods  = 2
  metric_name         = "5XXError"
  namespace           = "AWS/ApiGateway"
  period              = 300
  statistic           = "Sum"
  threshold           = 10
  alarm_description   = "API error rate is too high"
  alarm_actions       = [aws_sns_topic.alerts.arn]
}
```

---

## 15. ç›‘æ§å‘Šè­¦

### 15.1 ç›‘æ§æŒ‡æ ‡ä½“ç³»

#### RED æ–¹æ³•ï¼ˆé¢å‘æœåŠ¡ï¼‰

| æŒ‡æ ‡ | å«ä¹‰ | å‘Šè­¦é˜ˆå€¼ |
|------|------|----------|
| **Rate** | è¯·æ±‚é€Ÿç‡ (QPS) | < 10 (ä½äºåŸºçº¿ 50%) |
| **Errors** | é”™è¯¯ç‡ | > 1% (5xx) |
| **Duration** | å»¶è¿Ÿ P95 | > 500ms |

#### USE æ–¹æ³•ï¼ˆé¢å‘èµ„æºï¼‰

| æŒ‡æ ‡ | å«ä¹‰ | å‘Šè­¦é˜ˆå€¼ |
|------|------|----------|
| **Utilization** | CPU/å†…å­˜ä½¿ç”¨ç‡ | > 80% |
| **Saturation** | é˜Ÿåˆ—æ·±åº¦ | > 100 |
| **Errors** | èµ„æºé”™è¯¯ | > 0 |

### 15.2 Prometheus æŒ‡æ ‡

```python
# core/metrics.py

from prometheus_client import Counter, Histogram, Gauge, Info

# ============ è¯·æ±‚æŒ‡æ ‡ ============
REQUEST_COUNT = Counter(
    "http_requests_total",
    "Total HTTP requests",
    ["method", "endpoint", "status"]
)

REQUEST_LATENCY = Histogram(
    "http_request_duration_seconds",
    "HTTP request latency",
    ["method", "endpoint"],
    buckets=[0.01, 0.05, 0.1, 0.25, 0.5, 1.0, 2.5, 5.0, 10.0]
)

# ============ ä¸šåŠ¡æŒ‡æ ‡ ============
CHAT_TOKENS = Counter(
    "chat_tokens_total",
    "Total tokens used in chat",
    ["coach_id", "model"]
)

CHAT_LATENCY = Histogram(
    "chat_first_token_seconds",
    "Time to first token",
    ["coach_id", "model"],
    buckets=[0.1, 0.25, 0.5, 1.0, 2.0, 5.0]
)

ACTIVE_CONVERSATIONS = Gauge(
    "active_conversations",
    "Number of active conversations"
)

# ============ LLM æŒ‡æ ‡ ============
LLM_REQUESTS = Counter(
    "llm_requests_total",
    "Total LLM API requests",
    ["provider", "model", "status"]
)

LLM_LATENCY = Histogram(
    "llm_request_duration_seconds",
    "LLM API request latency",
    ["provider", "model"]
)

CIRCUIT_BREAKER_STATE = Gauge(
    "circuit_breaker_state",
    "Circuit breaker state (0=closed, 1=open, 2=half-open)",
    ["provider"]
)

# ============ ä¸­é—´ä»¶ ============
@app.middleware("http")
async def metrics_middleware(request: Request, call_next):
    start = time.time()
    response = await call_next(request)
    duration = time.time() - start
    
    REQUEST_COUNT.labels(
        method=request.method,
        endpoint=request.url.path,
        status=response.status_code
    ).inc()
    
    REQUEST_LATENCY.labels(
        method=request.method,
        endpoint=request.url.path
    ).observe(duration)
    
    return response
```

### 15.3 Grafana ä»ªè¡¨ç›˜

```json
{
  "dashboard": {
    "title": "AIWendy Overview",
    "panels": [
      {
        "title": "Request Rate",
        "type": "graph",
        "targets": [
          {
            "expr": "sum(rate(http_requests_total[5m]))",
            "legendFormat": "Total QPS"
          }
        ]
      },
      {
        "title": "Error Rate",
        "type": "graph",
        "targets": [
          {
            "expr": "sum(rate(http_requests_total{status=~\"5..\"}[5m])) / sum(rate(http_requests_total[5m])) * 100",
            "legendFormat": "Error %"
          }
        ],
        "alert": {
          "name": "High Error Rate",
          "conditions": [
            {"evaluator": {"params": [1], "type": "gt"}}
          ]
        }
      },
      {
        "title": "Latency P95",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le))",
            "legendFormat": "P95"
          }
        ]
      },
      {
        "title": "LLM Provider Status",
        "type": "stat",
        "targets": [
          {
            "expr": "circuit_breaker_state",
            "legendFormat": "{{provider}}"
          }
        ]
      },
      {
        "title": "Active Conversations",
        "type": "gauge",
        "targets": [
          {
            "expr": "active_conversations"
          }
        ]
      },
      {
        "title": "Token Usage",
        "type": "graph",
        "targets": [
          {
            "expr": "sum(rate(chat_tokens_total[1h])) by (model)",
            "legendFormat": "{{model}}"
          }
        ]
      }
    ]
  }
}
```

### 15.4 å‘Šè­¦è§„åˆ™

```yaml
# prometheus/alerts.yml

groups:
  - name: aiwendy-alerts
    rules:
      # ============ å¯ç”¨æ€§å‘Šè­¦ ============
      - alert: HighErrorRate
        expr: |
          sum(rate(http_requests_total{status=~"5.."}[5m])) 
          / sum(rate(http_requests_total[5m])) > 0.01
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "High error rate detected"
          description: "Error rate is {{ $value | printf \"%.2f\" }}%"

      - alert: HighLatency
        expr: |
          histogram_quantile(0.95, 
            sum(rate(http_request_duration_seconds_bucket[5m])) by (le)
          ) > 0.5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High latency detected"
          description: "P95 latency is {{ $value | printf \"%.2f\" }}s"

      # ============ LLM å‘Šè­¦ ============
      - alert: LLMCircuitOpen
        expr: circuit_breaker_state == 1
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "LLM circuit breaker is OPEN"
          description: "Provider {{ $labels.provider }} is unavailable"

      - alert: AllLLMProvidersDown
        expr: sum(circuit_breaker_state == 1) == count(circuit_breaker_state)
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "All LLM providers are down"

      # ============ èµ„æºå‘Šè­¦ ============
      - alert: HighCPUUsage
        expr: |
          100 - (avg by(instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High CPU usage"

      - alert: HighMemoryUsage
        expr: |
          (1 - node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes) * 100 > 85
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High memory usage"

      - alert: DiskSpaceLow
        expr: |
          (1 - node_filesystem_avail_bytes / node_filesystem_size_bytes) * 100 > 85
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Disk space is running low"

      # ============ ä¸šåŠ¡å‘Šè­¦ ============
      - alert: LowTrafficAnomaly
        expr: |
          sum(rate(http_requests_total[5m])) < 10
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "Abnormally low traffic"

      - alert: HighTokenUsage
        expr: |
          sum(increase(chat_tokens_total[1h])) > 1000000
        labels:
          severity: warning
        annotations:
          summary: "High token usage in the last hour"
```

### 15.5 SLA/SLO å®šä¹‰

| æŒ‡æ ‡ | SLO | SLA |
|------|-----|-----|
| **å¯ç”¨æ€§** | 99.9% (æœˆ) | 99.5% |
| **API å»¶è¿Ÿ P95** | < 500ms | < 1000ms |
| **é¦– Token å»¶è¿Ÿ** | < 1s | < 2s |
| **é”™è¯¯ç‡** | < 0.1% | < 1% |
| **æ•°æ®æŒä¹…æ€§** | 99.999% | 99.99% |

---

## 16. ç¾å¤‡ä¸æ¢å¤

### 16.1 å¤‡ä»½ç­–ç•¥

| æ•°æ®ç±»å‹ | å¤‡ä»½é¢‘ç‡ | ä¿ç•™æœŸ | å­˜å‚¨ä½ç½® |
|----------|----------|--------|----------|
| PostgreSQL | æ¯å°æ—¶å¢é‡ | 30 å¤© | S3 è·¨åŒºåŸŸå¤åˆ¶ |
| PostgreSQL | æ¯æ—¥å…¨é‡ | 1 å¹´ | S3 Glacier |
| Redis | æ¯å°æ—¶ RDB | 7 å¤© | S3 |
| ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ | å®æ—¶åŒæ­¥ | æ°¸ä¹… | S3 è·¨åŒºåŸŸå¤åˆ¶ |
| æ—¥å¿— | å®æ—¶ | 90 å¤© | CloudWatch Logs |

```yaml
# scripts/backup.yml

# PostgreSQL å¤‡ä»½è„šæœ¬
backup_postgres:
  schedule: "0 * * * *"  # æ¯å°æ—¶
  script: |
    #!/bin/bash
    TIMESTAMP=$(date +%Y%m%d_%H%M%S)
    BACKUP_FILE="aiwendy_${TIMESTAMP}.sql.gz"
    
    # å¢é‡å¤‡ä»½
    pg_dump $DATABASE_URL | gzip > /tmp/$BACKUP_FILE
    
    # ä¸Šä¼ åˆ° S3
    aws s3 cp /tmp/$BACKUP_FILE s3://aiwendy-backups/postgres/hourly/
    
    # æ¸…ç†æœ¬åœ°
    rm /tmp/$BACKUP_FILE
    
    # ä¿ç•™ç­–ç•¥ï¼šåˆ é™¤ 30 å¤©å‰çš„å¤‡ä»½
    aws s3 ls s3://aiwendy-backups/postgres/hourly/ | \
      awk '{print $4}' | \
      while read file; do
        file_date=$(echo $file | grep -oP '\d{8}')
        if [[ $(date -d "$file_date" +%s) -lt $(date -d "30 days ago" +%s) ]]; then
          aws s3 rm s3://aiwendy-backups/postgres/hourly/$file
        fi
      done

# æ¯æ—¥å…¨é‡å¤‡ä»½ï¼ˆç§»è‡³ Glacierï¼‰
backup_postgres_daily:
  schedule: "0 2 * * *"  # æ¯å¤©å‡Œæ™¨ 2 ç‚¹
  script: |
    #!/bin/bash
    TIMESTAMP=$(date +%Y%m%d)
    BACKUP_FILE="aiwendy_full_${TIMESTAMP}.sql.gz"
    
    pg_dump $DATABASE_URL | gzip > /tmp/$BACKUP_FILE
    
    # ä¸Šä¼ åˆ° Glacier
    aws s3 cp /tmp/$BACKUP_FILE s3://aiwendy-backups-archive/postgres/ \
      --storage-class GLACIER
```

### 16.2 RTO/RPO å®šä¹‰

| çº§åˆ« | RPO (æ•°æ®ä¸¢å¤±) | RTO (æ¢å¤æ—¶é—´) | é€‚ç”¨åœºæ™¯ |
|------|----------------|----------------|----------|
| **Tier 1** | 0 (é›¶ä¸¢å¤±) | < 5 åˆ†é’Ÿ | ç”¨æˆ·è®¤è¯ã€æ”¯ä»˜ |
| **Tier 2** | < 1 å°æ—¶ | < 30 åˆ†é’Ÿ | æ—¥è®°ã€å¯¹è¯ |
| **Tier 3** | < 24 å°æ—¶ | < 4 å°æ—¶ | åˆ†ææŠ¥å‘Šã€å®¡è®¡æ—¥å¿— |

### 16.3 æ•…éšœåˆ‡æ¢æ–¹æ¡ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¤šåŒºåŸŸæ¶æ„                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Primary Region (us-east-1)        DR Region (us-west-2)       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      API Servers        â”‚      â”‚    API Servers (å¤‡)     â”‚  â”‚
â”‚  â”‚      (Active)           â”‚      â”‚    (Standby)            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                                â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   PostgreSQL Primary    â”‚â”€â”€â”€â”€â”€â–¶â”‚   PostgreSQL Replica    â”‚  â”‚
â”‚  â”‚   (Read/Write)          â”‚ åŒæ­¥  â”‚   (Read Only)           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Redis Primary         â”‚â”€â”€â”€â”€â”€â–¶â”‚   Redis Replica         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ å¼‚æ­¥  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ•…éšœåˆ‡æ¢æµç¨‹ï¼š
1. ç›‘æ§æ£€æµ‹åˆ°ä¸»åŒºåŸŸæ•…éšœ
2. DNS è‡ªåŠ¨åˆ‡æ¢åˆ° DR åŒºåŸŸ
3. PostgreSQL Replica æå‡ä¸º Primary
4. é€šçŸ¥è¿ç»´å›¢é˜Ÿ
```

### 16.4 æ¢å¤æµç¨‹

```python
# scripts/disaster_recovery.py

class DisasterRecovery:
    """ç¾éš¾æ¢å¤æµç¨‹"""
    
    async def execute_failover(self):
        """æ‰§è¡Œæ•…éšœåˆ‡æ¢"""
        
        # 1. éªŒè¯ä¸»åŒºåŸŸçŠ¶æ€
        if await self.check_primary_health():
            logger.warning("Primary region is healthy, aborting failover")
            return
        
        # 2. åœæ­¢å†™å…¥ä¸»åŒºåŸŸ
        await self.stop_primary_writes()
        
        # 3. ç­‰å¾…å¤åˆ¶è¿½èµ¶
        await self.wait_for_replication_sync(timeout=60)
        
        # 4. æå‡ DR æ•°æ®åº“
        await self.promote_dr_database()
        
        # 5. æ›´æ–° DNS
        await self.update_dns_to_dr()
        
        # 6. å¯åŠ¨ DR åŒºåŸŸæœåŠ¡
        await self.start_dr_services()
        
        # 7. éªŒè¯æœåŠ¡å¥åº·
        await self.verify_dr_health()
        
        # 8. é€šçŸ¥å›¢é˜Ÿ
        await self.notify_team("Failover completed successfully")
    
    async def execute_restore(self, backup_timestamp: str):
        """ä»å¤‡ä»½æ¢å¤"""
        
        # 1. ä¸‹è½½å¤‡ä»½
        backup_file = await self.download_backup(backup_timestamp)
        
        # 2. åœæ­¢æœåŠ¡
        await self.stop_services()
        
        # 3. æ¢å¤æ•°æ®åº“
        await self.restore_database(backup_file)
        
        # 4. éªŒè¯æ•°æ®å®Œæ•´æ€§
        await self.verify_data_integrity()
        
        # 5. é‡å¯æœåŠ¡
        await self.start_services()
        
        # 6. è¿è¡Œå¥åº·æ£€æŸ¥
        await self.run_health_checks()
```

### 16.5 æ•…éšœæ¼”ç»ƒ

| æ¼”ç»ƒç±»å‹ | é¢‘ç‡ | å‚ä¸äººå‘˜ |
|----------|------|----------|
| å¤‡ä»½æ¢å¤æµ‹è¯• | æ¯æœˆ | DevOps |
| æ•…éšœåˆ‡æ¢æ¼”ç»ƒ | æ¯å­£åº¦ | DevOps + å¼€å‘ |
| å…¨ç«™ç¾éš¾æ¼”ç»ƒ | æ¯å¹´ | å…¨å›¢é˜Ÿ |

---

## 17. æ€§èƒ½è®¾è®¡

### 17.1 æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
|------|--------|------|
| **API å»¶è¿Ÿ P50** | < 100ms | æ™®é€šè¯·æ±‚ |
| **API å»¶è¿Ÿ P95** | < 500ms | å¤æ‚æŸ¥è¯¢ |
| **API å»¶è¿Ÿ P99** | < 1s | æç«¯æƒ…å†µ |
| **é¦– Token å»¶è¿Ÿ** | < 800ms | LLM æµå¼å“åº” |
| **é¡µé¢åŠ è½½** | < 2s | LCP |
| **QPS å®¹é‡** | 1000+ | å•å®ä¾‹ |

### 17.2 å®¹é‡è§„åˆ’

```
ç”¨æˆ·è§„æ¨¡é¢„ä¼°ï¼š

Month 1:   100 ç”¨æˆ·  â†’ 1 API å®ä¾‹
Month 3:   1,000 ç”¨æˆ· â†’ 2 API å®ä¾‹
Month 6:   5,000 ç”¨æˆ· â†’ 3 API å®ä¾‹ + Read Replica
Month 12:  20,000 ç”¨æˆ· â†’ 5 API å®ä¾‹ + åˆ†åº“

æ¯ç”¨æˆ·èµ„æºæ¶ˆè€—ä¼°ç®—ï¼š
- æ—¥è®°: 5 æ¡/å¤© Ã— 2KB = 10KB/å¤©
- å¯¹è¯: 3 æ¬¡/å¤© Ã— 5KB = 15KB/å¤©
- Token: 3 æ¬¡ Ã— 2000 token = 6000 token/å¤©
- å‘é‡: 5 æ¡ Ã— 6KB = 30KB/å¤©

æœˆå­˜å‚¨å¢é•¿:
- 1,000 ç”¨æˆ·: ~2GB/æœˆ
- 10,000 ç”¨æˆ·: ~20GB/æœˆ
- 100,000 ç”¨æˆ·: ~200GB/æœˆ
```

### 17.3 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### æ•°æ®åº“ä¼˜åŒ–

```sql
-- ============ æ…¢æŸ¥è¯¢ç›‘æ§ ============
-- å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—
ALTER SYSTEM SET log_min_duration_statement = 100;  -- 100ms

-- ============ æŸ¥è¯¢ä¼˜åŒ–ç¤ºä¾‹ ============
-- åŸå§‹æŸ¥è¯¢ï¼ˆæ…¢ï¼‰
SELECT * FROM journals 
WHERE user_id = 'xxx' 
ORDER BY trade_date DESC;

-- ä¼˜åŒ–åï¼ˆä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼‰
CREATE INDEX idx_journals_user_date_covering 
ON journals(user_id, trade_date DESC) 
INCLUDE (symbol, pnl, entry_emotion, exit_emotion);

-- ============ è¿æ¥æ± é…ç½® ============
-- SQLAlchemy è¿æ¥æ± 
engine = create_async_engine(
    DATABASE_URL,
    pool_size=20,           # è¿æ¥æ± å¤§å°
    max_overflow=30,        # æœ€å¤§æº¢å‡º
    pool_timeout=30,        # ç­‰å¾…è¶…æ—¶
    pool_recycle=1800,      # è¿æ¥å›æ”¶æ—¶é—´
    pool_pre_ping=True,     # è¿æ¥å¥åº·æ£€æŸ¥
)
```

#### ç¼“å­˜ç­–ç•¥

```python
# core/cache.py

from functools import wraps
import hashlib
import json

class CacheService:
    def __init__(self, redis: Redis):
        self.redis = redis
    
    async def get(self, key: str) -> Any | None:
        value = await self.redis.get(key)
        if value:
            return json.loads(value)
        return None
    
    async def set(
        self, 
        key: str, 
        value: Any, 
        ttl: int = 300
    ):
        await self.redis.setex(
            key, 
            ttl, 
            json.dumps(value, default=str)
        )
    
    async def invalidate(self, pattern: str):
        keys = await self.redis.keys(pattern)
        if keys:
            await self.redis.delete(*keys)

def cached(ttl: int = 300, key_prefix: str = ""):
    """ç¼“å­˜è£…é¥°å™¨"""
    def decorator(func):
        @wraps(func)
        async def wrapper(*args, **kwargs):
            # ç”Ÿæˆç¼“å­˜ key
            cache_key = f"{key_prefix}:{func.__name__}:{_hash_args(args, kwargs)}"
            
            # å°è¯•ä»ç¼“å­˜è·å–
            cached_value = await cache.get(cache_key)
            if cached_value is not None:
                return cached_value
            
            # æ‰§è¡Œå‡½æ•°
            result = await func(*args, **kwargs)
            
            # å†™å…¥ç¼“å­˜
            await cache.set(cache_key, result, ttl)
            
            return result
        return wrapper
    return decorator

# ============ ä½¿ç”¨ç¤ºä¾‹ ============
@cached(ttl=60, key_prefix="coach")
async def get_coach(coach_id: str) -> Coach:
    return await coach_repo.get_by_id(coach_id)

@cached(ttl=300, key_prefix="user_stats")
async def get_user_stats(user_id: str, period: str) -> dict:
    return await analysis_service.calculate_stats(user_id, period)
```

#### CDN ä¸é™æ€èµ„æº

```typescript
// next.config.js

module.exports = {
  // é™æ€èµ„æº CDN
  assetPrefix: process.env.CDN_URL || '',
  
  // å›¾ç‰‡ä¼˜åŒ–
  images: {
    domains: ['cdn.aiwendy.com'],
    formats: ['image/avif', 'image/webp'],
  },
  
  // é¡µé¢ç¼“å­˜
  async headers() {
    return [
      {
        source: '/:path*',
        headers: [
          {
            key: 'Cache-Control',
            value: 'public, max-age=31536000, immutable',
          },
        ],
      },
    ];
  },
};
```

### 17.4 å‹æµ‹æ–¹æ¡ˆ

```python
# tests/load/locustfile.py

from locust import HttpUser, task, between

class AIWendyUser(HttpUser):
    wait_time = between(1, 3)
    
    def on_start(self):
        # ç™»å½•è·å– token
        response = self.client.post("/api/v1/auth/login", json={
            "email": f"loadtest_{self.user_id}@test.com",
            "password": "testpassword"
        })
        self.token = response.json()["data"]["tokens"]["access_token"]
        self.headers = {"Authorization": f"Bearer {self.token}"}
    
    @task(3)
    def get_journals(self):
        """è·å–æ—¥è®°åˆ—è¡¨ï¼ˆé«˜é¢‘ï¼‰"""
        self.client.get(
            "/api/v1/journals",
            headers=self.headers
        )
    
    @task(2)
    def create_journal(self):
        """åˆ›å»ºæ—¥è®°"""
        self.client.post(
            "/api/v1/journals",
            headers=self.headers,
            json={
                "symbol": "AAPL",
                "direction": "long",
                "pnl": 100.0,
                "entry_emotion": 3,
                "exit_emotion": 4,
                "trade_date": "2024-01-15"
            }
        )
    
    @task(1)
    def chat(self):
        """å¯¹è¯ï¼ˆä½é¢‘ä½†è€—æ—¶ï¼‰"""
        self.client.post(
            "/api/v1/chat",
            headers=self.headers,
            json={
                "coach_id": "wendy",
                "messages": [
                    {"role": "user", "content": "ä»Šå¤©äº¤æ˜“äºæŸäº†ï¼Œå¿ƒæƒ…ä¸å¥½"}
                ]
            }
        )
    
    @task(1)
    def get_stats(self):
        """è·å–ç»Ÿè®¡"""
        self.client.get(
            "/api/v1/analysis/stats?period=week",
            headers=self.headers
        )

# è¿è¡Œå‘½ä»¤:
# locust -f tests/load/locustfile.py --host=https://staging-api.aiwendy.com
```

### 17.5 æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•

| ç±»åˆ« | æ£€æŸ¥é¡¹ | çŠ¶æ€ |
|------|--------|------|
| **æ•°æ®åº“** | ç´¢å¼•è¦†ç›–å¸¸ç”¨æŸ¥è¯¢ | âœ… |
| | æ…¢æŸ¥è¯¢ç›‘æ§ | âœ… |
| | è¿æ¥æ± é…ç½® | âœ… |
| | è¯»å†™åˆ†ç¦»ï¼ˆé«˜è§„æ¨¡ï¼‰ | â³ |
| **ç¼“å­˜** | çƒ­ç‚¹æ•°æ®ç¼“å­˜ | âœ… |
| | ç¼“å­˜é¢„çƒ­ | âœ… |
| | ç¼“å­˜å¤±æ•ˆç­–ç•¥ | âœ… |
| **API** | åˆ†é¡µé™åˆ¶ | âœ… |
| | å“åº”å‹ç¼© | âœ… |
| | æ‰¹é‡æ¥å£ | â³ |
| **å‰ç«¯** | é™æ€èµ„æº CDN | âœ… |
| | å›¾ç‰‡ä¼˜åŒ– | âœ… |
| | ä»£ç åˆ†å‰² | âœ… |
| | SSR ç¼“å­˜ | âœ… |

---

## 18. è¿ç»´æ‰‹å†Œ

### 18.1 æ—¥å¸¸è¿ç»´

#### å¥åº·æ£€æŸ¥

```bash
# æ£€æŸ¥ API å¥åº·çŠ¶æ€
curl -s https://api.aiwendy.com/health | jq

# æ£€æŸ¥è¯¦ç»†çŠ¶æ€
curl -s https://api.aiwendy.com/health/ready | jq

# æ£€æŸ¥ PostgreSQL
psql $DATABASE_URL -c "SELECT pg_is_in_recovery();"

# æ£€æŸ¥ Redis
redis-cli -u $REDIS_URL ping
```

#### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹ API æ—¥å¿—
railway logs --service api-production

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
railway logs --service api-production | jq 'select(.level == "error")'

# æœç´¢ç‰¹å®šè¯·æ±‚
railway logs --service api-production | jq 'select(.request_id == "xxx")'

# æŸ¥çœ‹æ…¢è¯·æ±‚
railway logs --service api-production | jq 'select(.duration_ms > 500)'
```

#### æ•°æ®åº“ç»´æŠ¤

```bash
# åˆ†æè¡¨ç»Ÿè®¡ä¿¡æ¯
psql $DATABASE_URL -c "ANALYZE journals;"

# æŸ¥çœ‹è¡¨å¤§å°
psql $DATABASE_URL -c "
SELECT 
  relname as table,
  pg_size_pretty(pg_total_relation_size(relid)) as total_size
FROM pg_catalog.pg_statio_user_tables
ORDER BY pg_total_relation_size(relid) DESC;
"

# æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ
psql $DATABASE_URL -c "
SELECT 
  indexrelname,
  idx_scan,
  idx_tup_read
FROM pg_stat_user_indexes
ORDER BY idx_scan DESC;
"

# æ¸…ç†è¿‡æœŸæ•°æ®
psql $DATABASE_URL -c "
DELETE FROM audit_logs WHERE timestamp < NOW() - INTERVAL '90 days';
VACUUM ANALYZE audit_logs;
"
```

### 18.2 æ•…éšœæ’æŸ¥

#### å¸¸è§é—®é¢˜

| é—®é¢˜ | ç—‡çŠ¶ | æ’æŸ¥æ­¥éª¤ | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|----------|
| **API æ— å“åº”** | å¥åº·æ£€æŸ¥å¤±è´¥ | 1. æ£€æŸ¥å®ä¾‹çŠ¶æ€<br>2. æ£€æŸ¥æ•°æ®åº“è¿æ¥<br>3. æ£€æŸ¥å†…å­˜/CPU | é‡å¯å®ä¾‹ / æ‰©å®¹ |
| **å“åº”ç¼“æ…¢** | P95 > 1s | 1. æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—<br>2. æ£€æŸ¥ LLM å»¶è¿Ÿ<br>3. æ£€æŸ¥ç¼“å­˜å‘½ä¸­ç‡ | ä¼˜åŒ–æŸ¥è¯¢ / æ‰©å®¹ LLM |
| **LLM å¤±è´¥** | ç†”æ–­å™¨æ‰“å¼€ | 1. æ£€æŸ¥ API ä½™é¢<br>2. æ£€æŸ¥é…é¢é™åˆ¶<br>3. æ£€æŸ¥ç½‘ç»œ | åˆ‡æ¢ Provider / ç­‰å¾…æ¢å¤ |
| **æ•°æ®åº“è¿æ¥è€—å°½** | è¿æ¥è¶…æ—¶ | 1. æ£€æŸ¥æ´»è·ƒè¿æ¥æ•°<br>2. æ£€æŸ¥è¿æ¥æ³„æ¼<br>3. æ£€æŸ¥æ…¢äº‹åŠ¡ | ç»ˆæ­¢ç©ºé—²è¿æ¥ / ä¼˜åŒ–æŸ¥è¯¢ |

#### æ’æŸ¥è„šæœ¬

```bash
#!/bin/bash
# scripts/diagnose.sh

echo "=== AIWendy Diagnostics ==="
echo ""

echo "1. API Health"
curl -s https://api.aiwendy.com/health/ready | jq
echo ""

echo "2. Database Connections"
psql $DATABASE_URL -c "
SELECT count(*), state 
FROM pg_stat_activity 
GROUP BY state;
"
echo ""

echo "3. Redis Memory"
redis-cli -u $REDIS_URL INFO memory | grep used_memory_human
echo ""

echo "4. Recent Errors (last 10)"
railway logs --service api-production --since 1h | \
  jq -r 'select(.level == "error") | "\(.timestamp) \(.message)"' | \
  tail -10
echo ""

echo "5. Circuit Breaker Status"
redis-cli -u $REDIS_URL GET cb:openai
redis-cli -u $REDIS_URL GET cb:anthropic
echo ""

echo "6. Top 5 Slow Requests (last hour)"
railway logs --service api-production --since 1h | \
  jq -r 'select(.duration_ms > 500) | "\(.duration_ms)ms \(.path)"' | \
  sort -rn | head -5
```

### 18.3 å˜æ›´ç®¡ç†

| å˜æ›´ç±»å‹ | å®¡æ‰¹è¦æ±‚ | æ‰§è¡Œçª—å£ | å›æ»šè®¡åˆ’ |
|----------|----------|----------|----------|
| **é…ç½®å˜æ›´** | 1 äºº | ä»»æ„æ—¶é—´ | Git å›æ»š |
| **å°ç‰ˆæœ¬å‘å¸ƒ** | 1 äºº | å·¥ä½œæ—¥ | è‡ªåŠ¨å›æ»š |
| **å¤§ç‰ˆæœ¬å‘å¸ƒ** | 2 äºº | ä½å³°æœŸ | æ‰‹åŠ¨å›æ»š |
| **æ•°æ®åº“å˜æ›´** | 2 äºº | ç»´æŠ¤çª—å£ | å¤‡ä»½æ¢å¤ |
| **åŸºç¡€è®¾æ–½å˜æ›´** | 2 äºº | ç»´æŠ¤çª—å£ | Terraform å›æ»š |

### 18.4 ç´§æ€¥è”ç³»äºº

| è§’è‰² | è´£ä»» | è”ç³»æ–¹å¼ |
|------|------|----------|
| **Primary On-Call** | é¦–è¦å“åº” | PagerDuty è½®å€¼ |
| **Secondary On-Call** | å¤‡ä»½å“åº” | PagerDuty è½®å€¼ |
| **Tech Lead** | æŠ€æœ¯å†³ç­– | Slack @tech-lead |
| **DevOps Lead** | åŸºç¡€è®¾æ–½ | Slack @devops-lead |
| **Product Owner** | ä¸šåŠ¡å†³ç­– | Slack @product |

### 18.5 å€¼ç­åˆ¶åº¦

```yaml
# å€¼ç­è½®æ¢
rotation:
  schedule: weekly
  timezone: Asia/Shanghai
  handoff: Monday 10:00
  
# å“åº”æ—¶é—´
response_sla:
  critical: 5 minutes   # P0: æœåŠ¡å®Œå…¨ä¸å¯ç”¨
  high: 15 minutes      # P1: æ ¸å¿ƒåŠŸèƒ½å—å½±å“
  medium: 1 hour        # P2: éæ ¸å¿ƒåŠŸèƒ½å—å½±å“
  low: 4 hours          # P3: è½»å¾®é—®é¢˜

# å‡çº§æµç¨‹
escalation:
  - after: 5 minutes
    notify: secondary_oncall
  - after: 15 minutes
    notify: tech_lead
  - after: 30 minutes
    notify: engineering_manager
```

### 18.6 äº‹åå¤ç›˜æ¨¡æ¿

```markdown
# äº‹æ•…å¤ç›˜æŠ¥å‘Š

## åŸºæœ¬ä¿¡æ¯
- **äº‹æ•…æ—¶é—´**: 2024-01-15 14:30 - 15:45 (UTC+8)
- **å½±å“èŒƒå›´**: æ‰€æœ‰ç”¨æˆ·
- **ä¸¥é‡ç¨‹åº¦**: P1
- **å€¼ç­äººå‘˜**: @xxx

## æ—¶é—´çº¿
- 14:30 - ç›‘æ§å‘Šè­¦è§¦å‘
- 14:35 - å€¼ç­äººå‘˜ç¡®è®¤é—®é¢˜
- 14:40 - å®šä½åˆ°æ•°æ®åº“è¿æ¥è€—å°½
- 15:00 - é‡å¯æ•°æ®åº“è¿æ¥æ± 
- 15:15 - æœåŠ¡æ¢å¤æ­£å¸¸
- 15:45 - å®Œæˆç›‘æ§éªŒè¯

## æ ¹æœ¬åŸå› 
- åŸå›  1: xxx
- åŸå›  2: xxx

## å½±å“
- ç”¨æˆ·å½±å“: çº¦ 500 ç”¨æˆ·å—å½±å“
- ä¸šåŠ¡å½±å“: å¯¹è¯åŠŸèƒ½ä¸å¯ç”¨ 75 åˆ†é’Ÿ

## æ”¹è¿›æªæ–½
| æªæ–½ | è´Ÿè´£äºº | æˆªæ­¢æ—¥æœŸ | çŠ¶æ€ |
|------|--------|----------|------|
| å¢åŠ è¿æ¥æ± ç›‘æ§ | @devops | 2024-01-20 | å¾…å¤„ç† |
| ä¼˜åŒ–æ…¢æŸ¥è¯¢ | @backend | 2024-01-25 | å¾…å¤„ç† |

## ç»éªŒæ•™è®­
- xxx
```

---

## 19. æœ¬åœ°éƒ¨ç½²æŒ‡å—

### 19.1 ç¡¬ä»¶è¦æ±‚

| é…ç½®çº§åˆ« | CPU | å†…å­˜ | å­˜å‚¨ | GPU | é€‚ç”¨åœºæ™¯ |
|----------|-----|------|------|-----|----------|
| **æœ€ä½é…ç½®** | 4 æ ¸ | 8GB | 50GB SSD | æ—  | å¼€å‘æµ‹è¯•ï¼ˆä½¿ç”¨äº‘ç«¯ LLMï¼‰ |
| **æ¨èé…ç½®** | 8 æ ¸ | 16GB | 100GB SSD | æ—  | å°å›¢é˜Ÿç”Ÿäº§ï¼ˆä½¿ç”¨äº‘ç«¯ LLMï¼‰ |
| **æœ¬åœ° LLM** | 8 æ ¸ | 32GB | 200GB SSD | 8GB+ VRAM | æœ¬åœ°æ¨¡å‹æ¨ç† |
| **é«˜æ€§èƒ½** | 16 æ ¸ | 64GB | 500GB NVMe | 24GB+ VRAM | å¤§è§„æ¨¡æœ¬åœ°éƒ¨ç½² |

### 19.2 ä¸€é”®å®‰è£…è„šæœ¬

```bash
#!/bin/bash
# install.sh - AIWendy ä¸€é”®å®‰è£…è„šæœ¬

set -e

echo "=========================================="
echo "  AIWendy æœ¬åœ°éƒ¨ç½²å®‰è£…ç¨‹åº"
echo "=========================================="

# æ£€æŸ¥ Docker
if ! command -v docker &> /dev/null; then
    echo "âŒ Docker æœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£… Docker"
    echo "   è®¿é—®: https://docs.docker.com/get-docker/"
    exit 1
fi

# æ£€æŸ¥ Docker Compose
if ! command -v docker-compose &> /dev/null; then
    echo "âŒ Docker Compose æœªå®‰è£…"
    exit 1
fi

echo "âœ… Docker ç¯å¢ƒæ£€æŸ¥é€šè¿‡"

# åˆ›å»ºç›®å½•
mkdir -p aiwendy && cd aiwendy

# ä¸‹è½½é…ç½®æ–‡ä»¶
echo "ğŸ“¥ ä¸‹è½½é…ç½®æ–‡ä»¶..."
curl -sL https://raw.githubusercontent.com/aiwendy/aiwendy/main/docker-compose.local.yml -o docker-compose.yml
curl -sL https://raw.githubusercontent.com/aiwendy/aiwendy/main/.env.example -o .env

# ç”Ÿæˆå¯†é’¥
echo "ğŸ” ç”Ÿæˆå®‰å…¨å¯†é’¥..."
JWT_SECRET=$(openssl rand -hex 32)
DB_PASSWORD=$(openssl rand -hex 16)

sed -i "s/your_jwt_secret_here/$JWT_SECRET/" .env
sed -i "s/your_secure_password_here/$DB_PASSWORD/" .env

echo ""
echo "âš™ï¸  è¯·ç¼–è¾‘ .env æ–‡ä»¶é…ç½® API å¯†é’¥:"
echo "   - OPENAI_API_KEY=sk-xxx"
echo "   - ANTHROPIC_API_KEY=sk-ant-xxx"
echo ""
read -p "é…ç½®å®ŒæˆåæŒ‰ Enter ç»§ç»­..."

# å¯åŠ¨æœåŠ¡
echo "ğŸš€ å¯åŠ¨æœåŠ¡..."
docker-compose up -d

# ç­‰å¾…æœåŠ¡å°±ç»ª
echo "â³ ç­‰å¾…æœåŠ¡å¯åŠ¨..."
sleep 30

# å¥åº·æ£€æŸ¥
if curl -s http://localhost:8000/health | grep -q "ok"; then
    echo ""
    echo "=========================================="
    echo "  âœ… AIWendy å®‰è£…æˆåŠŸï¼"
    echo "=========================================="
    echo ""
    echo "  å‰ç«¯åœ°å€: http://localhost:3000"
    echo "  API åœ°å€: http://localhost:8000"
    echo "  API æ–‡æ¡£: http://localhost:8000/docs"
    echo ""
    echo "  é»˜è®¤ç®¡ç†å‘˜è´¦å·:"
    echo "    é‚®ç®±: admin@aiwendy.local"
    echo "    å¯†ç : changeme123"
    echo ""
    echo "  âš ï¸  è¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼"
    echo ""
else
    echo "âŒ æœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—:"
    echo "   docker-compose logs"
    exit 1
fi
```

### 19.3 æœ¬åœ° Docker Compose é…ç½®

```yaml
# docker-compose.local.yml
version: "3.9"

services:
  # ============ æ•°æ®åº“ ============
  db:
    image: docker.1ms.run/pgvector/pgvector:pg16
    container_name: aiwendy-db
    environment:
      POSTGRES_USER: aiwendy
      POSTGRES_PASSWORD: ${DB_PASSWORD}
      POSTGRES_DB: aiwendy
    volumes:
      - ./data/postgres:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U aiwendy"]
      interval: 10s
      timeout: 5s
      retries: 5

  # ============ Redis ============
  redis:
    image: docker.1ms.run/library/redis:7.2-alpine
    container_name: aiwendy-redis
    volumes:
      - ./data/redis:/data
    ports:
      - "6379:6379"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5

  # ============ åç«¯ API ============
  api:
    image: ghcr.io/aiwendy/aiwendy-api:latest
    container_name: aiwendy-api
    environment:
      - DATABASE_URL=postgresql+asyncpg://aiwendy:${DB_PASSWORD}@db:5432/aiwendy
      - REDIS_URL=redis://redis:6379
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - JWT_SECRET=${JWT_SECRET}
      - OLLAMA_BASE_URL=${OLLAMA_BASE_URL:-http://ollama:11434}
    ports:
      - "8000:8000"
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
    restart: unless-stopped

  # ============ å‰ç«¯ ============
  web:
    image: ghcr.io/aiwendy/aiwendy-web:latest
    container_name: aiwendy-web
    environment:
      - NEXT_PUBLIC_API_URL=http://localhost:8000
    ports:
      - "3000:3000"
    depends_on:
      - api
    restart: unless-stopped

  # ============ Ollamaï¼ˆå¯é€‰ï¼Œæœ¬åœ° LLMï¼‰============
  ollama:
    image: docker.1ms.run/ollama/ollama:latest
    container_name: aiwendy-ollama
    volumes:
      - ./data/ollama:/root/.ollama
    ports:
      - "11434:11434"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    profiles:
      - local-llm
    restart: unless-stopped

volumes:
  postgres_data:
  redis_data:
  ollama_data:
```

### 19.4 ç¦»çº¿ LLM æ–¹æ¡ˆ

#### Ollama å¿«é€Ÿå®‰è£…

```bash
# å®‰è£… Ollama
curl -fsSL https://ollama.com/install.sh | sh

# ä¸‹è½½æ¨èæ¨¡å‹
ollama pull llama3.1:8b          # 4.7GBï¼Œé€šç”¨å¯¹è¯
ollama pull qwen2.5:7b           # 4.4GBï¼Œä¸­æ–‡ä¼˜åŒ–
ollama pull mistral:7b           # 4.1GBï¼Œä»£ç èƒ½åŠ›å¼º

# éªŒè¯å®‰è£…
ollama list
```

#### æ¨¡å‹æ¨è

| æ˜¾å­˜ | æ¨èæ¨¡å‹ | å¤§å° | è¯´æ˜ |
|------|----------|------|------|
| 8GB | llama3.1:8b | 4.7GB | åŸºç¡€å¯¹è¯ï¼Œå“åº”å¿« |
| 8GB | qwen2.5:7b | 4.4GB | ä¸­æ–‡ä¼˜åŒ– |
| 12GB | llama3.1:8b-q8 | 8.5GB | æ›´é«˜ç²¾åº¦ |
| 16GB | llama3.1:70b-q4 | 40GB | æ¥è¿‘ GPT-4 |
| 24GB+ | llama3.1:70b-q8 | 75GB | æœ€ä½³ä½“éªŒ |

### 19.5 vLLM é«˜æ€§èƒ½éƒ¨ç½²

```bash
# ä½¿ç”¨ Docker éƒ¨ç½² vLLM
docker run --runtime nvidia --gpus all \
    -v ~/.cache/huggingface:/root/.cache/huggingface \
    -p 8080:8000 \
    --ipc=host \
    vllm/vllm-openai:latest \
    --model meta-llama/Llama-3.1-8B-Instruct \
    --tensor-parallel-size 1

# AIWendy é…ç½®
VLLM_BASE_URL=http://localhost:8080/v1
```

### 19.6 é…ç½®è¯´æ˜

#### ç¯å¢ƒå˜é‡

| å˜é‡ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| `DB_PASSWORD` | âœ… | æ•°æ®åº“å¯†ç  | è‡ªåŠ¨ç”Ÿæˆ |
| `JWT_SECRET` | âœ… | JWT ç­¾åå¯†é’¥ | è‡ªåŠ¨ç”Ÿæˆ |
| `OPENAI_API_KEY` | âš ï¸ | OpenAI API å¯†é’¥ | sk-xxx |
| `ANTHROPIC_API_KEY` | âš ï¸ | Anthropic API å¯†é’¥ | sk-ant-xxx |
| `OLLAMA_BASE_URL` | âŒ | Ollama æœåŠ¡åœ°å€ | http://localhost:11434 |
| `VLLM_BASE_URL` | âŒ | vLLM æœåŠ¡åœ°å€ | http://localhost:8080/v1 |

> âš ï¸ äº‘ç«¯ API å’Œæœ¬åœ° LLM è‡³å°‘é…ç½®ä¸€ä¸ª

### 19.7 å¸¸è§é—®é¢˜ FAQ

#### Q: Docker é•œåƒæ‹‰å–è¶…æ—¶ï¼Ÿ

```bash
# ä½¿ç”¨å›½å†…é•œåƒæº
# ç¼–è¾‘ /etc/docker/daemon.json
{
  "registry-mirrors": [
    "https://docker.1ms.run",
    "https://registry.cn-hangzhou.aliyuncs.com"
  ]
}

# é‡å¯ Docker
sudo systemctl restart docker
```

#### Q: Ollama GPU åŠ é€Ÿä¸ç”Ÿæ•ˆï¼Ÿ

```bash
# æ£€æŸ¥ NVIDIA é©±åŠ¨
nvidia-smi

# å®‰è£… NVIDIA Container Toolkit
distribution=$(. /etc/os-release;echo $ID$VERSION_ID)
curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add -
curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | \
    sudo tee /etc/apt/sources.list.d/nvidia-docker.list
sudo apt-get update && sudo apt-get install -y nvidia-container-toolkit
sudo systemctl restart docker
```

#### Q: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ

```bash
# å¤‡ä»½ PostgreSQL
docker exec aiwendy-db pg_dump -U aiwendy aiwendy > backup_$(date +%Y%m%d).sql

# å¤‡ä»½å®Œæ•´æ•°æ®ç›®å½•
tar -czvf aiwendy_backup_$(date +%Y%m%d).tar.gz ./data/
```

#### Q: å¦‚ä½•å‡çº§ç‰ˆæœ¬ï¼Ÿ

```bash
# æ‹‰å–æœ€æ–°é•œåƒ
docker-compose pull

# é‡å¯æœåŠ¡
docker-compose up -d

# æ•°æ®åº“è¿ç§»ï¼ˆå¦‚éœ€è¦ï¼‰
docker exec aiwendy-api alembic upgrade head
```

#### Q: å†…å­˜ä¸è¶³æ€ä¹ˆåŠï¼Ÿ

```bash
# è°ƒæ•´æ¨¡å‹é‡åŒ–çº§åˆ«
ollama pull llama3.1:8b-q4_0    # æ›´ä½å†…å­˜å ç”¨

# æˆ–ä½¿ç”¨æ›´å°çš„æ¨¡å‹
ollama pull qwen2.5:3b          # ä»…éœ€ 4GB å†…å­˜
```

### 19.8 NAS éƒ¨ç½²æŒ‡å—ï¼ˆç¾¤æ™–/å¨è”é€šï¼‰

#### ç¾¤æ™– DSM 7.x

```bash
# 1. å®‰è£… Container Managerï¼ˆDockerï¼‰
# 2. åˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹
mkdir -p /volume1/docker/aiwendy

# 3. ä¸Šä¼  docker-compose.yml å’Œ .env

# 4. SSH ç™»å½•åæ‰§è¡Œ
cd /volume1/docker/aiwendy
sudo docker-compose up -d
```

#### ç¡¬ä»¶å»ºè®®

| NAS å‹å· | CPU | å†…å­˜ | å»ºè®® |
|----------|-----|------|------|
| DS920+ | J4125 | 4-8GB | ä»…äº‘ç«¯ LLM |
| DS1621+ | V1500B | 8-32GB | å¯è¿è¡Œå°æ¨¡å‹ |
| DS1821+ | V1500B | 8-32GB | å¯è¿è¡Œå°æ¨¡å‹ |

---

## 20. å®æ–½è·¯çº¿å›¾

### 19.1 åˆ†é˜¶æ®µè®¡åˆ’

| é˜¶æ®µ | å‘¨æœŸ | ç›®æ ‡ | äº¤ä»˜ç‰© |
|------|------|------|--------|
| **Phase 1: MVP** | 6 å‘¨ | éªŒè¯ PMF | åŸºç¡€å¯¹è¯ + æ—¥è®°åŠŸèƒ½ |
| **Phase 2: æ ¸å¿ƒåŠŸèƒ½** | 8 å‘¨ | åŠŸèƒ½å®Œå–„ | è¡Œä¸ºåˆ†æ + å¤šæ•™ç»ƒ + è®¢é˜… |
| **Phase 3: å•†ä¸šåŒ–** | 6 å‘¨ | æ”¶å…¥éªŒè¯ | æ”¯ä»˜ + å¤šç§Ÿæˆ· + ç›‘æ§ |
| **Phase 4: è§„æ¨¡åŒ–** | æŒç»­ | é™æœ¬å¢æ•ˆ | æœ¬åœ°æ¨¡å‹ + ä¼ä¸šç‰ˆ |

### 19.2 Phase 1 è¯¦ç»†è®¡åˆ’ï¼ˆ6 å‘¨ï¼‰

| å‘¨æ¬¡ | ä»»åŠ¡ |
|------|------|
| Week 1 | Next.js + shadcn åˆå§‹åŒ–ï¼Œè®¾è®¡ç³»ç»Ÿæ­å»º |
| Week 2 | FastAPI åç«¯ + GPT-4o-mini æµå¼å¯¹æ¥ |
| Week 3 | PostgreSQL + ç”¨æˆ·/æ—¥è®°æ•°æ®æ¨¡å‹ |
| Week 4 | æ ¸å¿ƒå¯¹è¯ç•Œé¢ UI + æ—¥è®°è®°å½•è¡¨å• |
| Week 5 | éƒ¨ç½² Vercel + Railway + åŸºç¡€è®¤è¯ |
| Week 6 | å†…æµ‹ + Bug ä¿®å¤ + è¿­ä»£ |

### 19.3 æŠ€æœ¯é‡Œç¨‹ç¢‘

```
Week 2:  âœ“ èƒ½å’Œ AI å¯¹è¯
Week 4:  âœ“ èƒ½è®°å½•æ—¥è®°
Week 6:  âœ“ MVP ä¸Šçº¿ï¼Œå¼€å§‹å†…æµ‹
Week 10: âœ“ å¤šæ•™ç»ƒ + å‘¨æŠ¥
Week 14: âœ“ Stripe æ”¯ä»˜ + è®¢é˜…
Week 20: âœ“ 1000 ä»˜è´¹ç”¨æˆ·
```

---

## 21. æˆæœ¬ä¼°ç®—

### 20.1 MVP é˜¶æ®µï¼ˆ3 ä¸ªæœˆï¼Œ100 ç”¨æˆ·ï¼‰

| é¡¹ç›® | æœˆè´¹ |
|------|------|
| LLM API | ~$200 |
| Vercel Pro | $20 |
| Railway | $20 |
| Supabase | $25 |
| åŸŸå/SSL | ~$5 |
| **åˆè®¡** | **~$270/æœˆ** |

### 20.2 å•†ä¸šåŒ–é˜¶æ®µï¼ˆ12 ä¸ªæœˆï¼Œ10K ç”¨æˆ·ï¼‰

| é¡¹ç›® | æœˆè´¹ |
|------|------|
| LLM API | ~$5,000 |
| åŸºç¡€è®¾æ–½ | ~$500 |
| ç›‘æ§/åˆ†æ | ~$200 |
| SOC 2 å®¡è®¡ï¼ˆåˆ†æ‘Šï¼‰ | ~$8,000 |
| **åˆè®¡** | **~$13,700/æœˆ** |

### 20.3 è§„æ¨¡åŒ–é˜¶æ®µï¼ˆ24 ä¸ªæœˆï¼Œ50K+ ç”¨æˆ·ï¼‰

| é¡¹ç›® | æœˆè´¹ |
|------|------|
| æœ¬åœ° GPU é›†ç¾¤ | ~$15,000 |
| åŸºç¡€è®¾æ–½ | ~$3,000 |
| å›¢é˜Ÿï¼ˆ10äººï¼‰ | ~$150,000 |
| **åˆè®¡** | **~$168,000/æœˆ** |

**é¢„æœŸæ”¶å…¥**ï¼ˆ@$50 ARPUï¼Œ30% ä»˜è´¹ç‡ï¼‰ï¼š~$750,000/æœˆ

**æ¯›åˆ©ç‡ç›®æ ‡**ï¼š70%+

---

## é™„å½•

### A. å…³é”®ä»£ç ç¤ºä¾‹

**æµå¼å¯¹è¯å‰ç«¯**ï¼š
```typescript
// app/chat/page.tsx
'use client';
import { useChat } from 'ai/react';

export default function Chat() {
  const { messages, input, handleInputChange, handleSubmit, isLoading } = useChat({
    api: '/api/chat',
  });

  return (
    <div className="flex flex-col h-screen">
      <MessageList messages={messages} />
      <ChatInput 
        value={input} 
        onChange={handleInputChange}
        onSubmit={handleSubmit}
        disabled={isLoading}
      />
    </div>
  );
}
```

**æµå¼å¯¹è¯åç«¯**ï¼š
```python
# api/routers/chat.py
from fastapi import APIRouter
from fastapi.responses import StreamingResponse
from openai import OpenAI

router = APIRouter()
client = OpenAI()

@router.post("/chat")
async def chat(request: ChatRequest):
    coach = await get_coach(request.coach_id)
    
    async def generate():
        stream = client.chat.completions.create(
            model=coach.llm_model,
            messages=[
                {"role": "system", "content": coach.system_prompt},
                *request.messages
            ],
            stream=True
        )
        for chunk in stream:
            if chunk.choices[0].delta.content:
                yield f"data: {chunk.choices[0].delta.content}\n\n"
    
    return StreamingResponse(generate(), media_type="text/event-stream")
```

### B. shadcn/ui ä¸»é¢˜é…ç½®

```css
/* globals.css */
@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 0 0% 4%;
    --primary: 175 77% 26%;        /* #0F766E */
    --primary-foreground: 0 0% 100%;
    --secondary: 138 76% 97%;      /* #F0FDF4 */
    --muted: 0 0% 64%;
    --accent: 138 76% 97%;
    --destructive: 220 9% 46%;     /* äºæŸç”¨ç°è‰² */
    --border: 0 0% 90%;
    --radius: 0.5rem;
  }
}
```

### C. åˆè§„æ£€æŸ¥æ¸…å•

| åˆè§„è¦æ±‚ | çŠ¶æ€ | è¯´æ˜ |
|----------|------|------|
| SOC 2 Type II | â³ | å•†ä¸šåŒ–å‰å¯åŠ¨ |
| GDPR | â³ | æ•°æ®æœ€å°åŒ– + åˆ é™¤èƒ½åŠ› |
| SEC/FINRA | âœ… | å®šä½æ•™è‚²/å¿ƒç†æ•™ç»ƒï¼ŒéæŠ•èµ„å»ºè®® |
| æ•°æ®åŠ å¯† | âœ… | AES-256 é™æ€ + TLS 1.3 ä¼ è¾“ |

---

## æ–‡æ¡£å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´è¯´æ˜ |
|------|------|----------|
| v1.0 | 2024-12 | åˆå§‹ç‰ˆæœ¬ |
| v1.1 | 2024-12-28 | æ–°å¢ç”¨æˆ·çº§ API å¯†é’¥é…ç½®ã€ä¸­å›½åœ°åŒºéƒ¨ç½²ä¼˜åŒ–ã€æ ‡è®°å·²å®ç°åŠŸèƒ½ |
| v1.2 | 2024-12-28 | æ–°å¢æœ¬åœ°éƒ¨ç½²æŒ‡å—ã€å®Œå–„ç”¨æˆ·åŠŸèƒ½è®¾è®¡ã€UI æ¨¡ä»¿ç­–ç•¥ã€è‡ªå®šä¹‰å¤§æ¨¡å‹è®¾ç½® |
| v1.3 | 2024-12-28 | æ›´æ–°å®ç°çŠ¶æ€ï¼Œå®Œæˆäº¤æ˜“æ—¥è®°åç«¯å®ç° |
| v1.4 | 2024-12-29 | å®Œæˆäº¤æ˜“æ—¥è®°å‰ç«¯å…¨éƒ¨é¡µé¢ï¼ˆåˆ—è¡¨ã€è¯¦æƒ…ã€ç¼–è¾‘ã€ç»Ÿè®¡ä»ªè¡¨æ¿ï¼‰ |
| v1.5 | 2024-12-29 | å®Œæˆ AI æ—¥è®°åˆ†æåŠŸèƒ½ï¼ˆæ¨¡å¼è¯†åˆ«ã€æ”¹è¿›å»ºè®®ã€ä¸ªæ€§åŒ–è¾…å¯¼ï¼‰ |
| v1.6 | 2024-12-29 | ä¼˜åŒ–èŠå¤©ç•Œé¢ UIï¼ˆClaude.ai é£æ ¼ã€ä»£ç é«˜äº®ã€èŠå¤©å†å²ï¼‰ |
| v1.7 | 2024-12-29 | å®Œæˆæ•°æ®å¯è§†åŒ–å›¾è¡¨ï¼ˆæ”¶ç›Šæ›²çº¿ã€P&Låˆ†å¸ƒã€äº¤æ˜“æ—¥å†ã€å¿ƒç†æŒ‡æ ‡ï¼‰ |
| v1.8 | 2024-12-29 | å®Œæˆ Ollama æœ¬åœ°æ¨¡å‹é›†æˆï¼ˆæ”¯æŒç¦»çº¿ AI æ•™ç»ƒåŠŸèƒ½ï¼‰ |
| v2.0 | 2024-12-29 | ğŸ‰ **MVP å®Œæˆï¼** Kçº¿å›¾è¡¨é›†æˆå®Œæˆï¼Œç³»ç»ŸåŠŸèƒ½å®Œæ•´å¯ç”¨ |

---

## 22. å®ç°çŠ¶æ€ï¼ˆ2026-01-02 æ›´æ–° - v1.9 è½åœ°åŒæ­¥ï¼‰

### 22.1 å·²å®ŒæˆåŠŸèƒ½ âœ…

#### åŸºç¡€è®¾æ–½
- âœ… FastAPI + Next.js é¡¹ç›®ç»“æ„
- âœ… Docker å®¹å™¨åŒ–é…ç½®
- âœ… å¼€å‘ç¯å¢ƒçƒ­é‡è½½
- âœ… TypeScript å…¨æ ˆé…ç½®
- âœ… ESLint + Prettier ä»£ç è§„èŒƒ

#### ç”¨æˆ·ç³»ç»Ÿ
- âœ… ç”¨æˆ·æ³¨å†Œ/ç™»å½• API
- âœ… JWT è®¤è¯æœºåˆ¶
- âœ… å¯†ç åŠ å¯†ï¼ˆbcryptï¼‰
- âœ… ç”¨æˆ·ä¼šè¯ç®¡ç†
- âœ… æµ‹è¯•è´¦å·åˆ›å»ºï¼ˆtest@example.com, admin@aiwendy.comï¼‰
- âœ… ç”¨æˆ·èµ„æ–™ç®¡ç†

#### API å¯†é’¥ç®¡ç†ï¼ˆBYOK æ¨¡å¼ï¼‰
- âœ… ç”¨æˆ·çº§ API å¯†é’¥é…ç½®
- âœ… å¯†é’¥åŠ å¯†å­˜å‚¨ï¼ˆFernetï¼‰
- âœ… å‰ç«¯è®¾ç½®é¡µé¢
- âœ… å¯†é’¥æ©ç æ˜¾ç¤º
- âœ… æ”¯æŒå¤šä¸ª LLM æä¾›å•†ï¼ˆOpenAIã€Anthropicã€DeepSeekã€Ollamaï¼‰

#### AI å¯¹è¯åŠŸèƒ½
- âœ… æµå¼å¯¹è¯æ¥å£ï¼ˆSSEï¼‰
- âœ… å¯¹è¯å†å²ç®¡ç†
- âœ… ä¼šè¯æŒä¹…åŒ–ï¼ˆchat_sessions/chat_messagesï¼‰
- âœ… Project åˆ†ç»„ä¼šè¯ï¼ˆæŒ‰é¡¹ç›®ç­›é€‰ä¼šè¯å†å²ï¼‰
- âœ… çŸ¥è¯†åº“ï¼ˆå¯¼å…¥/è¯­ä¹‰æ£€ç´¢ï¼‰ä¸èŠå¤©å¯é€‰æ³¨å…¥ KB ä¸Šä¸‹æ–‡
- âœ… å¤šæ¨¡å‹è·¯ç”±ï¼ˆLLMRouterï¼‰
- âœ… å‰ç«¯èŠå¤©ç•Œé¢ï¼ˆClaude.ai é£æ ¼ï¼‰
- âœ… Markdown æ¸²æŸ“
- âœ… ä»£ç è¯­æ³•é«˜äº®
- âœ… æ‰“å­—åŠ¨ç”»æ•ˆæœ
- âœ… æ¨¡å‹é€‰æ‹©å™¨ï¼ˆæ”¯æŒåˆ‡æ¢æä¾›å•†å’Œæ¨¡å‹ï¼‰
- âœ… èŠå¤©å†å²ä¿å­˜ä¸å¯¼å‡º

#### äº¤æ˜“æ—¥è®°ç³»ç»Ÿ
- âœ… æ•°æ®åº“æ¨¡å‹è®¾è®¡ï¼ˆjournals, journal_templatesï¼‰
- âœ… å®Œæ•´çš„ CRUD API ç«¯ç‚¹
- âœ… æ”¯æŒæŒ‰ project åˆ†ç»„/ç­›é€‰ï¼ˆproject_idï¼‰
- âœ… ç»Ÿè®¡åˆ†ææ¥å£
- âœ… å¿«é€Ÿè®°å½•æ¥å£
- âœ… Repository æ¨¡å¼å®ç°
- âœ… å‰ç«¯ç±»å‹å®šä¹‰
- âœ… API æœåŠ¡å°è£…
- âœ… æ—¥è®°åˆ›å»ºè¡¨å•é¡µé¢
- âœ… æ—¥è®°åˆ—è¡¨é¡µé¢ï¼ˆç­›é€‰ã€åˆ†é¡µã€æ’åºåŠŸèƒ½ï¼‰
- âœ… æ—¥è®°è¯¦æƒ…é¡µé¢ï¼ˆå®Œæ•´ä¿¡æ¯å±•ç¤ºã€å¿ƒç†åˆ†æï¼‰
- âœ… æ—¥è®°ç¼–è¾‘é¡µé¢ï¼ˆæ›´æ–°æ‰€æœ‰å­—æ®µï¼‰
- âœ… ç»Ÿè®¡ä»ªè¡¨æ¿ï¼ˆå…³é”®æŒ‡æ ‡ã€ä¸šç»©åˆ†æã€æ™ºèƒ½å»ºè®®ï¼‰

#### AI åˆ†æåŠŸèƒ½
- âœ… AI åˆ†ææœåŠ¡å®ç°ï¼ˆJournalAIAnalyzerï¼‰
- âœ… å•ä¸ªæ—¥è®°åˆ†æç«¯ç‚¹
- âœ… äº¤æ˜“æ¨¡å¼åˆ†æç«¯ç‚¹
- âœ… æ”¹è¿›è®¡åˆ’ç”Ÿæˆç«¯ç‚¹
- âœ… å‰ç«¯ AI åˆ†æé›†æˆ
- âœ… åˆ†æç»“æœå±•ç¤ºç»„ä»¶
- âœ… å®æ—¶ AI åˆ†æè§¦å‘
- âœ… æ¨¡å¼è¯†åˆ«ç®—æ³•
- âœ… ä¸ªæ€§åŒ–å»ºè®®ç”Ÿæˆ
- âœ… 30å¤©è¡ŒåŠ¨æ–¹æ¡ˆ

#### æ•°æ®å¯è§†åŒ–
- âœ… æ”¶ç›Šæ›²çº¿å›¾ï¼ˆEquityCurveï¼‰- è´¦æˆ·ä½™é¢å˜åŒ–è¶‹åŠ¿
- âœ… P&L åˆ†å¸ƒå›¾ï¼ˆPnLDistributionï¼‰- ç›ˆäºåˆ†å¸ƒåˆ†æ
- âœ… äº¤æ˜“æ—¥å†ï¼ˆTradingCalendarï¼‰- æ—¥/å‘¨/æœˆä¸šç»©å±•ç¤º
- âœ… å¿ƒç†æŒ‡æ ‡å›¾è¡¨ï¼ˆPsychologyMetricsï¼‰- æƒ…ç»ªå’Œå¿ƒç†çŠ¶æ€è¿½è¸ª
- âœ… ç»Ÿè®¡é¡µé¢é›†æˆ - å¤šæ ‡ç­¾é¡µè§†å›¾å±•ç¤ºæ‰€æœ‰å›¾è¡¨
- âœ… å›¾è¡¨å“åº”å¼è®¾è®¡
- âœ… å›¾è¡¨æ•°æ®å¯¼å‡ºåŠŸèƒ½

#### æœ¬åœ°æ¨¡å‹æ”¯æŒï¼ˆOllamaï¼‰
- âœ… Ollama æœåŠ¡ç±»å®ç°ï¼ˆæ”¯æŒèŠå¤©ã€åµŒå…¥ã€æ¨¡å‹ç®¡ç†ï¼‰
- âœ… é›†æˆåˆ° LLM è·¯ç”±å™¨ï¼ˆè‡ªåŠ¨æ£€æµ‹æœ¬åœ°æœåŠ¡ï¼‰
- âœ… API ç«¯ç‚¹æ”¯æŒï¼ˆå¥åº·æ£€æŸ¥ã€æ¨¡å‹åˆ—è¡¨ã€æ¨¡å‹ä¸‹è½½ã€æµ‹è¯•èŠå¤©ï¼‰
- âœ… å‰ç«¯è®¾ç½®é¡µé¢ï¼ˆ/settings/ollamaï¼‰
- âœ… æ¨¡å‹ç®¡ç†ç•Œé¢ï¼ˆä¸‹è½½è¿›åº¦ã€æœåŠ¡çŠ¶æ€ï¼‰
- âœ… èŠå¤©ç•Œé¢æ¨¡å‹é€‰æ‹©å™¨ï¼ˆæ”¯æŒåˆ‡æ¢åˆ°æœ¬åœ°æ¨¡å‹ï¼‰
- âœ… æ¨èæ¨¡å‹é…ç½®ï¼ˆLlama 3.2ã€Mistralã€Gemma 2ã€Qwen 2.5ï¼‰
- âœ… å®Œæ•´çš„å‰åç«¯é›†æˆï¼ˆæ¨¡å‹é…ç½®ä¼ é€’ã€æµå¼å“åº”ï¼‰

#### Kçº¿å›¾è¡¨é›†æˆ
- âœ… åŸºç¡€ Kçº¿å›¾ç»„ä»¶ï¼ˆKLineChartï¼‰- èœ¡çƒ›å›¾ã€äº¤æ˜“é‡ã€äº¤æ˜“æ ‡è®°
- âœ… é«˜çº§å›¾è¡¨ç»„ä»¶ï¼ˆAdvancedKLineChartï¼‰- æŠ€æœ¯æŒ‡æ ‡ã€æ·±è‰²æ¨¡å¼ã€å¯¼å‡ºåŠŸèƒ½
- âœ… æŠ€æœ¯æŒ‡æ ‡å®ç°ï¼ˆSMAã€EMAã€RSIã€å¸ƒæ—å¸¦ï¼‰
- âœ… å¸‚åœºæ•°æ® API æœåŠ¡ï¼ˆå†å²æ•°æ®ã€å®æ—¶ä»·æ ¼ã€æŠ€æœ¯æŒ‡æ ‡ï¼‰
- âœ… å‰ç«¯ API å®¢æˆ·ç«¯ï¼ˆmarket-data.tsï¼‰
- âœ… é›†æˆåˆ°æ—¥è®°è¯¦æƒ…é¡µé¢ï¼ˆæ˜¾ç¤ºç›¸å…³è‚¡ç¥¨èµ°åŠ¿ï¼‰
- âœ… é›†æˆåˆ°ç»Ÿè®¡é¡µé¢ï¼ˆCharts æ ‡ç­¾é¡µï¼‰
- âœ… æ—¶é—´æ¡†æ¶åˆ‡æ¢ï¼ˆ1å¤©ã€1å‘¨ã€1æœˆï¼‰
- âœ… å›¾è¡¨ç±»å‹åˆ‡æ¢ï¼ˆèœ¡çƒ›å›¾ã€çº¿å›¾ã€é¢ç§¯å›¾ï¼‰
- âœ… ä½¿ç”¨ TradingView Lightweight Charts åº“
- âœ… é”™è¯¯å¤„ç†å’Œé™çº§ï¼ˆAPI å¤±è´¥æ—¶ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼‰

### 22.2 å¾…å®ç°åŠŸèƒ½ âŒ

#### Phase 1: MVP âœ… å·²å…¨éƒ¨å®Œæˆï¼

#### Phase 2: æ ¸å¿ƒåŠŸèƒ½
- âœ… å¤šæ•™ç»ƒç³»ç»Ÿï¼ˆä¸åŒé£æ ¼çš„ AI æ•™ç»ƒï¼ŒåŸºç¡€ç‰ˆï¼‰
- âœ… æ•™ç»ƒå¸‚åœºï¼ˆæ•™ç»ƒåˆ—è¡¨/ç­›é€‰/å¼€å§‹å¯¹è¯ï¼‰
- âœ… å‘¨æœŸæ€§æŠ¥å‘Šï¼ˆæ—¥æŠ¥/å‘¨æŠ¥/æœˆæŠ¥ + æŠ¥å‘Šåˆ—è¡¨/è¯¦æƒ…/å®šæ—¶è®¾ç½®ï¼‰
- âœ… è®¢é˜…ç®¡ç†ï¼ˆè®¡åˆ’/è®¢é˜…é¡µ/ç»“ç®—é¡µï¼›éœ€é…ç½® Stripe å¯†é’¥ï¼‰
- â³ æ”¯ä»˜é›†æˆï¼ˆStripeï¼‰ï¼šåç«¯å·²æ¥å…¥ï¼Œéœ€å¯†é’¥ + webhook ç«¯åˆ°ç«¯éªŒè¯

#### Phase 3: å•†ä¸šåŒ–
- âŒ å¤šç§Ÿæˆ·æ¶æ„
- âŒ ä¼ä¸šç‰ˆåŠŸèƒ½
- âŒ ç›‘æ§å‘Šè­¦ç³»ç»Ÿï¼ˆSentryã€Prometheusï¼‰
- âŒ æ•°æ®åˆ†æå¹³å°

#### Phase 4: è§„æ¨¡åŒ–
- âœ… å‘é‡æ•°æ®åº“ï¼ˆpgvectorï¼‰ç”¨äºè¯­ä¹‰æœç´¢ï¼ˆçŸ¥è¯†åº“æ£€ç´¢ + èŠå¤©æ³¨å…¥ï¼‰
- âœ… å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ï¼ˆCeleryï¼‰ï¼ˆæŠ¥å‘Šç”Ÿæˆ/çŸ¥è¯†åº“å¯¼å…¥å¼‚æ­¥ + ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢ï¼‰
- âœ… Redis ç¼“å­˜å±‚ï¼ˆåˆ†æ/çŸ¥è¯†åº“æ£€ç´¢çŸ­ TTL ç¼“å­˜ + Celery broker/backendï¼‰
- â³ æ€§èƒ½ä¼˜åŒ–ï¼ˆç¼“å­˜ç­–ç•¥ã€æŸ¥è¯¢ä¼˜åŒ–ï¼‰

### 22.3 å½“å‰è¿›åº¦æ€»ç»“

**é¡¹ç›®çŠ¶æ€ï¼šMVP+ å¯ç”¨ï¼ˆä»¥ä»£ç ä¸ºå‡†ï¼‰** ğŸ‰

#### å®Œæˆåº¦ç»Ÿè®¡
- **MVP Phase 1**: 100% âœ… å®Œæˆï¼
- **Phase 2**: 85%ï¼ˆå¤šæ•™ç»ƒ/æ•™ç»ƒå¸‚åœº/æŠ¥å‘Š/è®¢é˜…åŸºç¡€é“¾è·¯å·²è½åœ°ï¼›Stripe éœ€å¯†é’¥éªŒè¯ï¼‰
- **Phase 3**: 0% å¼€å§‹
- **Phase 4**: 60% å®Œæˆï¼ˆpgvector è¯­ä¹‰æ£€ç´¢ + Celery å¼‚æ­¥ + Redis ç¼“å­˜å·²å®ç°ï¼‰

#### æŠ€æœ¯æŒ‡æ ‡
- **ä»£ç è¡Œæ•°**: ~18,000+ è¡Œ
- **React ç»„ä»¶**: 55+ ä¸ª
- **API ç«¯ç‚¹**: 35+ ä¸ª
- **æ•°æ®åº“è¡¨**: 10+ ä¸ª
- **æ”¯æŒçš„ AI æ¨¡å‹**: 10+ ä¸ªï¼ˆäº‘ç«¯ + æœ¬åœ°ï¼‰
- **å‰ç«¯é¡µé¢**: 18+ ä¸ª
- **å›¾è¡¨ç±»å‹**: 6 ç§ï¼ˆå« Kçº¿å›¾å’Œé«˜çº§å›¾è¡¨ï¼‰

#### æ ¸å¿ƒåŠŸèƒ½è¦†ç›–
| åŠŸèƒ½æ¨¡å— | å®Œæˆåº¦ | è¯´æ˜ |
|---------|--------|------|
| ç”¨æˆ·ç³»ç»Ÿ | 100% | å®Œæ•´çš„è®¤è¯å’Œç”¨æˆ·ç®¡ç† |
| AI å¯¹è¯ | 100% | æ”¯æŒå¤šæ¨¡å‹ã€æµå¼å“åº” |
| äº¤æ˜“æ—¥è®° | 100% | CRUD + AI åˆ†æ |
| æ•°æ®å¯è§†åŒ– | 100% | å…¨éƒ¨å›¾è¡¨å·²å®ç° |
| Kçº¿å›¾è¡¨ | 100% | TradingView å›¾è¡¨é›†æˆå®Œæˆ |
| æœ¬åœ°æ¨¡å‹ | 100% | Ollama å®Œæ•´é›†æˆ |
| æ”¯ä»˜è®¢é˜… | 70% | API + å‰ç«¯ç»“ç®—é¡µå·²è½åœ°ï¼›éœ€ Stripe å¯†é’¥ + webhook éªŒè¯ |
| ä¼ä¸šåŠŸèƒ½ | 0% | æœªå¼€å§‹ |

### 22.4 æœ€è¿‘æ›´æ–°å†…å®¹

**2024-12-29 ç¬¬å…­æ¬¡æ›´æ–°ï¼ˆMVP å®Œæˆï¼ï¼‰**ï¼š
- âœ… å®Œæˆ Kçº¿å›¾è¡¨é›†æˆ
  - å®ç°åŸºç¡€å’Œé«˜çº§ Kçº¿å›¾ç»„ä»¶
  - é›†æˆ TradingView Lightweight Charts åº“
  - æ·»åŠ æŠ€æœ¯æŒ‡æ ‡ï¼ˆSMAã€EMAã€RSIã€å¸ƒæ—å¸¦ï¼‰
  - åˆ›å»ºå¸‚åœºæ•°æ® API æœåŠ¡
  - é›†æˆåˆ°æ—¥è®°è¯¦æƒ…å’Œç»Ÿè®¡é¡µé¢
  - **MVP ç¬¬ä¸€é˜¶æ®µå…¨éƒ¨å®Œæˆï¼**

**2024-12-29 ç¬¬äº”æ¬¡æ›´æ–°**ï¼š
- âœ… å®Œæˆ Ollama æœ¬åœ°æ¨¡å‹é›†æˆ
  - å®ç°å®Œæ•´çš„ Ollama æœåŠ¡ç±»
  - é›†æˆåˆ° LLM è·¯ç”±ç³»ç»Ÿ
  - åˆ›å»ºæ¨¡å‹ç®¡ç†ç•Œé¢
  - æ”¯æŒæ¨¡å‹ä¸‹è½½å’Œå¥åº·æ£€æŸ¥
  - å®ç°å‰ç«¯æ¨¡å‹é€‰æ‹©å™¨

**2024-12-29 ç¬¬å››æ¬¡æ›´æ–°**ï¼š
- âœ… å®Œæˆæ•°æ®å¯è§†åŒ–å›¾è¡¨
  - å®ç° 4 ç§æ ¸å¿ƒå›¾è¡¨ç»„ä»¶
  - é›†æˆ Recharts å›¾è¡¨åº“
  - æ·»åŠ äº¤äº’å¼å›¾è¡¨åŠŸèƒ½
  - ä¼˜åŒ–ç§»åŠ¨ç«¯å“åº”å¼

**2024-12-29 ç¬¬ä¸‰æ¬¡æ›´æ–°**ï¼š
- âœ… ä¼˜åŒ–èŠå¤©ç•Œé¢ UI
  - é‡‡ç”¨ Claude.ai é£æ ¼è®¾è®¡
  - æ·»åŠ ä»£ç è¯­æ³•é«˜äº®
  - å®ç°æ‰“å­—åŠ¨ç”»æ•ˆæœ
  - æ”¯æŒèŠå¤©å†å²å¯¼å‡º

### 22.5 ä¸‹ä¸€æ­¥è®¡åˆ’

**ğŸ‰ MVP å·²å®Œæˆï¼ç°åœ¨è¿›å…¥ Phase 2 å¼€å‘**

**çŸ­æœŸç›®æ ‡ï¼ˆ1-2å‘¨ï¼‰**ï¼š
1. å¼€å§‹å¤šæ•™ç»ƒç³»ç»Ÿå¼€å‘
2. æ·»åŠ å‘¨æœŸæ€§æŠ¥å‘ŠåŠŸèƒ½ï¼ˆæ—¥æŠ¥ã€å‘¨æŠ¥ã€æœˆæŠ¥ï¼‰
3. ä¼˜åŒ–ç°æœ‰åŠŸèƒ½çš„ç”¨æˆ·ä½“éªŒ

**ä¸­æœŸç›®æ ‡ï¼ˆ1ä¸ªæœˆï¼‰**ï¼š
4. é›†æˆ Stripe æ”¯ä»˜
5. å®ç°è®¢é˜…ç®¡ç†ç³»ç»Ÿ
6. æ·»åŠ æ•™ç»ƒå¸‚åœºåŠŸèƒ½
7. å®ç°æ•°æ®å¯¼å‡ºåŠŸèƒ½

**é•¿æœŸç›®æ ‡ï¼ˆ3ä¸ªæœˆï¼‰**ï¼š
8. å®ç°å‘é‡æ•°æ®åº“ï¼ˆpgvectorï¼‰ç”¨äºè¯­ä¹‰æœç´¢
9. æ·»åŠ ä¼ä¸šç‰ˆåŠŸèƒ½ï¼ˆå¤šç§Ÿæˆ·ã€å›¢é˜Ÿç®¡ç†ï¼‰
10. æ€§èƒ½ä¼˜åŒ–å’Œç›‘æ§ç³»ç»Ÿï¼ˆSentryã€Prometheusï¼‰
11. ç§»åŠ¨ç«¯é€‚é…ä¼˜åŒ–

---

> **é¡¹ç›®æˆå°±**ï¼š
>
> AIWendy å·²ç»**å®Œæˆ MVP ç¬¬ä¸€é˜¶æ®µçš„å…¨éƒ¨åŠŸèƒ½**ï¼Œè¾¾åˆ°äº†å¯æ­£å¼æŠ•å…¥ä½¿ç”¨çš„çŠ¶æ€ï¼å…·å¤‡äº†ï¼š
> - ğŸ“Š å®Œæ•´çš„äº¤æ˜“è®°å½•ç®¡ç†ç³»ç»Ÿ
> - ğŸ§  æ™ºèƒ½ AI å¿ƒç†è¾…å¯¼ï¼ˆæ”¯æŒå¤šæ¨¡å‹ï¼‰
> - ğŸ“ˆ ä¸“ä¸šçš„æ•°æ®å¯è§†åŒ–ï¼ˆå« Kçº¿å›¾ï¼‰
> - ğŸ¯ ä¸ªæ€§åŒ–æ”¹è¿›å»ºè®®å’Œæ¨¡å¼åˆ†æ
> - ğŸ’¾ æœ¬åœ°æ¨¡å‹è¿è¡Œèƒ½åŠ›ï¼ˆOllamaï¼‰
> - ğŸ“‰ ä¸“ä¸šçš„ Kçº¿å›¾è¡¨å’ŒæŠ€æœ¯æŒ‡æ ‡
>
> **ç³»ç»Ÿç°å·²å…·å¤‡å®Œæ•´çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå¯ä»¥ä¸ºäº¤æ˜“è€…æä¾›å…¨æ–¹ä½çš„å¿ƒç†è¾…å¯¼å’Œç»©æ•ˆæ”¹è¿›æ”¯æŒï¼**

---

> **ä¸‹ä¸€é˜¶æ®µé‡ç‚¹ï¼ˆPhase 2ï¼‰**ï¼š
> 1. å®ç°å¤šæ•™ç»ƒç³»ç»Ÿï¼ˆä¸åŒé£æ ¼çš„ AI æ•™ç»ƒï¼‰
> 2. æ·»åŠ å‘¨æœŸæ€§æŠ¥å‘ŠåŠŸèƒ½ï¼ˆæ—¥æŠ¥ã€å‘¨æŠ¥ã€æœˆæŠ¥ï¼‰
> 3. é›†æˆæ”¯ä»˜ç³»ç»Ÿï¼ˆStripeï¼‰å®ç°å•†ä¸šåŒ–
> 4. å»ºç«‹æ•™ç»ƒå¸‚åœºç”Ÿæ€ç³»ç»Ÿ
> 5. å®ç°å‘é‡æ•°æ®åº“æ”¯æŒï¼ˆpgvectorï¼‰ç”¨äºè¯­ä¹‰æœç´¢
